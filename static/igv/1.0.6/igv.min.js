function testOauth(){var t="https://accounts.google.com/o/oauth2/auth?scope=https://www.googleapis.com/auth/genomics&state=%2Fprofile&redirect_uri=http%3A%2F%2Flocalhost%2Figv-web%2FemptyPage.html&response_type=token&client_id=661332306814-8nt29308rppg325bkq372vli8nm3na14.apps.googleusercontent.com";$.ajax(t,{success:function(t,e,i){console.log(e)},error:function(t,e,i){t.statusCode();console.log(t.getResponseHeader("location"))},complete:function(t,e){console.log(e)}})}function ZStream(){}function Inflate(){this.was=[0]}function InfBlocks(t,e,i){this.hufts=new Int32Array(3*MANY),this.window=new Uint8Array(i),this.end=i,this.checkfn=e,this.mode=IB_TYPE,this.reset(t,null),this.left=0,this.table=0,this.index=0,this.blens=null,this.bb=new Int32Array(1),this.tb=new Int32Array(1),this.codes=new InfCodes,this.last=0,this.bitk=0,this.bitb=0,this.read=0,this.write=0,this.check=0,this.inftree=new InfTree}function InfCodes(){}function InfTree(){}function inflate_trees_fixed(t,e,i,r,n){return t[0]=fixed_bl,e[0]=fixed_bd,i[0]=fixed_tl,r[0]=fixed_td,Z_OK}function arrayCopy(t,e,i,r,n){if(0!=n){if(!t)throw"Undef src";if(!i)throw"Undef dest";0==e&&n==t.length?arrayCopy_fast(t,i,r):hasSubarray?arrayCopy_fast(t.subarray(e,e+n),i,r):1==t.BYTES_PER_ELEMENT&&n>100?arrayCopy_fast(new Uint8Array(t.buffer,t.byteOffset+e,n),i,r):arrayCopy_slow(t,e,i,r,n)}}function arrayCopy_slow(t,e,i,r,n){for(var a=0;a<n;++a)i[r+a]=t[e+a]}function arrayCopy_fast(t,e,i){e.set(t,i)}function adler32(t,e,i,r){if(null==e)return 1;for(var n,a=65535&t,o=t>>16&65535;r>0;){for(n=r<ADLER_NMAX?r:ADLER_NMAX,r-=n;n>=16;)a+=255&e[i++],o+=a,a+=255&e[i++],o+=a,a+=255&e[i++],o+=a,a+=255&e[i++],o+=a,a+=255&e[i++],o+=a,a+=255&e[i++],o+=a,a+=255&e[i++],o+=a,a+=255&e[i++],o+=a,a+=255&e[i++],o+=a,a+=255&e[i++],o+=a,a+=255&e[i++],o+=a,a+=255&e[i++],o+=a,a+=255&e[i++],o+=a,a+=255&e[i++],o+=a,a+=255&e[i++],o+=a,a+=255&e[i++],o+=a,n-=16;if(0!=n)do a+=255&e[i++],o+=a;while(0!=--n);a%=ADLER_BASE,o%=ADLER_BASE}return o<<16|a}function jszlib_inflate_buffer(t,e,i,r){t=e?new Uint8Array(t,e,i):new Uint8Array(t);var n=new ZStream;n.inflateInit(DEF_WBITS,!0),n.next_in=t,n.next_in_index=0,n.avail_in=t.length;for(var a=[],o=0;;){var s=new Uint8Array(32e3);n.next_out=s,n.next_out_index=0,n.avail_out=s.length;var h=n.inflate(Z_NO_FLUSH);if(h!=Z_OK&&h!=Z_STREAM_END)throw n.msg;if(0!=n.avail_out){var l=new Uint8Array(s.length-n.avail_out);arrayCopy(s,0,l,0,s.length-n.avail_out),s=l}if(a.push(s),o+=s.length,h==Z_STREAM_END)break}if(r&&(r[0]=(e||0)+n.next_in_index),1==a.length)return a[0].buffer;for(var c=new Uint8Array(o),u=0,d=0;d<a.length;++d){var p=a[d];arrayCopy(p,0,c,u,p.length),u+=p.length}return c.buffer}var igv=function(t){function e(t){return t.isPaired()&&t.mate&&t.isMateMapped()&&t.chr===t.mate.chr&&(t.isFirstOfPair()||t.isSecondOfPair())&&!(t.isSecondary()||t.isSupplementary())}function i(){this.alignments=this.alignments.concat(this.currentBucket.alignments),this.currentBucket.downsampledCount>0&&this.downsampledIntervals.push(new DownsampledInterval(this.currentBucket.start,this.currentBucket.end,this.currentBucket.downsampledCount)),this.paired=this.paired||this.currentBucket.paired}function r(t,e,i){this.start=t,this.end=e,this.alignments=[],this.downsampledCount=0,this.samplingDepth=i.samplingDepth,this.pairsSupported=i.pairsSupported,this.downsampledReads=i.downsampledReads,this.pairsCache=i.pairsCache}function n(t,e,i){this.chr=t,this.bpStart=e,this.length=i-e,this.coverage=new Array(this.length),this.maximum=0,this.threshold=.2,this.qualityWeight=!0}function a(){this.posA=0,this.negA=0,this.posT=0,this.negT=0,this.posC=0,this.negC=0,this.posG=0,this.negG=0,this.posN=0,this.negN=0,this.pos=0,this.neg=0,this.qualA=0,this.qualT=0,this.qualC=0,this.qualG=0,this.qualN=0,this.qual=0,this.total=0}return t.AlignmentContainer=function(t,e,i,a,o,s){this.chr=t,this.start=e,this.end=i,this.length=i-e,this.coverageMap=new n(t,e,i),this.alignments=[],this.downsampledIntervals=[],this.samplingWindowSize=void 0===a?100:a,this.samplingDepth=void 0===o?50:o,this.pairsSupported=s,this.paired=!1,this.pairsCache={},this.downsampledReads=new Set,this.currentBucket=new r(this.start,this.start+this.samplingWindowSize,this),this.filter=function(t){return t.isMapped()&&!t.isFailsVendorQualityCheck()}},t.AlignmentContainer.prototype.push=function(t){this.filter(t)!==!1&&(this.coverageMap.incCounts(t),this.pairsSupported&&this.downsampledReads.has(t.readName)||(t.start>=this.currentBucket.end&&(i.call(this),this.currentBucket=new r(t.start,t.start+this.samplingWindowSize,this)),this.currentBucket.addAlignment(t)))},t.AlignmentContainer.prototype.forEach=function(t){this.alignments.forEach(t)},t.AlignmentContainer.prototype.finish=function(){if(void 0!==this.currentBucket&&i.call(this),this.pairsSupported){var t=[],e=this.downsampledReads;this.alignments.forEach(function(i){e.has(i.readName)||t.push(i)}),this.alignments=t}this.alignments.sort(function(t,e){return t.start-e.start}),this.pairsCache=void 0,this.downsampledReads=void 0},t.AlignmentContainer.prototype.contains=function(t,e,i){return this.chr==t&&this.start<=e&&this.end>=i},t.AlignmentContainer.prototype.hasDownsampledIntervals=function(){return this.downsampledIntervals&&this.downsampledIntervals.length>0},r.prototype.addAlignment=function(i){var r,n,a,o;this.alignments.length<this.samplingDepth?this.pairsSupported&&e(i)?(o=this.pairsCache[i.readName],o?(o.setSecondAlignment(i),this.pairsCache[i.readName]=void 0):(o=new t.PairedAlignment(i),this.paired=!0,this.pairsCache[i.readName]=o,this.alignments.push(o))):this.alignments.push(i):(r=this.samplingDepth/(this.samplingDepth+this.downsampledCount+1),Math.random()<r?(n=Math.floor(Math.random()*(this.alignments.length-1)),a=this.alignments[n],this.pairsSupported&&e(i)?(void 0!==this.pairsCache[a.readName]&&(this.pairsCache[a.readName]=void 0),o=new t.PairedAlignment(i),this.paired=!0,this.pairsCache[i.readName]=o,this.alignments[n]=o):this.alignments[n]=i,this.downsampledReads.add(a.readName)):this.downsampledReads.add(i.readName),this.downsampledCount++)},n.prototype.incCounts=function(t){function e(e){var r,n,o,s,h;for(o=e.start-i.bpStart,s=0;s<e.len;o++,s++)i.coverage[o]||(i.coverage[o]=new a),n=e.seq.charAt(s),r=t.strand?"pos"+n:"neg"+n,h=e.qual[s],i.coverage[o][r]+=1,i.coverage[o]["qual"+n]+=h,i.coverage[o].total+=1,i.coverage[o].qual+=h,i.maximum=Math.max(i.coverage[o].total,i.maximum)}var i=this;void 0===t.blocks?e(t):t.blocks.forEach(function(t){e(t)})},a.prototype.isMismatch=function(e){var i,r=this,n=t.CoverageMap.threshold*(t.CoverageMap.qualityWeight&&this.qual?this.qual:this.total);return i=0,["A","T","C","G"].forEach(function(n){n!==e&&(i+=t.CoverageMap.qualityWeight&&r.qual?r["qual"+n]:r["pos"+n]+r["neg"+n])}),i>=n},DownsampledInterval=function(t,e,i){this.start=t,this.end=e,this.counts=i},DownsampledInterval.prototype.popupData=function(t){return[{name:"start",value:this.start+1},{name:"end",value:this.end},{name:"# downsampled:",value:this.counts}]},t}(igv||{}),igv=function(t){function e(t,e){return t[e+3]<<24|t[e+2]<<16|t[e+1]<<8|t[e]}function i(t,e){return t[e+1]<<8|t[e]}function r(t,e){var i=new DataView(t.buffer),r=!0;return i.getFloat32(e,r)}var n=1,a=2,o=4,s=8,h=16,l=32,c=64,u=128,d=256,p=512,f=1024,g=2048;return t.BamAlignment=function(){this.hidden=!1},t.BamAlignment.prototype.isMapped=function(){return 0==(this.flags&o)},t.BamAlignment.prototype.isPaired=function(){return 0!=(this.flags&n)},t.BamAlignment.prototype.isProperPair=function(){return 0!=(this.flags&a)},t.BamAlignment.prototype.isFirstOfPair=function(){return 0!=(this.flags&c)},t.BamAlignment.prototype.isSecondOfPair=function(){return 0!=(this.flags&u)},t.BamAlignment.prototype.isSecondary=function(){return 0!=(this.flags&d)},t.BamAlignment.prototype.isSupplementary=function(){return 0!=(this.flags&g)},t.BamAlignment.prototype.isFailsVendorQualityCheck=function(){return 0!=(this.flags&p)},t.BamAlignment.prototype.isDuplicate=function(){return 0!=(this.flags&f)},t.BamAlignment.prototype.isMateMapped=function(){return 0==(this.flags&s)},t.BamAlignment.prototype.isNegativeStrand=function(){return 0!=(this.flags&h)},t.BamAlignment.prototype.isMateNegativeStrand=function(){return 0!=(this.flags&l)},t.BamAlignment.prototype.tags=function(){function t(t){for(var n=0,a=t.length,o={};n<a;){var s,h=String.fromCharCode(t[n])+String.fromCharCode(t[n+1]),l=String.fromCharCode(t[n+2]);if("A"==l)s=String.fromCharCode(t[n+3]),n+=4;else if("i"===l||"I"===l)s=e(t,n+3),n+=7;else if("c"===l||"C"===l)s=t[n+3],n+=4;else if("s"===l||"S"===l)s=i(t,n+3),n+=5;else if("f"===l)s=r(t,n+3),n+=7;else{if("Z"!==l){s="Error unknown type: "+l,o[h]=s;break}for(n+=3,s="";;){var c=t[n++];if(0===c)break;s+=String.fromCharCode(c)}}o[h]=s}return o}return this.tagDict||(this.tagBA?(this.tagDict=t(this.tagBA),this.tagBA=void 0):this.tagDict={}),this.tagDict},t.BamAlignment.prototype.popupData=function(e){function i(t){return t?"Yes":"No"}var r,n,a=[];if(this.insertions)for(var o=0;o<this.insertions.length;o+=1){var s=this.insertions[o].start;if(e==s||e==s-1)return a.push({name:"Insertion",value:this.insertions[o].seq}),a.push({name:"Location",value:s}),a}a.push({name:"Read Name",value:this.readName}),a.push("<hr>"),a.push({name:"Alignment Start",value:t.numberFormatter(1+this.start),borderTop:!0}),a.push({name:"Read Strand",value:!0===this.strand?"(+)":"(-)",borderTop:!0}),a.push({name:"Cigar",value:this.cigar}),a.push({name:"Mapped",value:i(this.isMapped())}),a.push({name:"Mapping Quality",value:this.mq}),a.push({name:"Secondary",value:i(this.isSecondary())}),a.push({name:"Supplementary",value:i(this.isSupplementary())}),a.push({name:"Duplicate",value:i(this.isDuplicate())}),a.push({name:"Failed QC",value:i(this.isFailsVendorQualityCheck())}),this.isPaired()&&(a.push("<hr>"),a.push({name:"First in Pair",value:!this.isSecondOfPair(),borderTop:!0}),a.push({name:"Mate is Mapped",value:i(this.isMateMapped())}),this.isMapped()&&(a.push({name:"Mate Chromosome",value:this.mate.chr}),a.push({name:"Mate Start",value:this.mate.position+1}),a.push({name:"Mate Strand",value:!0===this.mate.strand?"(+)":"(-)"}),a.push({name:"Insert Size",value:this.fragmentLength}))),a.push("<hr>"),n=this.tags(),r=!0;for(var h in n)n.hasOwnProperty(h)&&(r?(a.push({name:h,value:n[h],borderTop:!0}),r=!1):a.push({name:h,value:n[h]}));return a},t.BamFilter=function(t){t||(t={}),this.vendorFailed=void 0===t.vendorFailed||t.vendorFailed,this.duplicates=void 0===t.duplicates||t.duplicates,this.secondary=t.secondary||!1,this.supplementary=t.supplementary||!1,this.mqThreshold=void 0===t.mqThreshold?0:t.mqThreshold},t.BamFilter.prototype.pass=function(t){return(!this.vendorFailed||!t.isFailsVendorQualityCheck())&&((!this.duplicates||!t.isDuplicate())&&((!this.secondary||!t.isSecondary())&&((!this.supplementary||!t.isSupplementary())&&!(t.mq<this.mqThreshold))))},t}(igv||{}),igv=function(t){return t.BamAlignmentRow=function(){this.alignments=[],this.score=void 0},t.BamAlignmentRow.prototype.findCenterAlignment=function(t,e){var i=void 0;return this.alignments.forEach(function(r){void 0===i&&(r.start+r.lengthOnRef<t||r.start>e||(i=r))}),i},t.BamAlignmentRow.prototype.updateScore=function(t,e,i){this.score=this.caculateScore(t,1+t,e,i)},t.BamAlignmentRow.prototype.caculateScore=function(t,e,i,r){var n,a;return a=this.findCenterAlignment(t,e),void 0===a?Number.MAX_VALUE:"NUCLEOTIDE"===r.sort?(n=void 0,a.blocks.forEach(function(e){var r,a,o,s,h,l=i.sequence,c=i.coverageMap;if("*"!==e.seq)for(var u=0,d=e.start-i.start,p=e.start,f=e.seq.length;u<f;u++,d++,p++)t===p&&(r=l.charAt(d),a=e.seq.charAt(u),"="===a&&(a=r),"N"===a?n=2:a===r?n=3:"X"===a||a!==r?(o=c.coverage[p-c.bpStart],s=o["pos"+a]+o["neg"+a],h=o.qual?o.qual:0,n=-(s+h/1e3)):console.log("BamAlignmentRow.caculateScore - huh?"));else n=3}),void 0===n?Number.MAX_VALUE:n):"STRAND"===r.sort?a.strand?1:-1:"START"===r.sort?a.start:Number.MAX_VALUE},t}(igv||{}),igv=function(t){function e(t,e){var i,r=[];for(e>=1<<29&&(e=1<<29),--e,r.push(0),i=1+(t>>26);i<=1+(e>>26);++i)r.push(i);for(i=9+(t>>23);i<=9+(e>>23);++i)r.push(i);for(i=73+(t>>20);i<=73+(e>>20);++i)r.push(i);for(i=585+(t>>17);i<=585+(e>>17);++i)r.push(i);for(i=4681+(t>>14);i<=4681+(e>>14);++i)r.push(i);return r}const i=21578050,r=21578324;return t.loadBamIndex=function(e,n,a){return new Promise(function(o,s){var h=t.browser?t.browser.genome:null;igvxhr.loadArrayBuffer(e,{headers:n.headers,withCredentials:n.withCredentials}).then(function(n){var s,l,c,u,d,p,f,g,v,m,b,y,w,k,x=[],S=Number.MAX_VALUE,_=0;if(!n)return void o(null);if(a){var C=new Zlib.Gunzip(new Uint8Array(n));n=C.decompress().buffer}if(d=new t.BinaryParser(new DataView(n)),s=d.getInt(),!(s===i||a&&s===r))throw new Error(e+" is not a "+(a?"tabix":"bai")+" file");if(u=d.getInt(),a){d.getInt(),d.getInt(),d.getInt(),d.getInt(),d.getInt(),d.getInt(),d.getInt();for(k={},y=0;y<u;y++){var T=d.getString();h&&(T=h.getChromosomeName(T)),k[T]=y}}for(w=0;w<u;++w){for(p={},f=[],l=d.getInt(),b=0;b<l;++b)if(g=d.getInt(),37450==g){A=d.getInt(),v=d.getVPointer(),m=d.getVPointer();d.getLong(),d.getLong()}else{p[g]=[];var A=d.getInt();for(y=0;y<A;y++)v=d.getVPointer(),m=d.getVPointer(),v&&m&&(v.block<S&&(S=v.block),m.block>_&&(_=m.block),p[g].push([v,m]))}for(c=d.getInt(),y=0;y<c;y++)v=d.getVPointer(),f.push(v);l>0&&(x[w]={binIndex:p,linearIndex:f})}o(new t.BamIndex(x,S,k,a))}).catch(s)})},t.BamIndex=function(t,e,i,r){this.firstAlignmentBlock=e,this.indices=t,this.sequenceIndexMap=i,this.tabix=r},t.BamIndex.prototype.blocksForRange=function(t,i,r){var n,a,o,s,h,l,c,u,d,p,f,g,v,m=this,b=m.indices[t];if(b){for(n=e(i,r),a=[],o=[],n.forEach(function(t){if(b.binIndex[t])for(var e=b.binIndex[t],i=e.length,r=0;r<i;++r){var n=e[r][0],s=e[r][1];(t<4681?o:a).push({minv:n,maxv:s,bin:t})}}),s=b.linearIndex.length,h=null,l=Math.min(i>>14,s-1),maxLin=Math.min(r>>14,s-1),d=l;d<=maxLin;++d)c=b.linearIndex[d],c&&(!h||c.block<h.block||c.offset<h.offset)&&(h=c);if(u=[],null!=h)for(d=0;d<o.length;++d)p=o[d],(p.maxv.block>h.block||p.maxv.block==h.block&&p.maxv.offset>=h.offset)&&u.push(p);for(g=[],d=0;d<u.length;++d)g.push(u[d]);for(d=0;d<a.length;++d)g.push(a[d]);if(g.sort(function(t,e){return f=t.minv.block-e.minv.block,0!=f?f:t.minv.offset-e.minv.offset}),v=[],g.length>0){for(var y=g[0],d=1;d<g.length;++d){var w=g[d];w.minv.block-y.maxv.block<65e3?y={minv:y.minv,maxv:w.maxv}:(v.push(y),y=w)}v.push(y)}return v}return[]},t}(igv||{}),igv=function(t){function e(e){return new Promise(function(i,r){e.index?i(e.index):t.loadBamIndex(e.baiPath,e.config).then(function(t){e.index=t,i(e.index)}).catch(r)})}function i(t){return new Promise(function(e,i){t.chrToIndex?e(t.chrToIndex):t.readHeader().then(function(){e(t.chrToIndex)}).catch(i)})}function r(t,e){return t[e+3]<<24|t[e+2]<<16|t[e+1]<<8|t[e]}var n=["=","A","C","x","G","x","x","x","T","x","x","x","x","x","x","N"],a=["M","I","D","N","S","H","P","=","X","?","?","?","?","?","?","?"],o=16,s=32;const h=65536,l=100,c=50,u=2500;return t.BamReader=function(e){this.config=e,this.filter=e.filter||new t.BamFilter,this.bamPath=e.url,this.baiPath=e.indexURL||this.bamPath+".bai",this.headPath=e.headURL||this.bamPath,this.samplingWindowSize=void 0===e.samplingWindowSize?l:e.samplingWindowSize,this.samplingDepth=void 0===e.samplingDepth?c:e.samplingDepth,this.samplingDepth>u&&(t.log("Warning: attempt to set sampling depth > maximum value of 2500"),this.samplingDepth=u),e.viewAsPairs?this.pairsSupported=!0:this.pairsSupported=void 0===e.pairsSupported||e.pairsSupported},t.BamReader.prototype.readAlignments=function(l,c,u){function d(e,i,h,l,c,u,d){for(var g,v,m,b,y,w,k,x,S,_,C,T,A,E,P,R,I,M,D,F,$,B,L,O,N;;){if(g=r(e,i),v=i+g+4,v>e.length)return;if(m=new t.BamAlignment,y=r(e,i+4),w=r(e,i+8),y<0)return;if(y>u||w>c)return;if(!(y<u)){for(k=r(e,i+12),x=(4294901760&k)>>16,S=(65280&k)>>8,_=255&k,C=r(e,i+16),T=(4294901760&C)>>16,A=65535&C,m.flags=T,m.strand=!(T&o),E=r(e,i+20),P=r(e,i+24),R=r(e,i+28),m.fragmentLength=r(e,i+32),I="",M=0;M<_-1;++M)I+=String.fromCharCode(e[i+36+M]);for(D=i+36+_,F=0,$="",L=[],B=0;B<A;++B){var H=r(e,D),V=H>>4,U=a[15&H];"M"!=U&&"EQ"!=U&&"X"!=U&&"D"!=U&&"N"!=U&&"="!=U||(F+=V),$=$+V+U,D+=4,L.push({len:V,ltr:U})}if(m.cigar=$,m.lengthOnRef=F,!(m.start+m.lengthOnRef<l)){for(O="",N=E+1>>1,M=0;M<N;++M){var G=e[D+M];O+=n[(240&G)>>4],O+=n[15&G]}if(O=O.substring(0,E),D+=N,m.seq=O,1===E&&"*"===String.fromCharCode(e[D+M]+33));else for(m.qual=[],M=0;M<E;++M)m.qual.push(e[D+M]);D+=E,m.start=w,m.mq=S,m.readName=I,m.chr=f.indexToChr[y],P>=0&&(m.mate={chr:f.indexToChr[P],position:R,strand:!(T&s)}),m.tagBA=new Uint8Array(e.buffer.slice(D,v)),D+=v,(!l||m.start<=c&&m.start+m.lengthOnRef>=l&&d.pass(m))&&(void 0!==u&&y!=u||(b=p(m,L),m.blocks=b.blocks,m.insertions=b.insertions,h.push(m))),i=v}}}}function p(t,e){for(var i,r,n,a,o=[],s=0,h=t.start,l=e.length,c=0;c<l;c++){var u=e[c];switch(u.ltr){case"H":break;case"P":break;case"S":s+=u.len,a="S";break;case"N":h+=u.len,a="N";break;case"D":h+=u.len,a="D";break;case"I":r="*"===t.seq?"*":t.seq.substr(s,u.len),n=t.qual?t.qual.slice(s,u.len):void 0,void 0===i&&(i=[]),i.push({start:h,len:u.len,seq:r,qual:n}),s+=u.len;break;case"M":case"EQ":case"=":case"X":r="*"===t.seq?"*":t.seq.substr(s,u.len),n=t.qual?t.qual.slice(s,u.len):void 0,o.push({start:h,len:u.len,seq:r,qual:n,gapType:a}),s+=u.len,h+=u.len;break;default:console.log("Error processing cigar element: "+u.len+u.ltr)}}return{blocks:o,insertions:i}}var f=this;return new Promise(function(r,n){i(f).then(function(i){var a=i[l],o=new t.AlignmentContainer(l,c,u,f.samplingWindowSize,f.samplingDepth,f.pairsSupported);void 0===a?r(o):e(f).then(function(e){var i=e.blocksForRange(a,c,u),s=[];return i?0===i.length?void r(o):(i.forEach(function(e){s.push(new Promise(function(i,r){var n=e.minv.block,s=e.maxv.block+h,l={start:n,size:s-n+1};igvxhr.loadArrayBuffer(f.bamPath,{headers:f.config.headers,range:l,withCredentials:f.config.withCredentials}).then(function(r){var n=new Uint8Array(t.unbgzf(r));d(n,e.minv.offset,o,c,u,a,f.filter),i(o)}).catch(function(t){r(t)})}))}),void Promise.all(s).then(function(t){o.finish(),r(o)}).catch(function(t){n(t)})):(r(null),void n("Error reading bam index"))}).catch(n)}).catch(n)})},t.BamReader.prototype.readHeader=function(){var i=this;return new Promise(function(n,a){e(i).then(function(e){var o=e.firstAlignmentBlock+h;igvxhr.loadArrayBuffer(i.bamPath,{headers:i.config.headers,range:{start:0,size:o},withCredentials:i.config.withCredentials}).then(function(e){for(var a=t.unbgzf(e,o),s=new Uint8Array(a),h=(r(s,0),r(s,4)),l="",c=t.browser?t.browser.genome:null,u=0;u<h;++u)l+=String.fromCharCode(s[u+8]);var d=r(s,h+8),p=h+12;i.chrToIndex={},i.indexToChr=[];for(var u=0;u<d;++u){for(var f=r(s,p),g="",v=0;v<f-1;++v)g+=String.fromCharCode(s[p+4+v]);r(s,p+f+4);c&&c.getChromosomeName&&(g=c.getChromosomeName(g)),i.chrToIndex[g]=u,i.indexToChr.push(g),p=p+8+f}n()}).catch(a)}).catch(a)})},t}(igv||{}),igv=function(t){function e(e){var i={},n=[];return e.forEach(function(e){e.alignments.forEach(function(e){var a;r(e)?(a=i[e.readName],a?(a.setSecondAlignment(e),i[e.readName]=void 0):(a=new t.PairedAlignment(e),i[e.readName]=a,n.push(a))):n.push(e)})}),n}function i(e){var i=[];return e.forEach(function(e){e.alignments.forEach(function(e){e instanceof t.PairedAlignment?(e.firstAlignment&&i.push(e.firstAlignment),e.secondAlignment&&i.push(e.secondAlignment)):i.push(e)})}),i}function r(t){return t.isPaired()&&t.isMateMapped()&&t.chr===t.mate.chr&&(t.isFirstOfPair()||t.isSecondOfPair())&&!(t.isSecondary()||t.isSupplementary())}function n(e,i,r,n){if(e){if(e.sort(function(t,e){return t.start-e.start}),0===e.length)return[];var a,o,s,h,l=[],c=0,u=0,d=i,p=8,f=[],g=Math.max(i,e[0].start);for(e.forEach(function(t){var e=Math.max(0,t.start-g);void 0===l[e]&&(l[e]=[]),l[e].push(t)});c<e.length&&f.length<n;){for(a=new t.BamAlignmentRow;d<=r;){for(s=void 0;!s&&d<=r;)o=d-g,void 0===l[o]?++d:s=l[o];if(!s)break;h=s.pop(),0===s.length&&(l[o]=void 0),a.alignments.push(h),d=h.start+h.lengthOnRef+p,++c}if(a.alignments.length>0&&f.push(a),d=g,c===u)break;u=c}return f}}return t.BamSource=function(e){this.config=e,this.alignmentContainer=void 0,this.maxRows=e.maxRows||1e3,"ga4gh"===e.sourceType?this.bamReader=new t.Ga4ghAlignmentReader(e):this.bamReader=new t.BamReader(e),this.viewAsPairs=e.viewAsPairs},t.BamSource.prototype.setViewAsPairs=function(t){var r=this;if(this.viewAsPairs!==t&&(this.viewAsPairs=t,this.alignmentContainer)){var a,o=this.alignmentContainer;a=t?e(o.packedAlignmentRows):i(o.packedAlignmentRows),o.packedAlignmentRows=n(a,o.start,o.end,r.maxRows)}},t.BamSource.prototype.getAlignments=function(e,r,a){var o=this;return new Promise(function(s,h){o.alignmentContainer&&o.alignmentContainer.contains(e,r,a)?s(o.alignmentContainer):o.bamReader.readAlignments(e,r,a).then(function(e){var r=o.config.maxRows||500,a=e.alignments;o.viewAsPairs||(a=i([{alignments:a}])),e.packedAlignmentRows=n(a,e.start,e.end,r),e.alignments=void 0,o.alignmentContainer=e,t.browser.genome.sequence.getSequence(e.chr,e.start,e.end).then(function(t){t&&(e.coverageMap.refSeq=t,e.sequence=t,s(e))}).catch(h)}).catch(h)})},t}(igv||{}),igv=function(t){function e(e,i,r){var n,a,o=5,s=20,h=t.nucleotideColorComponents[i];if(h)return a=e<o?.1:Math.max(.1,Math.min(1,.1+.9*(e-o)/(s-o))),a=Math.round(10*a)/10,n=a>=1?t.nucleotideColors[i]:"rgba("+h[0]+","+h[1]+","+h[2]+","+a+")"}function i(e){var i,r,n=this,a=n.colorBy;switch(r=n.parent.color,a){case"strand":r=e.strand?n.posStrandColor:n.negStrandColor;break;case"firstOfPairStrand":e instanceof t.PairedAlignment?r=e.firstOfPairStrand()?n.posStrandColor:n.negStrandColor:e.isPaired()&&(e.isFirstOfPair()?r=e.strand?n.posStrandColor:n.negStrandColor:e.isSecondOfPair()?r=e.strand?n.negStrandColor:n.posStrandColor:console.log("ERROR. Paired alignments are either first or second."));break;case"tag":i=e.tags()[n.colorByTag],void 0!==i&&(r=n.bamColorTag===n.colorByTag?"rgb("+i+")":n.tagColors.getColor(i));break;default:r=n.parent.color}return r}var r=0,n=5,a=5;const o=50;return t.BAMTrack=function(e){this.featureSource=new t.BamSource(e),t.configTrack(this,e),void 0===e.coverageTrackHeight&&(e.coverageTrackHeight=o),this.coverageTrack=new CoverageTrack(e,this),this.alignmentTrack=new AlignmentTrack(e,this),this.visibilityWindow=e.visibilityWindow||3e4,this.viewAsPairs=e.viewAsPairs,this.pairsSupported=void 0===e.pairsSupported,this.color=e.color||"rgb(185, 185, 185)",this.sortOption=e.sortOption||{sort:"NUCLEOTIDE"},this.sortDirection=!0,this.filterOption=e.filterOption||{name:"mappingQuality",params:[30,void 0]}},t.BAMTrack.prototype.getFeatures=function(t,e,i){return this.featureSource.getAlignments(t,e,i)},t.BAMTrack.filters={noop:function(){return function(t){return!1}},strand:function(t){return function(e){return e.strand===t}},mappingQuality:function(t,e){return function(i){return!!(t&&i.mq<t)||!!(e&&i.mq>e)}}},t.BAMTrack.prototype.altClick=function(t,e){this.alignmentTrack.sortAlignmentRows(t,this.sortOption),this.trackView.redrawTile(this.featureSource.alignmentContainer),$(this.trackView.viewportDiv).scrollTop(0),this.sortDirection=!this.sortDirection},t.BAMTrack.prototype.computePixelHeight=function(t){return this.coverageTrack.computePixelHeight(t)+this.alignmentTrack.computePixelHeight(t)},t.BAMTrack.prototype.draw=function(t){this.coverageTrack.height>0&&this.coverageTrack.draw(t),this.alignmentTrack.draw(t)},t.BAMTrack.prototype.paintAxis=function(t,e,i){this.coverageTrack.paintAxis(t,e,this.coverageTrackHeight)},t.BAMTrack.prototype.popupData=function(t,e,i){return i>=this.coverageTrack.top&&i<this.coverageTrack.height?this.coverageTrack.popupData(t,e,this.coverageTrack.top):this.alignmentTrack.popupData(t,e,i-this.alignmentTrack.top)},t.BAMTrack.prototype.popupMenuItems=function(e){function i(e,i,r){var n=[],o={};return n.push('<div class="igv-track-menu-item">'),n.push(i?'<i class="fa fa-check fa-check-shim"></i>':'<i class="fa fa-check fa-check-shim fa-check-hidden"></i>'),"tag"===e.key?n.push('<span id="color-by-tag">'):n.push("<span>"),n.push(e.label),n.push("</span>"),n.push("</div>"),o.object=$(n.join("")),o.click=function(){t.popover.hide(),"tag"===e.key?(t.dialog.configure(function(){return"Tag Name"},a.alignmentTrack.colorByTag?a.alignmentTrack.colorByTag:"",function(){var e=t.dialog.$dialogInput.val().trim();a.alignmentTrack.colorBy="tag",e!==a.alignmentTrack.colorByTag&&(a.alignmentTrack.colorByTag=t.dialog.$dialogInput.val().trim(),a.alignmentTrack.tagColors=new t.PaletteColorTable("Set1"),$("#color-by-tag").text(a.alignmentTrack.colorByTag)),a.trackView.update()}),t.dialog.show($(a.trackView.trackDiv))):(a.alignmentTrack.colorBy=e.key,a.trackView.update())},o}var r,n,a=this,o=[],s=[],h="tag"+(a.alignmentTrack.colorByTag?" ("+a.alignmentTrack.colorByTag+")":"");return s.push({key:"none",label:"track color"}),a.viewAsPairs||s.push({key:"strand",label:"read strand"}),a.pairsSupported&&a.alignmentTrack.hasPairs&&s.push({key:"firstOfPairStrand",label:"first-of-pair strand"}),s.push({key:"tag",label:h}),o.push(t.colorPickerMenuItem(e,this.trackView)),o.push('<div class="igv-track-menu-category igv-track-menu-border-top">Color by</div>'),s.forEach(function(t){n=a.alignmentTrack.colorBy===t.key,o.push(i(t,n))}),r=[],a.pairsSupported&&a.alignmentTrack.hasPairs&&(r.push('<div class="igv-track-menu-item igv-track-menu-border-top">'),r.push(!0===a.viewAsPairs?'<i class="fa fa-check fa-check-shim">':'<i class="fa fa-check fa-check-shim fa-check-hidden">'),r.push("</i>"),r.push("View as pairs"),r.push("</div>"),o.push({object:$(r.join("")),click:function(){var t=$(this).find("i");e.hide(),a.viewAsPairs=!a.viewAsPairs,!0===a.viewAsPairs?t.removeClass("fa-check-hidden"):t.addClass("fa-check-hidden"),a.featureSource.setViewAsPairs(a.viewAsPairs),a.trackView.update()}})),o},CoverageTrack=function(e,i){this.parent=i,this.featureSource=i.featureSource,this.top=0,this.height=e.coverageTrackHeight,this.dataRange={min:0},this.paintAxis=t.paintAxis},CoverageTrack.prototype.computePixelHeight=function(t){return this.height},CoverageTrack.prototype.draw=function(e){var i,r,n,a,o,s,h,l,c,u,d,p=this,f=e.features,g=e.context,v=e.bpPerPixel,m=e.bpStart,b=e.pixelWidth,y=m+b*v+1,w=f.coverageMap;for(this.top&&g.translate(0,top),w.refSeq&&(d=w.refSeq.toUpperCase()),this.dataRange.max=w.maximum,a=Math.max(1,Math.ceil(1/v)),h=0,l=w.coverage.length;h<l;h++)if(i=w.bpStart+h,!(i<m)){if(i>y)break;c=w.coverage[h],c&&(o=Math.round(c.total/this.dataRange.max*this.height),n=this.height-o,r=Math.floor((i-m)/v),t.graphics.setProperties(g,{fillStyle:this.parent.color,strokeStyle:this.color}),t.graphics.fillRect(g,r,n,a,o))}if(d)for(h=0,l=w.coverage.length;h<l;h++)if(i=w.bpStart+h,!(i<m)){if(i>y)break;c=w.coverage[h],c&&(o=c.total/this.dataRange.max*this.height,n=this.height-o,r=Math.floor((i-m)/v),s=d[h],c.isMismatch(s)&&(t.graphics.setProperties(g,{fillStyle:t.nucleotideColors[s]}),t.graphics.fillRect(g,r,n,a,o),u=0,["A","C","T","G"].forEach(function(e){var i,o;i=c["pos"+e]+c["neg"+e],o=i/p.dataRange.max*p.height,n=p.height-o-u,u+=o,t.graphics.setProperties(g,{fillStyle:t.nucleotideColors[e]}),t.graphics.fillRect(g,r,n,a,o)})))}},CoverageTrack.prototype.popupData=function(e,i,r){var n,a,o=this.featureSource.alignmentContainer.coverageMap,s=[];return n=e-o.bpStart,a=o.coverage[n],a&&(s.push(t.browser.referenceFrame.chr+":"+t.numberFormatter(1+e)),s.push({name:"Total Count",value:a.total}),tmp=a.posA+a.negA,tmp>0&&(tmp=tmp.toString()+" ("+Math.floor((a.posA+a.negA)/a.total*100)+"%)"),s.push({name:"A",value:tmp}),tmp=a.posC+a.negC,tmp>0&&(tmp=tmp.toString()+" ("+Math.floor(tmp/a.total*100)+"%)"),s.push({name:"C",value:tmp}),tmp=a.posG+a.negG,tmp>0&&(tmp=tmp.toString()+" ("+Math.floor(tmp/a.total*100)+"%)"),s.push({name:"G",value:tmp}),tmp=a.posT+a.negT,tmp>0&&(tmp=tmp.toString()+" ("+Math.floor(tmp/a.total*100)+"%)"),s.push({name:"T",value:tmp}),tmp=a.posN+a.negN,tmp>0&&(tmp=tmp.toString()+" ("+Math.floor(tmp/a.total*100)+"%)"),s.push({name:"N",value:tmp})),s},AlignmentTrack=function(t,e){this.parent=e,this.featureSource=e.featureSource,this.top=0==t.coverageTrackHeight?0:t.coverageTrackHeight+5,this.alignmentRowHeight=t.alignmentRowHeight||14,this.negStrandColor=t.negStrandColor||"rgba(150, 150, 230, 0.75)",this.posStrandColor=t.posStrandColor||"rgba(230, 150, 150, 0.75)",this.insertionColor=t.insertionColor||"rgb(138, 94, 161)",this.deletionColor=t.deletionColor||"black",this.skippedColor=t.skippedColor||"rgb(150, 170, 170)",this.colorBy=t.colorBy||"none",this.colorByTag=t.colorByTag,this.bamColorTag=void 0===t.bamColorTag?"YC":t.bamColorTag,this.sortOption=t.sortOption||{sort:"NUCLEOTIDE"},this.sortDirection=!0,this.hasPairs=!1},AlignmentTrack.prototype.computePixelHeight=function(t){if(t.packedAlignmentRows){var e=0;return t.hasDownsampledIntervals()&&(e+=a+n),e+this.alignmentRowHeight*t.packedAlignmentRows.length+5}return this.height},AlignmentTrack.prototype.draw=function(o){function s(e,r,n){var a=i.call(l,e.firstAlignment),o=a,s=(e.connectingStart-p)/d,h=(e.connectingEnd-p)/d,c=r+n/2;e.connectingEnd<p||e.connectingStart>g||(e.mq<=0&&(a=t.addAlphaToRGB(a,"0.15")),t.graphics.setProperties(u,{fillStyle:a,strokeStyle:o}),t.graphics.strokeLine(u,s,c,h,c))}function h(r,n,a){function o(i){var o,h,g,w,k,x,S,_,C,T=i.start-c.start,A=(i.start-p)/d,E=(i.start+i.len-p)/d,P=Math.max(1,E-A),R=l.alignmentRowHeight/2,I=i.seq.toUpperCase(),M=l.skippedColor,D=l.deletionColor,F=n+a/2;if(void 0!==i.gapType&&void 0!==E&&void 0!==s&&("D"===i.gapType?t.graphics.strokeLine(u,s,F,A,F,{strokeStyle:D}):t.graphics.strokeLine(u,s,F,A,F,{strokeStyle:M})),s=E,!0===r.strand&&f===y.length-1?(S=[A,E,E+R,E,A,A],_=[n,n,n+a/2,n+a,n+a,n],t.graphics.fillPolygon(u,S,_,{fillStyle:v}),r.mq<=0&&t.graphics.strokePolygon(u,S,_,{strokeStyle:b})):!1===r.strand&&0===f?(S=[E,A,A-R,A,E,E],_=[n,n,n+a/2,n+a,n+a,n],t.graphics.fillPolygon(u,S,_,{fillStyle:v}),r.mq<=0&&t.graphics.strokePolygon(u,S,_,{strokeStyle:b})):(t.graphics.fillRect(u,A,n,P,a,{fillStyle:v}),r.mq<=0&&(u.save(),u.strokeStyle=b,u.strokeRect(A,n,P,a),u.restore())),m&&"*"!==I)for(C=0,len=I.length;C<len;C++)h=I.charAt(C),o=m.charAt(T+C),"="===h&&(h=o),"X"!==h&&o===h||(i.qual&&i.qual.length>C?(g=i.qual[C],x=e(g,h,C+i.start)):x=t.nucleotideColors[h],x&&(w=(i.start+C-p)/d,k=Math.max(1,1/d),t.graphics.fillRect(u,w,n,k,a,{fillStyle:x})))}var s,h,f,v=i.call(l,r),b=v,y=r.blocks;if(!(r.start+r.lengthOnRef<p||r.start>g))for(r.mq<=0&&(v=t.addAlphaToRGB(v,"0.15")),t.graphics.setProperties(u,{fillStyle:v,strokeStyle:b}),f=0;f<y.length;f++)if(h=y[f],!(h.start+h.len<p)){if(o(h),h.start+h.len>g)break;r.insertions&&r.insertions.forEach(function(e){var i=e.start-p,r=i/d-1,o=3;t.graphics.fillRect(u,r,n-1,o,a+2,{fillStyle:l.insertionColor})})}}var l=this,c=o.features,u=o.context,d=o.bpPerPixel,p=o.bpStart,f=o.pixelWidth,g=p+f*d+1,v=c.packedAlignmentRows,m=c.sequence;this.top&&u.translate(0,this.top),m&&(m=m.toUpperCase()),c.hasDownsampledIntervals()?(r=a+n,c.downsampledIntervals.forEach(function(e){var i=(e.start-p)/d,r=(e.end-p)/d;r-i>5&&(i+=1,r-=1),t.graphics.fillRect(u,i,2,r-i,a-2,{fillStyle:"black"})})):r=0,v&&v.forEach(function(e,i){var i,n,a=r+l.alignmentRowHeight*i,o=l.alignmentRowHeight-2;for(i=0;i<e.alignments.length;i++)if(n=e.alignments[i],l.hasPairs=l.hasPairs||n.isPaired(),!(n.start+n.lengthOnRef<p)){if(n.start>g)break;!0!==n.hidden&&(n instanceof t.PairedAlignment?(s(n,a,o),h(n.firstAlignment,a,o),n.secondAlignment&&h(n.secondAlignment,a,o)):h(n,a,o))}})},AlignmentTrack.prototype.sortAlignmentRows=function(t,e){var i=this,r=this.featureSource.alignmentContainer,n=r.packedAlignmentRows;n.forEach(function(i){i.updateScore(t,r,e)}),n.sort(function(t,e){return i.sortDirection?t.score-e.score:e.score-t.score})},AlignmentTrack.prototype.popupData=function(t,e,i){var n,a,o,s,h,l,c=this.featureSource.alignmentContainer.packedAlignmentRows,u=this.featureSource.alignmentContainer.downsampledIntervals;if(n=Math.floor((i-r)/this.alignmentRowHeight),
n<0){for(s=0,h=u.length;s<h;s++)if(u[s].start<=t&&u[s].end>=t){o=u[s];break}}else if(n<c.length)for(a=c[n],o=void 0,s=0,h=a.alignments.length,l;s<h;s++)if(l=a.alignments[s],l.start<=t&&l.start+l.lengthOnRef>=t){o=l;break}return o?o.popupData(t):[]},t}(igv||{}),igv=function(t){var e=18;return t.unbgzf=function(t,e){var i=[],r=[0],n=0;for(e=e||t.byteLength-18;r[0]<e;){var a=new Uint8Array(t,r[0],18),o=a[11]<<8|a[10],s=(a[12],a[13],a[15]<<8|a[14],a[17]<<8|a[16]+1),h=12+o+r[0],l=t.byteLength-h;if(l<s+8)break;var c=jszlib_inflate_buffer(t,h,l,r);r[0]+=8,n+=c.byteLength,i.push(c)}if(1==i.length)return i[0];for(var u=new Uint8Array(n),d=0,p=0;p<i.length;++p){var f=new Uint8Array(i[p]);arrayCopy(f,0,u,d,f.length),d+=f.length}return u.buffer},t.BGZFile=function(t){this.filePosition=0,this.config=t},t.BGZFile.prototype.nextBlock=function(){var t=this;return new Promise(function(i,r){igvxhr.loadArrayBuffer(t.path,{headers:t.config.headers,range:{start:t.filePosition,size:e},withCredentials:t.config.withCredentials}).then(function(n){var a=new Uint8Array(n),o=(a[11]<<8|a[10],a[12],a[13],a[15]<<8|a[14],a[17]<<8|a[16]+1);t.filePosition+=e,igvxhr.loadArrayBuffer(t.path,{headers:t.config.headers,range:{start:t.filePosition,size:o},withCredentials:t.config.withCredentials}).then(function(e){var r=jszlib_inflate_buffer(e);t.filePosition+=o+8,i(r)}).catch(r)}).catch(r)})},t}(igv||{}),igv=function(t){function e(){this.posA=0,this.negA=0,this.posT=0,this.negT=0,this.posC=0,this.negC=0,this.posG=0,this.negG=0,this.posN=0,this.negN=0,this.pos=0,this.neg=0,this.qualA=0,this.qualT=0,this.qualC=0,this.qualG=0,this.qualN=0,this.qual=0,this.total=0}return t.CoverageMap=function(t,i,r,n,a){var o=this;this.refSeq=a,this.chr=t,this.bpStart=i,this.length=r-i,this.coverage=new Array(this.length),this.maximum=0,n.forEach(function(t){t.blocks.forEach(function(i){var r,n,a,s,h;for(a=i.start-o.bpStart,s=0;s<i.len;a++,s++)o.coverage[a]||(o.coverage[a]=new e),n=i.seq.charAt(s),r=t.strand?"pos"+n:"neg"+n,h=i.qual[s],o.coverage[a][r]+=1,o.coverage[a]["qual"+n]+=h,o.coverage[a].total+=1,o.coverage[a].qual+=h,o.maximum=Math.max(o.coverage[a].total,o.maximum)})})},t.CoverageMap.threshold=.2,t.CoverageMap.qualityWeight=!0,e.prototype.isMismatch=function(e){var i,r=this,n=t.CoverageMap.threshold*(t.CoverageMap.qualityWeight&&this.qual?this.qual:this.total);return i=0,["A","T","C","G"].forEach(function(n){n!==e&&(i+=t.CoverageMap.qualityWeight&&r.qual?r["qual"+n]:r["pos"+n]+r["neg"+n])}),i>=n},t}(igv||{}),igv=function(t){return t.PairedAlignment=function(t){this.firstAlignment=t,this.chr=t.chr,this.readName=t.readName,t.start<t.mate.position?(this.start=t.start,this.end=Math.max(t.mate.position,t.start+t.lengthOnRef),this.connectingStart=t.start+t.lengthOnRef,this.connectingEnd=t.mate.position):(this.start=t.mate.position,this.end=t.start+t.lengthOnRef,this.connectingStart=t.mate.position,this.connectingEnd=t.start),this.lengthOnRef=this.end-this.start},t.PairedAlignment.prototype.setSecondAlignment=function(t){this.secondAlignment=t,t.start>this.firstAlignment.start?(this.end=t.start+t.lengthOnRef,this.connectingEnd=t.start):(this.start=t.start,this.connectingStart=t.start+t.lengthOnRef),this.lengthOnRef=this.end-this.start},t.PairedAlignment.prototype.popupData=function(t){var e=[];return e=e.concat(this.firstAlignment.popupData(t)),this.secondAlignment&&(e.push("-------------------------------"),e=e.concat(this.secondAlignment.popupData(t))),e},t.PairedAlignment.prototype.isPaired=function(){return!0},t.PairedAlignment.prototype.firstOfPairStrand=function(){return this.firstAlignment.isFirstOfPair()?this.firstAlignment.strand:this.secondAlignment?this.secondAlignment.strand:this.firstAlignment.strand},t}(igv||{}),igv=function(t){return t.isb={querySegByStudy:function(t,e){var i='SELECT * FROM [isb-cgc:tcga_201510_alpha.Copy_Number_segments] WHERE ParticipantBarcode IN (SELECT ParticipantBarcode FROM [isb-cgc:tcga_201510_alpha.Clinical_data] WHERE Study = "'+t+'")';return e&&(i+=" limit "+e),i},decodeSeg:function(t){var e={};return e.ParticipantBarcode=t.f[0].v,e.Study=t.f[4].v,e.Chromosome=t.f[6].v,e.Start=t.f[7].v,e.End=t.f[8].v,e.Num_Probes=t.f[9].v,e.Segment_mean=t.f[10].v,e}},t}(igv||{}),igv=function(t){return t.BufferedReader=function(t,e,i){this.path=t.url,this.contentLength=e,this.bufferSize=i?i:512e3,this.range={start:-1,size:-1},this.config=t},t.BufferedReader.prototype.dataViewForRange=function(t,e){var i=this;return new Promise(function(r,n){function a(t,e,i){var n=t.data.byteLength,a=e.start-t.range.start,o=i?new Uint8Array(t.data,a,n-a):new DataView(t.data,a,n-a);r(o)}var o,s,h=i.data&&i.range.start<=t.start&&i.range.start+i.range.size>=t.start+t.size;h?a(i,t,e):(o=Math.max(i.bufferSize,t.size),s=i.contentLength>0&&t.start+o>i.contentLength?{start:t.start}:{start:t.start,size:o},igvxhr.loadArrayBuffer(i.path,{headers:i.config.headers,range:s,withCredentials:i.config.withCredentials}).then(function(r){i.data=r,i.range=s,a(i,t,e)}).catch(n))})},t}(igv||{}),igv=function(t){return t.BPTree=function(e,i){function r(t,e,i,a){e>=0&&(t.position=e);var o,s,h,l,c,u,d=t.getByte(),p=(t.getByte(),t.getShort());if(1==d)for(o=0;o<p;o++)s=t.getFixedLengthString(i).trim(),n&&(s=n.getChromosomeName(s)),h=t.getInt(),l=t.getInt(),a[s]=h;else for(o=0;o<p;o++)c=t.nextLong(),u=c-self.treeOffset,r(t,e,i,a)}var n=t.browser?t.browser.genome:null;this.treeOffset=i,this.header={},this.header.magic=e.getInt(),this.header.blockSize=e.getInt(),this.header.keySize=e.getInt(),this.header.valSize=e.getInt(),this.header.itemCount=e.getLong(),this.header.reserved=e.getLong(),this.dictionary={},r(e,-1,this.header.keySize,this.dictionary)},t}(igv||{}),igv=function(t){function e(t){this.items=t;var e,i,r=Number.MAX_VALUE,n=0,a=Number.MAX_VALUE,o=0;for(e=0;e<t.length;e++)i=t[e],r=Math.min(r,i.startChrom),n=Math.max(n,i.endChrom),a=Math.min(a,i.startBase),o=Math.max(o,i.endBase);this.startChrom=r,this.endChrom=n,this.startBase=a,this.endBase=o}function i(t,e,i,r){return t?(e>t.startChrom||e==t.startChrom&&r>=t.startBase)&&(e<t.endChrom||e==t.endChrom&&i<t.endBase):(console.log("null item"),!1)}var r=48,n=32;RPTREE_NODE_CHILD_ITEM_SIZE=24;var a=512e3;return t.RPTree=function(t,e,i,r){this.config=i,this.filesize=e,this.fileOffset=t,this.path=i.url,this.littleEndian=r},t.RPTree.prototype.load=function(){var e=this;return new Promise(function(i,n){var o=e.fileOffset+r,s=new t.BufferedReader(e.config,e.filesize,a);e.readNode(o,s).then(function(t){e.rootNode=t,i(e)}).catch(n)})},t.RPTree.prototype.readNode=function(i,r){var a=this;return new Promise(function(o,s){r.dataViewForRange({start:i,size:4},!1).then(function(h){var l=new t.BinaryParser(h,a.littleEndian),c=l.getByte(),u=1===c,d=(l.getByte(),l.getShort());i+=4;var p=d*(u?n:RPTREE_NODE_CHILD_ITEM_SIZE),f={start:i,size:p};r.dataViewForRange(f,!1).then(function(i){var r,n=new Array(d),a=new t.BinaryParser(i);if(u){for(r=0;r<d;r++){var s={isLeaf:!0,startChrom:a.getInt(),startBase:a.getInt(),endChrom:a.getInt(),endBase:a.getInt(),dataOffset:a.getLong(),dataSize:a.getLong()};n[r]=s}o(new e(n))}else{for(r=0;r<d;r++){var s={isLeaf:!1,startChrom:a.getInt(),startBase:a.getInt(),endChrom:a.getInt(),endBase:a.getInt(),childOffset:a.getLong()};n[r]=s}o(new e(n))}}).catch(s)}).catch(s)})},t.RPTree.prototype.findLeafItemsOverlapping=function(e,r,n){var o=this;return new Promise(function(s,h){function l(t,a){if(i(t,e,r,n)){var p=t.items;p.forEach(function(t){i(t,e,r,n)&&(t.isLeaf?c.push(t):t.childNode?l(t.childNode):(u.add(t.childOffset),o.readNode(t.childOffset,d).then(function(e){t.childNode=e,l(e,t.childOffset)}).catch(h)))})}void 0!=a&&u.delete(a),u.isEmpty()&&s(c)}var c=[],u=new Set,d=new t.BufferedReader(o.config,o.filesize,a);u.add(0),l(o.rootNode,0)})},t}(igv||{}),igv=function(t){function e(){var e=o,i=this;return new Promise(function(r,n){igvxhr.loadArrayBuffer(i.path,{headers:i.config.headers,range:{start:e,size:i.header.fullDataOffset-e+5},withCredentials:i.config.withCredentials}).then(function(n){var a,o,h,l=i.header.nZoomLevels,c=new t.BinaryParser(new DataView(n));for(i.zoomLevelHeaders=[],i.firstZoomDataOffset=Number.MAX_VALUE,a=0;a<l;a++)o=l-a,h=new s(o,c),i.firstZoomDataOffset=Math.min(h.dataOffset,i.firstZoomDataOffset),i.zoomLevelHeaders.push(h);i.header.autoSqlOffset>0&&(c.position=i.header.autoSqlOffset-e,i.autoSql=c.getString()),i.header.totalSummaryOffset>0&&(c.position=i.header.totalSummaryOffset-e,i.totalSummary=new t.BWTotalSummary(c)),i.header.chromTreeOffset>0&&(c.position=i.header.chromTreeOffset-e,i.chromTree=new t.BPTree(c,0)),c.position=i.header.fullDataOffset-e,i.dataCount=c.getInt(),r()}).catch(n)})}var i=2291137574,r=654085990,n=2273964779,a=3958540679,o=64;t.BWReader=function(t){this.path=t.url,this.headPath=t.headURL||this.path,this.rpTreeCache={},this.config=t},t.BWReader.prototype.getZoomHeaders=function(){var t=this;return new Promise(function(e,i){t.zoomLevelHeaders?e(t.zoomLevelHeaders):t.loadHeader().then(function(){e(t.zoomLevelHeaders)}).catch(function(t){i(t)})})},t.BWReader.prototype.loadHeader=function(){var s=this;return new Promise(function(h,l){igvxhr.loadArrayBuffer(s.path,{headers:s.config.headers,range:{start:0,size:o},withCredentials:s.config.withCredentials}).then(function(o){if(o){s.littleEndian=!0;var c=new t.BinaryParser(new DataView(o)),u=c.getUInt();if(u===i)s.type="BigWig";else if(u==n)s.type="BigBed";else{s.littleEndian=!1,c.littleEndian=!1,c.position=0;var u=c.getUInt();u===r?s.type="BigWig":u==a&&(s.type="BigBed")}s.header={},s.header.bwVersion=c.getShort(),s.header.nZoomLevels=c.getShort(),s.header.chromTreeOffset=c.getLong(),s.header.fullDataOffset=c.getLong(),s.header.fullIndexOffset=c.getLong(),s.header.fieldCount=c.getShort(),s.header.definedFieldCount=c.getShort(),s.header.autoSqlOffset=c.getLong(),s.header.totalSummaryOffset=c.getLong(),s.header.uncompressBuffSize=c.getInt(),s.header.reserved=c.getLong(),e.call(s).then(h).catch(l)}}).catch(function(t){l(t)})})},t.BWReader.prototype.loadRPTree=function(e){var i=this;return new Promise(function(r,n){var a=i.rpTreeCache[e];a?r(a):(a=new t.RPTree(e,i.contentLength,i.config,i.littleEndian),i.rpTreeCache[e]=a,a.load().then(function(){r(a)}).catch(n))})};var s=function(t,e){this.index=t,this.reductionLevel=e.getInt(),this.reserved=e.getInt(),this.dataOffset=e.getLong(),this.indexOffset=e.getLong()};return t}(igv||{}),igv=function(t){function e(t,e){var i,r,n=null;for(i=0;i<e.length;i++)if(r=e[i],r.reductionLevel>t){n=r;break}return null==n&&(n=e[e.length-1]),n&&n.reductionLevel<4*t?n:null}function i(e,i,r,n,a,o){var s,h=new t.BinaryParser(e),l=h.getInt(),c=h.getInt(),u=h.getInt(),d=h.getInt(),p=h.getInt(),f=h.getByte(),g=(h.getByte(),h.getShort());if(l===r)for(;g-- >0;){switch(f){case 1:c=h.getInt(),u=h.getInt(),s=h.getFloat();break;case 2:c=h.getInt(),s=h.getFloat(),u=c+p;break;case 3:s=h.getFloat(),u=c+p,c+=d}if(c>=a)break;u>n&&o.push({chr:i,start:c,end:u,value:s})}}function r(e,i,r,n,a,o){for(var s,h,l,c,u,d,p,f,g,v=new t.BinaryParser(e),m=32;v.remLength()>=m;)if(s=v.getInt(),s===r){if(h=v.getInt(),l=v.getInt(),c=v.getInt(),u=v.getFloat(),d=v.getFloat(),p=v.getFloat(),f=v.getFloat(),g=0==c?0:p/c,h>=a)break;l>n&&o.push({chr:i,start:h,end:l,value:g})}}function n(e,i,r,n,a,o){for(var s,h,l,c,u,d,p,f,g,v,m,b,y=new t.BinaryParser(e),w=13;y.remLength()>=w;)if(s=y.getInt(),s==r&&(h=y.getInt(),l=y.getInt(),c=y.getString(),d={chr:i,start:h,end:l},h<a&&l>=n&&(o.push(d),u=c.split("\t"),u.length>0&&(d.name=u[0]),u.length>1&&(d.score=parseFloat(u[1])),u.length>2&&(d.strand=u[2]),u.length>3&&(d.cdStart=parseInt(u[3])),u.length>4&&(d.cdEnd=parseInt(u[4])),u.length>5&&"."!==u[5]&&"0"!==u[5]&&(d.color=t.createColorString(u[5])),u.length>8))){p=parseInt(u[6]),f=u[7].split(","),g=u[8].split(","),v=[];for(var k=0;k<p;k++)m=start+parseInt(g[k]),b=m+parseInt(f[k]),v.push({start:m,end:b});d.exons=v}}return t.BWSource=function(e){this.reader=new t.BWReader(e),this.bufferedReader=new t.BufferedReader(e)},t.BWSource.prototype.getFeatures=function(a,o,s){var h=this;return new Promise(function(l,c){h.reader.getZoomHeaders().then(function(u){var d,p,f=h.reader,g=h.bufferedReader,v=t.browser.referenceFrame.bpPerPixel,m=e(v,u);m?(d=m.indexOffset,p=r):(d=f.header.fullIndexOffset,p="BigWig"===f.type?i:n),f.loadRPTree(d).then(function(t){var e=h.reader.chromTree.dictionary[a];void 0===e?l(null):t.findLeafItemsOverlapping(e,o,s).then(function(t){var i=[];t&&0!=t.length||l([]),t.forEach(function(t){i.push(new Promise(function(i,r){var n=[];g.dataViewForRange({start:t.dataOffset,size:t.dataSize},!0).then(function(t){var r=new Zlib.Inflate(t),h=r.decompress();p(new DataView(h.buffer),a,e,o,s,n),i(n)}).catch(r)}))}),Promise.all(i).then(function(t){var e,i=t[0];if(t.length>1){for(e=0;e<t.length;e++)i=i.concat(t[e]);i.sort(function(t,e){return t.start-e.start})}l(i)}).catch(c)}).catch(c)}).catch(c)}).catch(c)})},t}(igv||{}),igv=function(t){function e(){var t=this.basesCovered;t>0&&(this.mean=this.sumData/t,this.stddev=Math.sqrt((this.sumSquares-this.sumData/t*this.sumData)/(t-1)))}return t.BWTotalSummary=function(t){t?(this.basesCovered=t.getLong(),this.minVal=t.getDouble(),this.maxVal=t.getDouble(),this.sumData=t.getDouble(),this.sumSquares=t.getDouble(),e.call(this)):(this.basesCovered=0,this.minVal=0,this.maxVal=0,this.sumData=0,this.sumSquares=0,this.mean=0,this.stddev=0)},t.BWTotalSummary.prototype.updateStats=function(t){this.basesCovered+=t.count,this.sumData+=status.sumData,this.sumSquares+=sumSquares,this.minVal=MIN(_minVal,min),this.maxVal=MAX(_maxVal,max),e.call(this)},t}(igv||{}),igv=function(t){function e(t,e){this.block=t,this.offset=e}return t.BinaryParser=function(t,e){this.littleEndian=!e||e,this.position=0,this.view=t,this.length=t.byteLength},t.BinaryParser.prototype.remLength=function(){return this.length-this.position},t.BinaryParser.prototype.hasNext=function(){return this.position<this.length-1},t.BinaryParser.prototype.getByte=function(){var t=this.view.getUint8(this.position,this.littleEndian);return this.position++,t},t.BinaryParser.prototype.getShort=function(){var t=this.view.getInt16(this.position,this.littleEndian);return this.position+=2,t},t.BinaryParser.prototype.getInt=function(){var t=this.view.getInt32(this.position,this.littleEndian);return this.position+=4,t},t.BinaryParser.prototype.getUInt=function(){var t=this.view.getUint32(this.position,this.littleEndian);return this.position+=4,t},t.BinaryParser.prototype.getLong=function(){var t=this.view.getInt32(this.position,this.littleEndian);return this.position+=8,t},t.BinaryParser.prototype.getString=function(t){for(var e,i="";0!=(e=this.view.getUint8(this.position++))&&(i+=String.fromCharCode(e),!t||i.length!=t););return i},t.BinaryParser.prototype.getFixedLengthString=function(t){var e,i,r="";for(e=0;e<t;e++)i=this.view.getUint8(this.position++),i>0&&(r+=String.fromCharCode(i));return r},t.BinaryParser.prototype.getFloat=function(){var t=this.view.getFloat32(this.position,this.littleEndian);return this.position+=4,t},t.BinaryParser.prototype.getDouble=function(){var t=this.view.getFloat64(this.position,this.littleEndian);return this.position+=8,t},t.BinaryParser.prototype.skip=function(t){return this.position+=t,this.position},t.BinaryParser.prototype.getVPointer=function(){var t=this.position,i=this.view.getUint8(t+1)<<8|this.view.getUint8(t),r=4294967296*(255&this.view.getUint8(t+6)),n=16777216*(255&this.view.getUint8(t+5)),a=65536*(255&this.view.getUint8(t+4)),o=256*(255&this.view.getUint8(t+3)),s=255&this.view.getUint8(t+2),h=r+n+a+o+s;return this.position+=8,new e(h,i)},e.prototype.print=function(){return""+this.block+":"+this.offset},t}(igv||{}),igv=function(t){function e(t){var e;this.flanking=t.flanking,this.type=t.type||"IGV",this.crossDomainProxy=t.crossDomainProxy,this.formats=t.formats,this.trackDefaults=t.trackDefaults,t.search?this.searchConfig={type:"json",url:t.search.url,coords:void 0===t.search.coords?1:t.search.coords,chromosomeField:t.search.chromosomeField||"chromosome",startField:t.search.startField||"start",endField:t.search.endField||"end",resultsField:t.search.resultsField}:(e=t.reference&&t.reference.id?t.reference.id:t.genome?t.genome:"hg19",this.searchConfig={type:"plain",url:"https://portals.broadinstitute.org/webservices/igv/locus?genome="+e+"&name=$FEATURE$",coords:0,chromosomeField:"chromosome",startField:"start",endField:"end"})}function i(e,i,r){function n(e,i,r){var n=r.start,a=r.end;void 0===a?(n-=t.browser.minimumBasesExtent()/2,a=n+t.browser.minimumBasesExtent(),a>i.bpLength?(a=i.bpLength,n=a-t.browser.minimumBasesExtent()):n<0&&(n=0,a=t.browser.minimumBasesExtent())):a-n<t.browser.minimumBasesExtent()&&(p=(a+n)/2,p-t.browser.minimumBasesExtent()/2<0?(n=0,a=n+t.browser.minimumBasesExtent()):p+t.browser.minimumBasesExtent()/2>i.bpLength?(a=i.bpLength,n=a-t.browser.minimumBasesExtent()):(n=p-t.browser.minimumBasesExtent()/2,a=n+t.browser.minimumBasesExtent())),r.start=Math.ceil(n),r.end=Math.floor(a)}var a,s,h,l,c,u,d,p,f;return a="locus",s=e.split(":"),u=i.getChromosomeName(s[0]),u&&(h=i.getChromosome(u)),h&&(l=c=void 0,1===s.length?(l=0,c=h.bpLength):(d=s[1].split("-"),l=Math.max(0,parseInt(d[0].replace(/,/g,""))-1),2===d.length&&(c=Math.min(h.bpLength,parseInt(d[1].replace(/,/g,""))),c<0&&(c=h.bpLength))),f={start:l,end:c},n(t.browser,h,f),l=f.start,c=f.end),void 0===h||isNaN(l)||l>c?(t.presentAlert("Unrecognized feature or locus: "+e),!1):(r.goto(u,l,c),o.call(t.browser,e,a),!0)}function n(e){var i=e.splitLines(),r=[],n=[];return i.forEach(function(t){""===t||r.push(t)}),r.forEach(function(e){var i,r,a,o=e.split("\t");o.length>=3&&(r=o[1].split(":"),a=r[1].split("-"),i=o[2].trim(),n.push({chromosome:t.browser.genome.getChromosomeName(r[0].trim()),start:parseInt(a[0].replace(/,/g,"")),end:parseInt(a[1].replace(/,/g,"")),type:"gtex"===i?"snp":"gene"}))}),n}function a(e,i,r,n,a){t.browser.selection=new t.GtexSelection("gtex"===a||"snp"===a?{snp:e}:{gene:e}),void 0===n&&(n=r+1),t.browser.flanking&&(r=Math.max(0,r-t.browser.flanking),n+=t.browser.flanking),t.browser.goto(i,r,n),o.call(t.browser,e,a)}function o(t,e){this.trackViews.forEach(function(i){var r=i.track;r.onsearch&&r.onsearch(t,e)})}function s(e){function i(e){t.browser.$cursorTrackingGuide.get(0);r||t.browser.$cursorTrackingGuide&&e.toElement===t.browser.$cursorTrackingGuide.get(0)&&"mouseleave"===e.type||(a&&(t.browser.fireEvent("trackdragend"),a=!1),s=void 0,n=!1,o=void 0)}var r=!1,n=!1,a=!1,o=void 0,s=void 0;$(e).mousedown(function(i){var a=t.translateMouseCoordinates(i,e);t.popover&&t.popover.hide(),r=!!$(i.target).parent().parent().parent()[0].dataset.rulerTrack,r||(n=!0,o=a.x,s=o)}),$(e).mousemove(function(i){var r,n,a=t.browser.$cursorTrackingGuide;r=t.translateMouseCoordinates(i,e),n=Math.max(50,r.x-5),n=Math.min(t.browser.trackContainerDiv.clientWidth-65,n),a.css({left:n+"px"})}),$(e).mousemove(t.throttle(function(i){var h,l,c=t.translateMouseCoordinates(i,e),u=t.browser.referenceFrame;if(!r&&u&&n){if(s&&Math.abs(c.x-s)>t.browser.constants.dragThreshold){if(t.browser.loadInProgress())return;a=!0,u.shiftPixels(o-c.x),u.start=Math.max(0,u.start);var d=t.browser.genome.getChromosome(u.chr);h=d.bpLength,l=h-t.browser.trackViewportWidth()*u.bpPerPixel,u.start>l&&(u.start=l),t.browser.updateLocusSearch(u),t.browser.repaint(),t.browser.fireEvent("trackdrag")}o=c.x}},10)),$(e).mouseup(i),$(e).mouseleave(i)}function h(t){function e(t){t.featureType&&(t.type=t.type||t.featureType,t.featureType=void 0),"bed"===t.type?(t.type="annotation",t.format=t.format||"bed"):"bam"===t.type?(t.type="alignment",t.format="bam"):"vcf"===t.type?(t.type="variant",t.format="vcf"):"t2d"===t.type?t.type="gwas":"FusionJuncSpan"===t.type&&(t.format="fusionjuncspan")}function i(t){if(t.format)return void(t.format=t.format.toLowerCase());var e,i,r=t.url||t.localFile.name,n=r.toLowerCase();switch(e=n.indexOf("?"),e>0&&(n=n.substr(0,e)),n.endsWith(".gz")?n=n.substr(0,n.length-3):(n.endsWith(".txt")||n.endsWith(".tab"))&&(n=n.substr(0,n.length-4)),e=n.lastIndexOf("."),i=e<0?n:n.substr(e+1),i.toLowerCase()){case"bw":t.format="bigwig";break;case"bb":t.format="bigbed";default:l.has(i)&&(t.format=i)}}function r(t){if(!t.type&&void 0!==t.format)switch(t.format.toLowerCase()){case"bw":case"bigwig":case"wig":case"bedgraph":t.type="wig";break;case"vcf":t.type="variant";break;case"seg":t.type="seg";break;case"bam":t.type="alignment";break;default:t.type="annotation"}}e(t),void 0===t.sourceType&&(t.url||t.localFile)&&(t.sourceType="file"),"file"===t.sourceType&&void 0===t.format&&i(t),void 0===t.type&&r(t)}var l=new Set(["narrowpeak","broadpeak","peaks","bedgraph","wig","gff3","gff","gtf","aneu","fusionjuncspan","refflat","seg","bed","vcf","bb","bigbed","bw","bigwig","bam"]);return t.Browser=function(i,r){t.browser=this,this.config=i,this.div=$('<div id="igvRootDiv" class="igv-root-div">')[0],e.call(this,i),$("input[id='trackHeightInput']").val(this.trackHeight),this.trackContainerDiv=r,s(r),this.trackViews=[],this.trackLabelsVisible=!0,this.featureDB={},this.constants={dragThreshold:3,defaultColor:"rgb(0,0,150)",doubleClickDelay:i.doubleClickDelay||500},this.eventHandlers={},window.onresize=t.throttle(function(){t.browser.resize()},10)},t.Browser.prototype.getFormat=function(t){if(void 0!==this.formats)return this.formats[t]},t.Browser.prototype.loadTracksWithConfigList=function(t){var e=this,i=[];return t.forEach(function(t){i.push(e.loadTrack(t))}),this.trackViews.forEach(function(t){t.resize()}),i},t.Browser.prototype.loadTrack=function(e){var i,r,n,a,o=this;if(h(e),this.trackDefaults&&e.type&&(i=this.trackDefaults[e.type]))for(r in i)i.hasOwnProperty(r)&&void 0===e[r]&&(e[r]=i[r]);switch(e.type.toLowerCase()){case"gwas":n=new t.GWASTrack(e);break;case"annotation":case"genes":case"fusionjuncspan":n=new t.FeatureTrack(e);break;case"variant":n=new t.VariantTrack(e);break;case"alignment":n=new t.BAMTrack(e,a);break;case"data":case"wig":n=new t.WIGTrack(e);break;case"sequence":n=new t.SequenceTrack(e);break;case"eqtl":n=new t.EqtlTrack(e);break;case"seg":n=new t.SegTrack(e);break;case"aneu":n=new t.AneuTrack(e);break;default:return t.presentAlert("Unknown file type: "+e.url),null}return void 0===n.order&&(n.order=this.trackViews.length),"function"==typeof n.getFileHeader?n.getFileHeader().then(function(t){o.addTrack(n)}).catch(function(e){t.presentAlert(e)}):o.addTrack(n),n},t.Browser.prototype.addTrack=function(e){var i=new t.TrackView(e,this);"undefined"!=typeof t.popover&&t.popover.hide(),e.trackView=i,this.trackViews.push(i),this.reorderTracks(),i.resize()},t.Browser.prototype.reorderTracks=function(){var t=this;this.trackViews.sort(function(t,e){var i=t.track.order||0,r=e.track.order||0;return i-r}),$(this.trackContainerDiv).children("igv-track-div").detach(),this.trackViews.forEach(function(e,i,r){t.trackContainerDiv.appendChild(e.trackDiv)})},t.Browser.prototype.removeTrack=function(t){for(var e,i=0;i<this.trackViews.length;i++)if(t===this.trackViews[i].track){e=this.trackViews[i];break}e&&(this.trackViews.splice(i,1),this.trackContainerDiv.removeChild(e.trackDiv),this.fireEvent("trackremoved",[e.track]))},t.Browser.prototype.reduceTrackOrder=function(t){var e,i,r=[];1!==this.trackViews.length&&(this.trackViews.forEach(function(i,n,a){r.push({trackView:i,index:n}),t===i&&(e=r[n])}),0!==e.index&&(i=e.trackView.track.order,e.trackView.track.order=r[e.index-1].trackView.track.order,r[e.index-1].trackView.track.order=i,this.reorderTracks()))},t.Browser.prototype.increaseTrackOrder=function(t){var e,i,r=[];1!==this.trackViews.length&&(this.trackViews.forEach(function(i,n,a){r.push({trackView:i,index:n}),t===i&&(e=r[n])}),this.trackViews.length-1!==e.index&&(i=e.trackView.track.order,e.trackView.track.order=r[1+e.index].trackView.track.order,r[1+e.index].trackView.track.order=i,this.reorderTracks()))},t.Browser.prototype.setTrackHeight=function(t){this.trackHeight=t,this.trackViews.forEach(function(e){e.setTrackHeight(t)})},t.Browser.prototype.resize=function(){this.ideoPanel&&this.ideoPanel.resize(),this.karyoPanel&&this.karyoPanel.resize(),this.trackViews.forEach(function(t){t.resize()})},t.Browser.prototype.repaint=function(){this.ideoPanel&&this.ideoPanel.repaint(),this.karyoPanel&&this.karyoPanel.repaint(),this.trackViews.forEach(function(t){t.repaint()})},t.Browser.prototype.update=function(){this.updateLocusSearch(this.referenceFrame),this.centerGuide&&this.centerGuide.repaint(),this.ideoPanel&&this.ideoPanel.repaint(),this.karyoPanel&&this.karyoPanel.repaint(),this.trackViews.forEach(function(t){t.update()})},t.Browser.prototype.loadInProgress=function(){var t;for(t=0;t<this.trackViews.length;t++)if(this.trackViews[t].loading)return!0;return!1},t.Browser.prototype.updateLocusSearch=function(e){var i,r,n,a,o,s;this.$searchInput&&(i=e.chr,r=t.numberFormatter(Math.floor(e.start+1)),o=e.start+this.trackViewportWidthBP(),this.genome&&(s=this.genome.getChromosome(i),s&&(o=Math.min(o,s.bpLength))),n=t.numberFormatter(Math.floor(o)),a=i+":"+r+"-"+n,this.$searchInput.val(a),this.windowSizePanel.update(Math.floor(o-e.start))),this.fireEvent("locuschange",[e,a])},t.Browser.prototype.trackViewportWidth=function(){var t;return t=this.trackViews&&this.trackViews.length>0?this.trackViews[0].viewportDiv.clientWidth:this.trackContainerDiv.clientWidth-100},t.Browser.prototype.trackViewportWidthBP=function(){return this.referenceFrame.bpPerPixel*this.trackViewportWidth()},t.Browser.prototype.minimumBasesExtent=function(){return 40},t.Browser.prototype.removeAllTracks=function(){for(var t=this.trackViews,e=0;e<t.length;e++){var i=this.trackViews[e].track;this.removeTrack(i)}},t.Browser.prototype.setGotoCallback=function(t){this.gotocallback=t},t.Browser.prototype.goto=function(e,i,r){"undefined"!=typeof this.gotocallback&&this.gotocallback(e,i,r);var n,a,o=this.trackViewportWidth();if(t.popover&&t.popover.hide(),this.genome&&(e=this.genome.getChromosomeName(e)),this.referenceFrame.chr=e,r?this.referenceFrame.bpPerPixel=(r-i)/o:(n=Math.round(o*this.referenceFrame.bpPerPixel/2),i=Math.max(0,i-n)),this.genome)if(a=this.genome.getChromosome(this.referenceFrame.chr)){a.bpLength||(a.bpLength=1);var s=a.bpLength/o;this.referenceFrame.bpPerPixel>s&&(this.referenceFrame.bpPerPixel=s),r||(r=i+o*this.referenceFrame.bpPerPixel),a&&r>a.bpLength&&(i-=r-a.bpLength)}else console&&console.log&&console.log("Could not find chromsome "+this.referenceFrame.chr);this.referenceFrame.start=i,this.update()},t.Browser.prototype.zoomIn=function(){function t(t,e){return Math.floor(t*e)}if(!this.loadInProgress()){var e;if(console.log("browser.zoomIn - src extent "+t(this.trackViewportWidth(),this.referenceFrame.bpPerPixel)),this.minimumBasesExtent()>t(this.trackViewportWidth(),this.referenceFrame.bpPerPixel/2))return void console.log("browser.zoomIn - dst extent "+t(this.trackViewportWidth(),this.referenceFrame.bpPerPixel/2)+" bailing ...");console.log("browser.zoomIn - dst extent "+t(this.trackViewportWidth(),this.referenceFrame.bpPerPixel/2)),e=this.referenceFrame.start+this.referenceFrame.bpPerPixel*(this.trackViewportWidth()/2),this.referenceFrame.start=e-this.trackViewportWidth()/2*(this.referenceFrame.bpPerPixel/2),this.referenceFrame.bpPerPixel/=2,this.update()}},t.Browser.prototype.zoomOut=function(){if(!this.loadInProgress()){var t,e,i,r,n,a;if(a=this.trackViewportWidth(),t=2*this.referenceFrame.bpPerPixel,r=25e7,this.genome){var o=this.genome.getChromosome(this.referenceFrame.chr);o&&(r=o.bpLength)}e=r/a,t>e&&(t=e),i=this.referenceFrame.start+this.referenceFrame.bpPerPixel*a/2,n=t*a,this.referenceFrame.start=Math.round(i-n/2),this.referenceFrame.start<0?this.referenceFrame.start=0:this.referenceFrame.start>r-n&&(this.referenceFrame.start=r-n),this.referenceFrame.bpPerPixel=t,this.update()}},t.Browser.prototype.search=function(e,o,s){function h(t,e){return 2===t.split(":").length||!!e.getChromosome(t)}var l,c,u,d,p,f,g;if(void 0===t.browser||void 0===t.browser.genome)return t.browser.initialLocus=e,void(o&&o());if(h(e,this.genome,s)){var v=i(e,this.genome,this);(s||!0===v)&&o&&o()}else if(g=this.featureDB[e.toUpperCase()])a(g.name,g.chr,g.start,g.end,"");else if(this.searchConfig){if(f=this.searchConfig.url.replace("$FEATURE$",e),p=this.searchConfig,f.indexOf("$GENOME$")>-1){var m=this.genome.id?this.genome.id:"hg19";f.replace("$GENOME$",m)}igvxhr.loadString(f).then(function(i){var s="plain"===p.type?n(i):JSON.parse(i);p.resultsField&&(s=s[p.resultsField]),0==s.length?t.presentAlert('No feature found with name "'+e+'"'):(r=s[0],c=r[p.chromosomeField],u=r[p.startField]-p.coords,d=r[p.endField],l=r.featureType||r.type,a(e,c,u,d,l)),o&&o()})}},t.Browser.prototype.on=function(t,e){this.eventHandlers[t]||(this.eventHandlers[t]=[]),this.eventHandlers[t].push(e)},t.Browser.prototype.un=function(t,e){if(this.eventHandlers[t]){var i=this.eventHandlers[t].indexOf(e);i!==-1&&this.eventHandlers[t].splice(i,1)}},t.Browser.prototype.fireEvent=function(t,e,i){if(this.eventHandlers[t])for(var r=i||window,n=0,a=this.eventHandlers[t].length;n<a;n++){var o=this.eventHandlers[t][n],s=o.apply(r,e);if(void 0!==s)return s}},t}(igv||{}),igv=function(t){function e(t){var e;return t&&""!==t?(e=t.toUpperCase(),i[e]?i[e]:r):r}var i={H3K27AC:"rgb(200, 0, 0)",H3K27ME3:"rgb(130, 0, 4)",H3K36ME3:"rgb(0, 0, 150)",H3K4ME1:"rgb(0, 150, 0)",H3K4ME2:"rgb(0, 150, 0)",H3K4ME3:"rgb(0, 150, 0)",H3K9AC:"rgb(100, 0, 0)",H3K9ME1:"rgb(100, 0, 0)"},r="rgb(3, 116, 178)";return t.EncodeTable=function(i,r){var n,a=this;this.encodeModalTableObject=$('<table id="encodeModalTable" cellpadding="0" cellspacing="0" border="0" class="display"></table>'),i.append(this.encodeModalTableObject[0]),this.initialized=!1,n=$('<i class="fa fa-lg fa-spinner fa-spin"></i>'),this.spinner=$('<div class="igv-encode-spinner-container"></div>'),this.spinner.append(n[0]),$("#encodeModalTable").append(this.spinner[0]),$("#igvEncodeModal").on("shown.bs.modal",function(t){!0!==a.initialized&&(a.initialized=!0,r())}),$("#encodeModalTopCloseButton").on("click",function(){$("tr.selected").removeClass("selected")}),$("#encodeModalBottomCloseButton").on("click",function(){$("tr.selected").removeClass("selected")}),$("#encodeModalGoButton").on("click",function(){var i,r,n=[],o=$("#encodeModalTable"),s=o.DataTable();i=a.dataTablesObject.$("tr.selected"),i&&(i.removeClass("selected"),i.each(function(){var t,i=s.row(this).data();t=i[0],r=a.dataSource.jSON.rows[t],n.push({type:r.Format,url:r.url,color:e(r.Target),format:r.Format,name:r.Name})}),void 0===t.browser.designatedTrack&&(n[0].designatedTrack=!0),t.browser.loadTracksWithConfigList(n))})},t.EncodeTable.prototype.loadWithDataSource=function(t){var e=this,i=t.dataTablesData(),r=t.columnHeadings();this.dataSource=t,this.dataTablesObject=e.encodeModalTableObject.dataTable({data:i,scrollX:!0,scrollY:"400px",scrollCollapse:!0,paging:!1,columnDefs:[{targets:0,visible:!1}],autoWidth:!0,columns:r}),e.encodeModalTableObject.find("tbody").on("click","tr",function(){$(this).hasClass("selected")?$(this).removeClass("selected"):$(this).addClass("selected")})},t.EncodeTable.prototype.encodeTrackLabel=function(t){return t.antibody?t.antibody+" "+t.cell+" "+t.replicate:t.cell+t.dataType+" "+t.view+" "+t.replicate},t.EncodeDataSource=function(t){this.config=t},t.EncodeDataSource.prototype.loadJSON=function(t){this.jSON={},this.config.filePath?this.ingestFile(this.config.filePath,t):this.config.jSON&&this.ingestJSON(this.config.jSON,t)},t.EncodeDataSource.prototype.ingestJSON=function(t,e){var i=this;i.jSON=t,t.rows.forEach(function(t,e){Object.keys(t).forEach(function(r){var n=t[r];i.jSON.rows[e][r]=void 0===n||""===n?"-":n})}),e()},t.EncodeDataSource.prototype.ingestFile=function(t,e){var i=this;igvxhr.loadString(t).then(function(t){var r,n=t.splitLines();i.jSON.columns=n[0].split("\t"),i.jSON.columns.pop(),r=i.jSON.columns.shift(),i.jSON.columns.push(r),i.jSON.rows=[],n.slice(1,n.length-1).forEach(function(t){var e,n;e=t.split("\t"),e.pop(),r=e.shift(),e.push(r),n={},
e.forEach(function(t,e,r){var a=i.jSON.columns[e];n[a]=void 0===t||""===t?"-":t}),i.jSON.rows.push(n)}),e()})},t.EncodeDataSource.prototype.dataTablesData=function(){var t=this,e=[];return this.jSON.rows.forEach(function(i,r){var n=[];n.push(r),t.jSON.columns.forEach(function(t){n.push(i[t])}),e.push(n)}),e},t.EncodeDataSource.prototype.columnHeadings=function(){var t=(this.jSON.columnWidths,[]);return t.push({title:"index"}),this.jSON.columns.forEach(function(e,i){t.push({title:e})}),t},t}(igv||{}),igv=function(t){var e="https://www.encodeproject.org/search/?type=experiment&files.output_type=peaks&files.file_format=bed&format=json&field=lab.title&field=biosample_term_name&field=assay_term_name&field=target.label&field=files.file_format&field=files.output_type&field=files.href&field=files.replicate.technical_replicate_number&field=files.replicate.biological_replicate_number&field=files.assembly&limit=all";return t.encodeSearch=function(t){igvxhr.loadJson(e,{}).then(function(e){var i=["Assembly","Cell Type","Target","Assay Type","Bio Rep","Tech Rep","Lab"],r=[8,20,10,10,8,8,40],n=[];e["@graph"].forEach(function(t){var e=t.assay_term_name,i=t["@id"],r=t.biosample_term_name||"",a=t.target?t.target.label:"",o=t.lab?t.lab.title:"";t.files.forEach(function(t){if("bed"===t.file_format){var s=t.file_format,h=t.output_type,l=t.replicate?t.replicate.bioligcal_replicate_number:void 0,c=t.replicate?t.replicate.technical_replicate_number:void 0,u=r+" "+a,d=t.assembly;l&&(u+=" "+l),c&&(u+=(l?":":"0:")+c),n.push({Assembly:d,ExperimentID:i,"Cell Type":r,"Assay Type":e,Target:a,Lab:o,Format:s,Type:h,url:"https://www.encodeproject.org"+t.href,"Bio Rep":l,"Tech Rep":c,Name:u})}})}),n.sort(function(t,e){var i=t.Assembly,r=e.Assembly,n=t["Cell Type"],a=e["Cell Type"],o=t.Target,s=e.Target;return i===r?n===a?o===s?0:o<s?-1:1:n<a?-1:1:i<r?-1:1}),t({columns:i,columnWidths:r,rows:n})})},t}(igv||{}),igv=function(t){function e(e,i,r){var n=this;return new Promise(function(a,o){function s(t,e,i){var r=e-t.start,n=i-e,a=t.features?t.features.substr(r,n):null;return a}var h=n.interval;if(h&&h.contains(e,i,r))a(s(h,i,r));else{var l=i,c=r;if(r-i<1e5){var u=r-i,d=Math.round(i+u/2);l=Math.max(0,d-5e4),c=d+5e4}n.readSequence(e,l,c).then(function(o){n.interval=new t.GenomicInterval(e,l,c,o),a(s(n.interval,i,r))}).catch(o)}})}function i(t,e,i){var r=this;return new Promise(function(n,a){var o=r.sequences[t];o&&o.length>i&&n(o.substring(e,i))})}return t.FastaSequence=function(t){this.file=t.fastaURL,this.indexed=t.indexed!==!1,this.indexed&&(this.indexFile=t.indexURL||t.indexFile||this.file+".fai"),this.withCredentials=t.withCredentials},t.FastaSequence.prototype.init=function(){var e=this;return e.indexed?new Promise(function(i,r){e.getIndex().then(function(r){var n=0;e.chromosomes={},e.chromosomeNames.forEach(function(i){var r=e.index[i].size;e.chromosomes[i]=new t.Chromosome(i,n++,r)}),i()}).catch(r)}):e.loadAll()},t.FastaSequence.prototype.getSequence=function(t,r,n){return this.indexed?e.call(this,t,r,n):i.call(this,t,r,n)},t.FastaSequence.prototype.getIndex=function(){var t=this;return new Promise(function(e,i){t.index?e(t.index):igvxhr.load(t.indexFile,{withCredentials:t.withCredentials}).then(function(i){var r=i.splitLines(),n=r.length,a=0;for(t.chromosomeNames=[],t.index={};a<n;){var o=r[a++].split("\t"),s=o.length;if(5==s){var h=o[0],l=parseInt(o[1]),c=parseInt(o[2]),u=parseInt(o[3]),d=parseInt(o[4]),p={size:l,position:c,basesPerLine:u,bytesPerLine:d};t.chromosomeNames.push(h),t.index[h]=p}}e&&e(t.index)}).catch(i)})},t.FastaSequence.prototype.loadAll=function(){var e=this;return new Promise(function(i,r){e.chromosomeNames=[],e.chromosomes={},e.sequences={},igvxhr.load(e.file,{withCredentials:e.withCredentials}).then(function(r){for(var n,a,o=r.splitLines(),s=o.length,h=0,l="",c=0;h<s;)n=o[h++].trim(),n.startsWith("#")||0===n.length||(n.startsWith(">")?(l&&(e.chromosomeNames.push(a),e.sequences[a]=l,e.chromosomes[a]=new t.Chromosome(a,c++,l.length)),a=n.substr(1).split("\\s+")[0],l=""):l+=n);i()})})},t.FastaSequence.prototype.readSequence=function(e,i,r){var n=this;return new Promise(function(a,o){n.getIndex().then(function(){var s=n.index[e];if(s){var h=Math.max(0,i),l=Math.min(s.size,r),c=s.bytesPerLine,u=s.basesPerLine,d=s.position,p=c-u,f=Math.floor(h/u),g=Math.floor(l/u),v=f*u,m=h-v,b=d+f*c+m,y=g*u,w=l-y,k=d+g*c+w-1,x=k-b+1;x<=0&&a(null),igvxhr.load(n.file,{range:{start:b,size:x}}).then(function(t){var e,i="",r=0,n=0,o=t.length;for(m>0&&(e=Math.min(l-h,u-m),i+=t.substr(r,e),r+=e+p,n+=e);r<o;)e=Math.min(u,o-r),i+=t.substr(r,e),r+=e+p,n+=e;a(i)}).catch(o)}else console.log("No index entry for chr: "+e),n.interval=new t.GenomicInterval(e,i,r,null),a(null)}).catch(o)})},t}(igv||{}),igv=function(t){function e(e){return new t.FeatureParser(e)}return t.AneuFeatureSource=function(t,i){this.config=t||{};var r=function(t){var e=t.lastIndexOf("/"),i=t.substring(0,e+1);return i};if(t.localFile){var n=r(t.localFile.name);this.localFile=t.localFile,this.filename=n+i}else{var n=r(t.url);this.url=n+i,this.filename=i,this.headURL=t.headURL||this.filename}this.parser=e("aneu")},t.AneuFeatureSource.prototype.getFeatures=function(e,i,r,n){var a=this,o=new t.GenomicInterval(e,i,r),s=this.featureCache;if(s&&(void 0===s.range||s.range.containsRange(o))){var h=this.featureCache.queryFeatures(e,i,r);n(h)}else this.loadFeatures(function(o){a.featureCache=new t.FeatureCache(o);var s=a.featureCache.queryFeatures(e,i,r);n(s)},o)},t.AneuFeatureSource.prototype.getFeatureCache=function(e){var i=this;this.featureCache?e(this.featureCache):this.loadFeatures(function(r){i.featureCache=new t.FeatureCache(r),e(i.featureCache)})},t.AneuFeatureSource.prototype.loadFeatures=function(t,e){var i=this,r=i.parser,n={headers:i.config.headers,tokens:i.config.tokens,withCredentials:i.config.withCredentials},a=function(e){i.header=r.parseHeader(e);var n=r.parseFeatures(e);t(n)};i.localFile?igvxhr.loadStringFromFile(i.localFile,n).then(a):igvxhr.loadString(i.url,n).then(a)},t}(igv||{}),igv=function(t){function e(){var e=this;return new Promise(function(i,r){if(e.featureSourceRed)i();else{var a=function(r){r=JSON.parse(r),n("Got json: "+r+", diff :"+r.diff),e.featureSource=new t.AneuFeatureSource(s,r.diff),e.featureSourceRed=new t.AneuFeatureSource(s,r.redline),i()},o={headers:e.config.headers,tokens:e.config.tokens,withCredentials:e.config.withCredentials},s=e.config;s.localFile?igvxhr.loadStringFromFile(s.localFile,o).then(a):igvxhr.loadString(s.url,o).then(a)}})}var r=!1,n=function(t){if(r){var e=new Date,i=e.getHours()+":"+e.getMinutes()+":"+e.getSeconds();"undefined"!=typeof copy&&copy(t),"undefined"!=typeof console&&console.log("AneuTrack: "+i+" "+t)}},a=1;return t.AneuTrack=function(e){t.configTrack(this,e),this.maxHeight=e.maxHeight-2||500,this.sampleSquishHeight=e.sampleSquishHeight||20,this.sampleExpandHeight=e.sampleExpandHeight||125,this.sampleHeight=this.sampleExpandHeight,this.highColor=e.highColor||"rgb(30,30,255)",this.lowColor=e.lowColor||"rgb(220,0,0)",this.midColor=e.midColor||"rgb(150,150,150)",this.posColorScale=e.posColorScale||new t.GradientColorScale({low:.1,lowR:255,lowG:255,lowB:255,high:1.5,highR:255,highG:0,highB:0}),this.negColorScale=e.negColorScale||new t.GradientColorScale({low:-1.5,lowR:0,lowG:0,lowB:255,high:-.1,highR:255,highG:255,highB:255}),this.sampleCount=0,this.samples={},this.sampleNames=[],n("AneuTrack: config: "+JSON.stringify(e)),this.config=e},t.AneuTrack.prototype.popupMenuItems=function(t){return[]},t.AneuTrack.prototype.getSummary=function(t,e,r,a){var o=function(t){var e=[];for(i=0,len=t.length;i<len;i++){var r=t[i];Math.abs(r.score-2)>.5&&r.end-r.start>5e6&&e.push(r)}a(e)};this.featureSourceRed?this.featureSourceRed.getFeatures(t,e,r,o):(n("Aneu track has no summary data yet"),a(null))},t.AneuTrack.prototype.loadSummary=function(e,i,r,n){var a=this;if(!this.featureSourceRed){var o=function(o){o&&(o=JSON.parse(o),a.featureSourceRed=new t.AneuFeatureSource(s,o.redline),a.getSummary(e,i,r,n))};afterload={headers:a.config.headers,tokens:a.config.tokens,success:o,withCredentials:a.config.withCredentials};var s=a.config;return s.localFile?igvxhr.loadStringFromFile(s.localFile,afterload):igvxhr.loadString(s.url,afterload),null}this.featureSourceRed.getFeatures(e,i,r,n)},t.AneuTrack.prototype.getFeatures=function(t,i,r){var n=this;return new Promise(function(a,o){e.call(n).then(function(){var e=function(e){n.redlinedata=e,n.featureSource.getFeatures(t,i,r,a)};n.featureSourceRed.getFeatures(t,i,r,e)})})},t.AneuTrack.prototype.getColor=function(t){var e=2;return t<e?color=this.lowColor:t>e?color=this.highColor:color=this.midColor,color},t.AneuTrack.prototype.paintAxis=function(e,i,r){function n(t,e,i,r){return r-Math.round((i-t)/e*r)}var a=this,o=((a.maxLogP-a.minLogP)/r,{font:"normal 10px Arial",textAlign:"right",strokeStyle:"black"});t.graphics.fillRect(e,0,0,i,r,{fillStyle:"rgb(255, 255, 255)"});var s=a.max;s||(s=8);var h=0,l=49;t.graphics.strokeLine(e,l,n(h,s,0,a.maxheight),l,n(h,s,s,a.maxheight),o),l-=5;for(var c=0;c<=s;c+=1){var u=n(h,s,c,a.maxheight);t.graphics.strokeLine(e,l,u,l+5,u,o),c>0&&c<s&&t.graphics.fillText(e,c,l-4,u+3,o)}o.textAlign="center",t.graphics.fillText(e,"ploidy",l-15,r/2,o,{rotate:{angle:-90}})},t.AneuTrack.prototype.draw=function(e){function i(t,e,i,r){return r-Math.round((i-t)/e*r)}function r(t){var e;if(void 0===x.isLog)for(x.isLog=!1,e=0;e<t.length;e++)if(t[e].value<0)return void(x.isLog=!0)}var a,o,s,h,l,c,u,d,p,f,g,v,m,b,y,w,k,x=this;a=e.context,h=e.pixelWidth,l=e.pixelHeight;var S=4,_=0,C=10;t.graphics.fillRect(a,0,0,h,l,{fillStyle:"rgb(255, 255, 255)"});var T=this;window.track=T;var A=function(t){for(f=0,d=t.length;f<d;f++){p=t[f].sample;var e=t[f].value;e>S&&(S=e),e<_&&(_=e)}S>C&&(S=C),_=Math.max(_,0),T.max=S},E=function(a,l,d){for(o=e.bpPerPixel,s=e.bpStart,c=s+h*o+1,k=o,f=0,A=l.length;f<A;f++)p=l[f].sample,p&&this.samples&&this.samples.hasOwnProperty(p)&&(this.samples[p]=x.sampleCount,this.sampleNames.push(p),this.sampleCount++);r(l);var C=2;x.isLog&&(_=0,C=0);var T=x.height-4;x.maxheight=T;var A=l.length;for(f=0;f<A;f++)if(u=l[f],!(u.end<s)){if(u.start>c)break;if(u.sample?(g=x.samples[u.sample]*x.sampleHeight,n("Got sample y="+g)):g=0,m=u.score,v=x.midColor,x.isLog?(m=Math.log2(m/2),m<C-.1?v=x.negColorScale.getColor(m):m>C+.1&&(v=x.posColorScale.getColor(m))):m<C-.2?v=x.lowColor:m>C+.2&&(v=x.highColor),b=Math.round((u.start-s)/k),y=Math.round((u.end-s)/k),w=Math.max(2,y-b),m<=S){var E=i(_,S,m,T);1==d&&n("       Got value "+m+", h="+E+", y+h="+(g+E)+", px="+b+", px1="+y+", pw="+w+", color="+v+", maxh="+T),t.graphics.fillRect(a,b,g+E,w,2,{fillStyle:v})}}},P=x.height-4,R={font:"normal 10px Arial",textAlign:"right",strokeStyle:"rgb(150,150,150)",fillStyle:"rgb(150,150,150)"};if(e.features&&A(e.features),this.redlinedata&&A(this.redlinedata),_<2&&2<S){var I=i(_,S,2,P);console.log("drawing dashed line and solid line at "+I+" to "+h),t.graphics.dashedLine(a,20,I,h,I,4,R);var M=i(_,S,0,P);t.graphics.strokeLine(a,20,M,h,M,R)}else n("NOT drawing line at 2");e.features?E(a,e.features,!1):console.log("No diff feature list. options="+JSON.stringify(e)),this.redlinedata?E(a,this.redlinedata,!1):console.log("No redline feature list")},t.AneuTrack.prototype.computePixelHeight=function(t){for(i=0,len=t.length;i<len;i++)sample=t[i].sample,this.samples&&!this.samples.hasOwnProperty(sample)&&(this.samples[sample]=this.sampleCount,this.sampleNames.push(sample),this.sampleCount++);this.sampleCount=Math.max(1,this.sampleCount);var e=Math.max(30,this.sampleCount*this.sampleHeight);return this.height=e,e},t.AneuTrack.prototype.sortSamples=function(t,e,i,r,n){var a,o,s,h,l,c,u,d=this,p=i-e,f={};this.featureSource.getFeatures(t,e,i,function(t){for(l=0,p=t.length;l<p;l++)if(a=t[l],!(a.end<e)){if(a.start>i)break;o=Math.max(e,a.start),s=Math.min(i,a.end),h=(s-o)/p,c=f[a.sample],c||(c=0),f[a.sample]=c+h*a.value}for(u=Object.keys(d.samples),u.sort(function(t,e){var i=f[t],n=f[e];return i||(i=Number.MAX_VALUE),n||(n=Number.MAX_VALUE),i==n?0:i>n?r:r*-1}),l=0;l<u.length;l++)d.samples[u[l]]=l;d.sampleNames=u,n()})},t.AneuTrack.prototype.altClick=function(e,i){var r=t.browser.referenceFrame,n=r.toBP(2.5),o=e-n,s=e+n,h=r.chr,l=this;this.sortSamples(h,o,s,a,function(){l.trackView.update()}),a*=-1},t.AneuTrack.prototype.popupData=function(e,i,r){var a,o,s=Math.floor(r/this.sampleHeight);if(n("popupData for row "+s+", sampleNames="+JSON.stringify(this.sampleNames)),s<this.sampleNames.length){if(a=this.sampleNames[s],o=a?[{name:"Sample",value:a}]:[],this.featureSource.featureCache){var h=t.browser.referenceFrame.chr,l=this.featureSource.featureCache.queryFeatures(h,e,e);l.forEach(function(t){t.sample===a&&(o.push({name:"Value",value:t.value}),o.push({name:"Start",value:t.start}),o.push({name:"End",value:t.end}))})}if(this.featureSourceRed.featureCache){var h=t.browser.referenceFrame.chr,l=this.featureSourceRed.featureCache.queryFeatures(h,e,e);l.forEach(function(t){t.sample===a&&(o.push({name:"Value",value:t.value}),o.push({name:"Start",value:t.start}),o.push({name:"End",value:t.end}))})}return o}return null},t}(igv||{}),igv=function(t){function e(e){var n={},a=[],o={},s=t.browser?t.browser.genome:null;if(e)for(e.forEach(function(t){var e,i=t.chr;s&&(i=s.getChromosomeName(i)),e=n[i],e||(a.push(i),e=[],n[i]=e),e.push(t)}),i=0;i<a.length;i++)chr=a[i],o[chr]=r(n[chr]);return o}function r(e){var i,r,n,a,o,s,h,l;for(o=new t.IntervalTree,h=e.length,s=Math.max(10,Math.round(h/100)),e.sort(function(t,e){return t.start===e.start?0:t.start>e.start?1:-1}),i=0;i<h;i+=s)r=Math.min(h,i+s),l=e.slice(i,r),n=l[0].start,a=n,l.forEach(function(t){a=Math.max(a,t.end)}),o.insert(n,a,l);return o}return t.FeatureCache=function(t,i){this.treeMap=e(t),this.range=i},t.FeatureCache.prototype.queryFeatures=function(t,e,i){var r,n,a,o,s,h,l;return(h=this.treeMap[t])?(l=h.findOverlapping(e,i),0==l.length?[]:(r=[],l.forEach(function(t){for(n=t.value,o=n.length,s=0;s<o&&(a=n[s],!(a.start>i));s++)a.end>=e&&r.push(a)}),r)):[]},t.FeatureCache.prototype.allFeatures=function(){var t=[],e=this.treeMap;if(e)for(var i in e)if(e.hasOwnProperty(i)){var r=e[i];r.mapIntervals(function(e){t=t.concat(e.value)})}return t},t}(igv||{}),igv=function(t){function e(e,i){switch(e){case"vcf":return new t.VcfParser;case"seg":return new t.SegParser;default:return new t.FeatureParser(e,i,this.config)}}function i(){var t=this.config.indexURL,e=this.type,i=this.config.indexed;return t||"wig"!=e&&0!=i}function r(){var e=this.indexURL;return this.filename.endsWith(".gz")?(e||(e=this.url+".tbi"),t.loadBamIndex(e,this.config,!0)):(e||(e=this.url+".idx"),t.loadTribbleIndex(e,this.config))}function n(){var t=this;return new Promise(function(e,i){function r(i){t.header=n.parseHeader(i),t.header instanceof String&&t.header.startsWith("##gff-version 3")&&(t.format="gff3"),e(n.parseFeatures(i))}var n=t.parser,a={headers:t.config.headers,withCredentials:t.config.withCredentials};t.localFile?igvxhr.loadStringFromFile(t.localFile,a).then(r).catch(i):igvxhr.loadString(t.url,a).then(r).catch(i)})}function a(e,i,r){var n=this;return new Promise(function(a,o){var h,l=n.index,c=l&&l.tabix,u=c?l.sequenceIndexMap[e]:e,d=[];h=l.blocksForRange(u,i,r),h&&0!==h.length?(h.forEach(function(e){d.push(new Promise(function(i,r){var a,o=e.minv.block,h=e.minv.offset,c=e.maxv.block+(l.tabix?s:0),u={headers:n.config.headers,range:{start:o,size:c-o+1},withCredentials:n.config.withCredentials};a=function(e){var r,a;r=l.tabix?igvxhr.arrayBufferToString(t.unbgzf(e)):e,a=h?r.slice(h):r;var o=n.parser.parseFeatures(a);i(o)},n.localFile?igvxhr.loadStringFromFile(n.localFile,u).then(a).catch(r):l.tabix?igvxhr.loadArrayBuffer(n.url,u).then(a).catch(r):igvxhr.loadString(n.url,u).then(a).catch(r)}))}),Promise.all(d).then(function(t){var e,i;if(1===t.length)i=t[0];else{for(i=t[0],e=1;e<t.length;e++)i=i.concat(t[e]);i.sort(function(t,e){return t.start-e.start})}a(i)}).catch(o)):a(null)})}function o(){var t=this,e=i.call(this);return new Promise(function(i,n){void 0===t.indexed&&e?r.call(t).then(function(e){e?(t.index=e,t.indexed=!0):t.indexed=!1,i(t.index)}):i(t.index)})}const s=65536;return t.FeatureFileReader=function(i){if(this.config=i||{},i.localFile)this.localFile=i.localFile,this.filename=i.localFile.name;else{this.url=i.url,this.indexURL=i.indexURL,this.headURL=i.headURL||this.filename;var r=t.parseUri(i.url);this.filename=r.file,this.path=r.path}this.format=i.format,this.parser=e.call(this,this.format,i.decode)},t.FeatureFileReader.prototype.readHeader=function(){var t=this;return new Promise(function(e,i){t.header?e(t.header):o.call(t).then(function(r){if(r){var a={headers:t.config.headers,bgz:r.tabix,range:{start:0,size:65e3},withCredentials:t.config.withCredentials},o=function(i){t.header=t.parser.parseHeader(i),e(t.header)};t.localFile?igvxhr.loadStringFromFile(t.localFile,a).then(o):igvxhr.loadString(t.url,a).then(o).catch(i)}else n.call(t,void 0).then(function(i){var r=t.header||{};r.features=i,e(r)}).catch(i)})})},t.FeatureFileReader.prototype.readFeatures=function(t,e,i){var r=this;return new Promise(function(o,s){function h(t){o(t)}r.index?a.call(r,t,e,i).then(h):n.call(r).then(h)})},t}(igv||{}),igv=function(t){function e(t){var e=t.split(/\s+/),i=e[1].split("=")[1],r=parseInt(e[2].split("=")[1],10),n=parseInt(e[3].split("=")[1],10),a=e.length>4?parseInt(e[4].split("=")[1],10):1;return{format:"fixedStep",chrom:i,start:r,step:n,span:a,index:0}}function i(t){var e=t.split(/\s+/),i=e[1].split("=")[1],r=e.length>2?parseInt(e[2].split("=")[1],10):1;return{format:"variableStep",chrom:i,span:r}}function r(t){var e,i,r,n={},a=t.split(/(?:")([^"]+)(?:")|([^\s"]+)(?=\s+|$)/g),o=[];for(e=1;e<a.length;e++)a[e]&&0!==a[e].trim().length&&(i=a[e].trim(),i.endsWith("=")>0?r=i:r?(o.push(r+i),r=void 0):o.push(i));return o.forEach(function(t){if(t){var e=t.split("=",2);2==e.length&&(n[e[0]]=e[1])}}),n}function n(e,i){var r,n,a,o,s,h,l,c,u,d,p,f,g,v,m;if(e.length<3)return null;if(r=e[0],n=parseInt(e[1]),a=e.length>2?parseInt(e[2]):n+1,g={chr:r,start:n,end:a,score:1e3},e.length>3){h=e[3].replace(/"/g,""),l=h.split(";");for(var b=0;b<l.length;b++){var y=l[b].split("=");"gene_id"==y[0]&&(o=y[1]),"gene_name"==y[0]&&(s=y[1])}g.id=o?o:h,g.name=s?s:h}if(e.length>4&&(g.score=parseFloat(e[4])),e.length>5&&(g.strand=e[5]),e.length>6&&(g.cdStart=parseInt(e[6])),e.length>7&&(g.cdEnd=parseInt(e[7])),e.length>8&&"."!==e[8]&&"0"!==e[8]&&(g.color=t.createColorString(e[8])),e.length>11){c=parseInt(e[9]),u=e[10].split(","),d=e[11].split(","),p=[];for(var b=0;b<c;b++){v=n+parseInt(d[b]),m=v+parseInt(u[b]);var f={start:v,end:m};(g.cdStart>m||g.cdEnd<g.cdStart)&&(f.utr=!0),g.cdStart>=v&&g.cdStart<=m&&(f.cdStart=g.cdStart),g.cdEnd>=v&&g.cdEnd<=m&&(f.cdEnd=g.cdEnd),p.push(f)}g.exons=p}return g.popupData=function(){var t=[];return g.name&&t.push({name:"Name",value:g.name}),"+"!==g.strand&&"-"!==g.strand||t.push({name:"Strand",value:g.strand}),t},g}function a(t,e){if(t.length<10)return null;for(var i={chr:t[2],start:parseInt(t[4]),end:parseInt(t[5]),id:t[1],name:t[0],strand:t[3],cdStart:parseInt(t[6]),cdEnd:parseInt(t[7])},r=parseInt(t[8]),n=t[9].split(","),a=t[10].split(","),o=[],s=0;s<r;s++)o.push({start:parseInt(n[s]),end:parseInt(a[s])});return i.exons=o,i.popupData=function(){return[{name:"Name",value:i.name}]},i}function o(t,e){var i,r,n,a,o,s,h,l,c,u;return i=t.length,i<9?null:(r=t[0],n=parseInt(t[1]),a=parseInt(t[2]),s=t[3],h=parseFloat(t[4]),o=t[5].trim(),c=parseFloat(t[6]),u=parseFloat(t[7]),l=parseFloat(t[8]),0===h&&(h=c),{chr:r,start:n,end:a,name:s,score:h,strand:o,signal:c,pValue:u,qValue:l})}function s(t,e){var i,r,n,a;return t.length<3?null:(i=t[0],r=parseInt(t[1]),n=parseInt(t[2]),a=parseFloat(t[3]),{chr:i,start:r,end:n,value:a})}function h(t,e){var i,r,n;return"fixedStep"===e.format?(i=e.index*e.step+e.start,r=i+e.span,n=parseFloat(t[0]),++e.index,isNaN(n)?null:{chr:e.chrom,start:i,end:r,value:n}):"variableStep"===e.format?t.length<2?null:(i=parseInt(t[0],10),r=i+e.span,n=parseFloat(t[1]),isNaN(n)?null:{chr:e.chrom,start:i,end:r,value:n}):s(t)}function l(t,e){var i,r,n,a;return t.length<4?null:(i=t[1],r=parseInt(t[2]),n=t.length>3?parseInt(t[3]):r+1,a={chr:i,start:r,end:n},t.length>4&&(a.score=parseFloat(t[4]),a.value=a.score),a.popupData=function(){return[{name:"Name",value:a.name}]},a)}function c(t,e){var i=t[0],r=t[1],n=parseInt(t[2]),a=parseInt(t[3]),o=parseInt(t[4]),s=parseInt(t[5]),h=t[6],l={chr:i,name:r,junction_left:n,junction_right:a,num_junction_reads:o,num_spanning_frags:s,spanning_frag_coords:[],start:-1,end:-1},c=n,u=a;if(s>0)for(var d=h.split(","),p=0;p<d.length;p++){var f=d[p].split("-"),g=f[0],v=f[1];g<c&&(c=g),v>u&&(u=v),l.spanning_frag_coords.push({left:g,right:v})}return l.start=c,l.end=u,l.popupData=function(){return[{name:"Name",value:l.name}]},l}function u(t,e){var i,r,n,a,o;return i=t.length,i<8?null:(r=t[0],n=parseInt(t[1])-1,a=parseInt(t[3].split(":")[1]),o=parseFloat(t[5]),{chr:r,start:n,end:a,pvalue:o})}function d(e,i){var r,n,a,o,s,h,l,c,u,d,p,f,v,m,b=this.format;if(r=e.length,r<9)return null;n=e[0],h=e[2],a=parseInt(e[3])-1,o=parseInt(e[4]),l="."===e[5]?0:parseFloat(e[5]),s=e[6],c="."===e[7]?0:parseInt(e[7]),u=e[8];var y="gff3"===b?"=":/\s+/,w={};if(u.split(";").forEach(function(e){var i,r,n=e.trim().split(y,2);2==n.length&&(i=n[0].trim(),r=n[1].trim(),r.startsWith('"')&&r.endsWith('"')&&(r=r.substr(1,r.length-2)),"ID"===n[0]?d=n[1]:"Parent"===n[0]?p=n[1]:"color"===n[0].toLowerCase()?f=t.createColorString(n[1]):"transcript_id"===n[0]&&(d=n[1]),w[i]=r)}),this.nameField)v=w[this.nameField];else for(m=0;m<g.length;m++)if(w.hasOwnProperty(g[m])){this.nameField=g[m],v=w[this.nameField];break}return{id:d,parent:p,name:v,type:h,chr:n,start:a,end:o,score:l,strand:s,color:f,attributeString:u,popupData:function(){var t,e,i=this.attributeString.split(";"),r=[];return i.forEach(function(i){var n=i.trim().split(y,2);2===n.length&&void 0!==n[1]&&(t=n[0].trim(),e=n[1].trim(),e.startsWith('"')&&e.endsWith('"')&&(e=e.substr(1,e.length-2)),r.push({name:t,value:e}))}),r}}}function p(t,e){var i,r,n,a,o=this.format,s=o.coords||0;return t.length<3?null:(r=t[o.chr],n=parseInt(t[o.start])-s,a=void 0!==o.end?parseInt(t[o.end]):n+1,i={chr:r,start:n,end:a},o.fields&&o.fields.forEach(function(e,r){r!=o.chr&&r!=o.start&&r!=o.end&&(i[e]=t[r])}),i)}var f=Number.MAX_VALUE,g=["Name","gene_name","gene","gene_id","alias","locus"];return t.FeatureParser=function(e,i,r){var f;switch(this.format=e,this.nameField=r?r.nameField:void 0,this.skipRows=0,i&&(this.decode=i),e){case"narrowpeak":case"broadpeak":case"peaks":this.decode=o,this.delimiter=/\s+/;break;case"bedgraph":this.decode=s,this.delimiter=/\s+/;break;case"wig":this.decode=h,this.delimiter=/\s+/;break;case"gff3":case"gff":case"gtf":this.decode=d,this.delimiter="\t";break;case"aneu":this.decode=l,this.delimiter="\t";break;case"fusionjuncspan":this.decode=c,this.delimiter=/\s+/;break;case"gtexgwas":this.skipRows=1,this.decode=u,this.delimiter="\t";break;case"refflat":this.decode=a,this.delimiter="\t";break;default:f=t.browser.getFormat(e),void 0!==f?(this.decode=p,this.format=f,this.delimiter=f.delimiter||"\t"):(this.decode=n,this.delimiter=/\s+/)}},t.FeatureParser.prototype.parseHeader=function(t){var e,i,n,a=t.splitLines(),o=a.length;for(i=0;i<o&&(e=a[i],e.startsWith("track")||e.startsWith("#")||e.startsWith("browser"));i++)e.startsWith("track")?n=r(e):e.startsWith("##gff-version 3")&&(this.format="gff3",n||(n={}),n.format="gff3");return n},t.FeatureParser.prototype.parseFeatures=function(t){if(!t)return null;var r,n,a,o,s,h,l=t.splitLines(),c=l.length,u=[],d=0,p=this.decode,g=this.format,v=this.delimiter||"\t";for(s=this.skipRows;s<c;s++)o=l[s],o.startsWith("track")||o.startsWith("#")||o.startsWith("browser")||("wig"===g&&o.startsWith("fixedStep")?r=e(o):"wig"===g&&o.startsWith("variableStep")?r=i(o):(a=l[s].split(v),a.length<1||(n=p.call(this,a,r),n&&(u.length<f?u.push(n):(h=Math.floor(Math.random()*d),h<f&&(u[h]=n)),d++))));return u},t}(igv||{}),igv=function(t){function e(e){e.forEach(function(e){e.name&&(t.browser.featureDB[e.name.toUpperCase()]=e)})}function i(t,e){function i(t,e){var i=[];t.sort(function(t,e){return t.start-e.start}),i.push(-1e3),t.forEach(function(t){var r,n=Math.min(i.length,e),a=t.start;for(r=0;r<n;r++)if(a>=i[r])return t.row=r,void(i[r]=t.end);t.row=r,i[r]=t.end})}if(null!=t&&0!==t.length){var r={},n=[];t.forEach(function(t){var e=t.chr,i=r[e];i||(i=[],r[e]=i,n.push(e)),i.push(t)}),n.forEach(function(t){i(r[t],e)})}}return t.FeatureSource=function(e){this.config=e||{},this.sourceType=void 0===e.sourceType?"file":e.sourceType,"ga4gh"===e.sourceType?this.reader=new t.Ga4ghVariantReader(e):"immvar"===e.sourceType?this.reader=new t.ImmVarReader(e):"eqtl"===e.type?"gtex-ws"===e.sourceType?this.reader=new t.GtexReader(e):this.reader=new t.GtexFileReader(e):"bigquery"===e.sourceType?this.reader=new t.BigQueryFeatureReader(e):this.reader=new t.FeatureFileReader(e),this.visibilityWindow=e.visibilityWindow},t.FeatureSource.prototype.getFileHeader=function(){var r=this,n=this.config.maxRows||500;return new Promise(function(a,o){r.header?a(r.header):"function"==typeof r.reader.readHeader?r.reader.readHeader().then(function(o){if(o){var s=o.features;s&&("gtf"!==r.config.format&&"gff3"!==r.config.format&&"gff"!==r.config.format||(s=new t.GFFHelper(r.config.format).combineFeatures(s)),i(s,n),r.featureCache=new t.FeatureCache(s),r.config.searchable&&e(s))}o&&o.format&&(r.config.format=o.format),a(o)}).catch(o):a(null)})},t.FeatureSource.prototype.getFeatures=function(r,n,a){var o=this;return new Promise(function(s,h){var l=new t.GenomicInterval(r,n,a),c=o.featureCache,u=o.config.maxRows||500;if(c&&(void 0===c.range||c.range.containsRange(l)))s(o.featureCache.queryFeatures(r,n,a));else{if("file"===o.sourceType&&(void 0===o.visibilityWindow||o.visibilityWindow<=0)){l.start=0;var d=t.browser.genome.getChromosome(r);l.end=void 0===d?Number.MAX_VALUE:d.bpLength}o.reader.readFeatures(r,l.start,l.end).then(function(h){if(h&&"function"==typeof h.forEach){var c=o.reader.indexed||"ga4gh"===o.config.sourceType||"immvar"===o.config.sourceType||"gtex"===o.config.sourceType||"bigquery"===o.config.sourceType;"gtf"!==o.config.format&&"gff3"!==o.config.format&&"gff"!==o.config.format||(h=new t.GFFHelper(o.config.format).combineFeatures(h)),o.featureCache=c?new t.FeatureCache(h,l):new t.FeatureCache(h),i(h,u),o.config.searchable&&e(h),s(o.featureCache.queryFeatures(r,n,a))}else s(null)}).catch(h)}})},t}(igv||{}),igv=function(t){function e(e){var i=[];for(var r in e)e.hasOwnProperty(r)&&"chr"!==r&&"start"!==r&&"end"!==r&&"row"!==r&&t.isStringOrNumber(e[r])&&i.push({name:r,value:e[r]});return i}function i(t,e,i){var r=Math.round((t.start-e)/i),n=Math.round((t.end-e)/i),a=n-r;return a<3&&(a=3,r-=1),{px:r,px1:n,pw:a}}function r(e,r,a,o,s){var h,l,c,u,d,p,f,g,v,m,b,y,w,k,x,S=i(e,r,a),_=this.featureHeight,C=this.arrowSpacing,T=this.color;if(this.config.colorBy){var A=e[this.config.colorBy.field];A&&(T=this.config.colorBy.pallete[A])}else e.color&&(T=e.color);if(s.fillStyle=T,s.strokeStyle=T,"SQUISHED"===this.displayMode&&void 0!=e.row?(_=this.featureHeight/2,w=this.expandedCallHeight*e.row+2):w="EXPANDED"===this.displayMode&&void 0!=e.row?this.squishedCallHeight*e.row+5:5,u=w+_/2,y=_/2,b=u-y/2,c=e.exons?e.exons.length:0,0==c)s.fillRect(S.px,w,S.pw,_);else{for(t.graphics.strokeLine(s,S.px+1,u,S.px1-1,u),d="+"==e.strand?1:-1,h=S.px+C/2;h<S.px1;h+=C)t.graphics.strokeLine(s,h-2*d,u-2,h,u),t.graphics.strokeLine(s,h-2*d,u+2,h,u);for(l=0;l<c;l++)if(p=e.exons[l],f=Math.round((p.start-r)/a),g=Math.round((p.end-r)/a),m=Math.max(1,g-f),p.utr)s.fillRect(f,b,m,y);else if(p.cdStart&&(v=Math.round((p.cdStart-r)/a),s.fillRect(f,b,v-f,y),m-=v-f,f=v),p.cdEnd&&(v=Math.round((p.cdEnd-r)/a),s.fillRect(v,b,g-v,y),m-=g-v,g=v),s.fillRect(f,w,m,_),m>C+5){for(s.fillStyle="white",s.strokeStyle="white",h=f+C/2;h<g;h+=C)t.graphics.strokeLine(s,h-2*d,u-2,h,u),t.graphics.strokeLine(s,h-2*d,u+2,h,u);s.fillStyle=T,s.strokeStyle=T}}k=Math.round(t.browser.referenceFrame.toPixels(t.browser.referenceFrame.start-r)),x=k+t.browser.trackViewportWidth(),n.call(this,s,e,S.px,S.px1,w,k,x)}function n(e,i,r,n,o,s,h){var l,c,u,d,p,f,g,v;n<s||r>h?(d=r,p=n):(d=Math.max(r,s),p=Math.min(n,h)),t.browser.selection&&"genes"===this.config.type&&void 0!==i.name&&(l=t.browser.selection.colorForGene(i.name)),v=p-d>e.measureText(i.name).width,(v||l)&&"SQUISHED"!=this.displayMode&&void 0!==i.name&&(c={font:"10px PT Sans",textAlign:"center",fillStyle:l||this.color,strokeStyle:l||this.color},"COLLAPSED"===this.displayMode&&"SLANT"===this.labelDisplayMode&&(u={rotate:{angle:45}},delete c.textAlign),f=d+(p-d)/2,g=a(o,u),t.graphics.fillText(e,i.name,f,g,c,u))}function a(t,e){return e?t+20:t+25}function o(e){var i=function(){e.trackView&&e.trackView.tile&&"SQUISHED"!==e.displayMode&&e.trackView.update()},r=function(n){e===n&&(t.browser.un("trackdrag",i),t.browser.un("trackremoved",r))};t.browser.on("trackdragend",i),t.browser.on("trackremoved",r)}function s(t,e,r,n,a){var o,s=i(t,e,r),h=20,l=10;switch(t.genotype){case"HOMVAR":o=this.homvarColor;break;case"HETVAR":o=this.hetvarColor;break;default:o=this.color}a.fillStyle=o,a.fillRect(s.px,h,s.pw,l)}function h(t,e,r,n,a){var o=(i(t,e,r),5),s="EXPANDED"===this.displayMode?this.squishedCallHeight:this.expandedCallHeight;"SQUISHED"===this.displayMode&&void 0!=t.row?o=s*t.row:"EXPANDED"===this.displayMode&&void 0!=t.row&&(o=s*t.row);var h=o+.5*s,l=h-.5*s,c=h+.5*s,u=Math.round((t.junction_left-e)/r),d=Math.round((t.junction_right-e)/r);a.beginPath(),a.moveTo(u,h),a.bezierCurveTo(u,l,d,l,d,h),a.lineWidth=1+Math.log(t.num_junction_reads)/Math.log(2),a.strokeStyle="blue",a.stroke();for(var p=t.spanning_frag_coords,f=0;f<p.length;f++){var g=p[f],v=Math.round((g.left-e)/r),m=Math.round((g.right-e)/r);a.beginPath(),a.moveTo(v,h),a.bezierCurveTo(v,c,m,c,m,h),a.lineWidth=1,a.strokeStyle="purple",a.stroke()}}return t.FeatureTrack=function(e){t.configTrack(this,e),this.displayMode=e.displayMode||"COLLAPSED",this.labelDisplayMode=e.labelDisplayMode,this.variantHeight=e.variantHeight||this.height,this.squishedCallHeight=e.squishedCallHeight||30,this.expandedCallHeight=e.expandedCallHeight||15,this.featureHeight=e.featureHeight||14,void 0===e.maxRows&&(e.maxRows=500),this.maxRows=e.maxRows,e.url&&(e.url.toLowerCase().endsWith(".bigbed")||e.url.toLowerCase().endsWith(".bb"))?this.featureSource=new t.BWSource(e):this.featureSource=new t.FeatureSource(e),e.render?this.render=e.render:"variant"===e.type?(this.render=s,this.homvarColor="rgb(17,248,254)",this.hetvarColor="rgb(34,12,253)"):"FusionJuncSpan"===e.type?(this.render=h,this.height=e.height||50,this.autoHeight=!1):(this.render=r,this.arrowSpacing=30,o(this))},t.FeatureTrack.prototype.getFileHeader=function(){var t=this;return new Promise(function(e,i){"function"==typeof t.featureSource.getFileHeader?t.featureSource.getFileHeader().then(function(i){i&&(i.name&&!t.config.name&&(t.name=i.name),i.color&&!t.config.color&&(t.color="rgb("+i.color+")")),e(i)}).catch(i):e(null)})},t.FeatureTrack.prototype.getFeatures=function(t,e,i){var r=this;return new Promise(function(n,a){r.featureSource.getFeatures(t,e,i).then(n).catch(a)})},t.FeatureTrack.prototype.computePixelHeight=function(t){if("COLLAPSED"===this.displayMode)return this.variantHeight;var e=0;return t&&"function"==typeof t.forEach&&t.forEach(function(t){t.row&&t.row>e&&(e=t.row)}),Math.max(this.variantHeight,(e+1)*("SQUISHED"===this.displayMode?this.expandedCallHeight:this.squishedCallHeight))},t.FeatureTrack.prototype.draw=function(e){var i=this,r=e.features,n=e.context,a=e.bpPerPixel,o=e.bpStart,s=e.pixelWidth,h=e.pixelHeight,l=o+s*a+1;if(t.graphics.fillRect(n,0,0,s,h,{fillStyle:"rgb(255, 255, 255)"}),r){for(var c,u=0,d=r.length;u<d;u++)if(c=r[u],!(c.end<o)){if(c.start>l)break;i.render.call(this,c,o,a,h,n)}}else console.log("No feature list")},t.FeatureTrack.prototype.popupData=function(i,r,n){if(this.featureSource.featureCache){
var a,o=t.browser.referenceFrame.chr,s=2*t.browser.referenceFrame.bpPerPixel,h=this.featureSource.featureCache.queryFeatures(o,i-s,i+s);if("COLLAPSED"!=this.displayMode&&(a=Math.floor("SQUISHED"===this.displayMode?n/this.expandedCallHeight:n/this.squishedCallHeight)),h&&h.length>0){var l=[];return h.forEach(function(t){if(t.end>=i-s&&t.start<=i+s&&(void 0===a||void 0===t.row||a===t.row)){var r;r=t.popupData?t.popupData(i):e(t),r&&(l.length>0&&l.push("<HR>"),Array.prototype.push.apply(l,r))}}),l}}return null},t.FeatureTrack.prototype.popupMenuItems=function(e){var i=this,r=[],n={COLLAPSED:"Collapse",SQUISHED:"Squish",EXPANDED:"Expand"},a='<i class="fa fa-check fa-check-shim"></i>',o='<i class="fa fa-check fa-check-shim fa-check-hidden"></i>',s='<div class="igv-track-menu-item">',h='<div class="igv-track-menu-item igv-track-menu-border-top">';return r.push(t.colorPickerMenuItem(e,this.trackView)),["COLLAPSED","SQUISHED","EXPANDED"].forEach(function(t,l){var c,u;c=0===l?h:s,u=t===i.displayMode?c+a+n[t]+"</div>":c+o+n[t]+"</div>",r.push({object:$(u),click:function(){e.hide(),i.displayMode=t,i.trackView.update()}})}),r},t}(igv||{}),igv=function(t){function e(){n=new Set,a=new Set,o=new Set,s=new Set,n.addAll(["transcript","primary_transcript","processed_transcript","mRNA","mrna"]),a.addAll(["CDS","cds","start_codon","stop_codon"]),o.addAll(["5UTR","3UTR","UTR","five_prime_UTR","three_prime_UTR","3'-UTR","5'-UTR"]),s.addAll(["exon","coding-exon"])}function i(t){var e={},i=[];return t.forEach(function(t){var r,a;n.has(t.type)&&(r=t.id,r?(a=new GFFTranscript(t),e[r]=a,i.push(a)):i.push(t))}),t.forEach(function(t){var r,n;s.has(t.type)&&(r=t.id,r&&(n=e[r],void 0===n&&(n=new GFFTranscript(t),e[r]=n,i.push(n)),n.addExon(t)))}),t.forEach(function(t){var r,n;(a.has(t.type)||o.has(t.type))&&(r=t.id,r&&(n=e[r],void 0===n&&(n=new GFFTranscript(t),e[r]=n,i.push(n)),o.has(t.type)?n.addUTR(t):n.addCDS(t)))}),i.forEach(function(t){t instanceof GFFTranscript&&t.finish()}),i.sort(function(t,e){return t.start-e.start}),i}function r(t){function e(t){return t.parent&&""!==t.parent.trim()?t.parent.trim().split(","):null}var i,r={},h=[];return t.forEach(function(t){var e,i;n.has(t.type)&&(e=t.id,e?(i=new GFFTranscript(t),r[e]=i,h.push(i)):h.push(t))}),t.forEach(function(t){var n;s.has(t.type)&&(i=e(t),i?i.forEach(function(e){n=r[e],void 0===n&&(n=new GFFTranscript(t),r[e]=n,h.push(n)),n.addExon(t)}):h.push(t))}),t.forEach(function(t){var n;(a.has(t.type)||o.has(t.type))&&(i=e(t),i?i.forEach(function(e){n=r[e],void 0===n&&(n=new GFFTranscript(t),r[e]=n,h.push(n)),o.has(t.type)?n.addUTR(t):n.addCDS(t)}):h.push(t))}),h.forEach(function(t){t instanceof GFFTranscript&&t.finish()}),h.sort(function(t,e){return t.start-e.start}),h}var n,a,o,s;return t.GFFHelper=function(t){this.format=t},t.GFFHelper.prototype.combineFeatures=function(t){return void 0===n&&e(),"gff3"===this.format?r.call(this,t):i.call(this,t)},GFFTranscript=function(t){Object.assign(this,t),this.exons=[],this.attributeString=t.attributeString},GFFTranscript.prototype.addExon=function(t){this.exons.push({start:t.start,end:t.end}),this.start=Math.min(this.start,t.start),this.end=Math.max(this.end,t.end)},GFFTranscript.prototype.addCDS=function(t){var e,i,r=this.exons;for(e=0;e<r.length;e++)if(r[e].start<=t.start&&r[e].end>=t.end){i=r[e];break}i?(i.cdStart=i.cdStart?Math.min(t.start,i.cdStart):t.start,i.cdEnd=i.cdEnd?Math.max(t.end,i.cdEnd):t.end):r.push({start:t.start,end:t.end,cdStart:t.start,cdEnd:t.end}),this.start=Math.min(this.start,t.start),this.end=Math.max(this.end,t.end),this.cdStart=this.cdStart?Math.min(t.start,this.cdStart):t.start,this.cdEnd=this.cdEnd?Math.max(t.end,this.cdEnd):t.end},GFFTranscript.prototype.addUTR=function(t){var e,i,r=this.exons;for(e=0;e<r.length;e++)if(r[e].start<=t.start&&r[e].end>=t.end){i=r[e];break}i?t.start===i.start&&t.end===i.end&&(i.utr=!0):r.push({start:t.start,end:t.end,utr:!0}),this.start=Math.min(this.start,t.start),this.end=Math.max(this.end,t.end)},GFFTranscript.prototype.finish=function(){var t=this.cdStart,e=this.cdEnd;this.exons.sort(function(t,e){return t.start-e.start}),t&&this.exons.forEach(function(i){(i.end<t||i.start>e)&&(i.utr=!0)})},t}(igv||{}),igv=function(t){var e=(Number.MAX_VALUE,0),i=1,r=2,n=3;return t.SegParser=function(){},t.SegParser.prototype.parseHeader=function(t){var e,i,r,n=t.splitLines(),a=n.length;for(i=0;i<a;i++)if(e=n[i],!e.startsWith("#"))return r=e.split("\t"),this.header={headings:r,lineCount:i+1},this.header;return this.header},t.SegParser.prototype.parseFeatures=function(t){var a,o,s,h,l=t?t.splitLines():[],c=l.length,u=[];for(this.header||(this.header=this.parseHeader(t)),h=this.header.headings.length-1,s=this.header.lineCount;s<c;s++)o=l[s],a=l[s].split("\t"),a.length>h&&u.push({sample:a[e],chr:a[i],start:parseInt(a[r]),end:parseInt(a[n]),value:parseFloat(a[h])});return u},t}(igv||{}),igv=function(t){var e=1;return t.SegTrack=function(e){t.configTrack(this,e),this.displayMode=e.displayMode||"SQUISHED",this.maxHeight=e.maxHeight||500,this.sampleSquishHeight=e.sampleSquishHeight||2,this.sampleExpandHeight=e.sampleExpandHeight||12,this.posColorScale=e.posColorScale||new t.GradientColorScale({low:.1,lowR:255,lowG:255,lowB:255,high:1.5,highR:255,highG:0,highB:0}),this.negColorScale=e.negColorScale||new t.GradientColorScale({low:-1.5,lowR:0,lowG:0,lowB:255,high:-.1,highR:255,highG:255,highB:255}),this.sampleCount=0,this.samples={},this.sampleNames=[],this.featureSource=new t.FeatureSource(this.config)},t.SegTrack.prototype.popupMenuItems=function(t){var e=this;return[{name:"SQUISHED"===this.displayMode?"Expand sample hgt":"Squish sample hgt",click:function(){t.hide(),e.toggleSampleHeight()}}]},t.SegTrack.prototype.toggleSampleHeight=function(){this.displayMode="SQUISHED"===this.displayMode?"EXPANDED":"SQUISHED",this.trackView.update()},t.SegTrack.prototype.getFeatures=function(t,e,i){var r=this;return new Promise(function(n,a){0===r.sampleCount&&r.featureSource.reader.allSamples?r.featureSource.reader.allSamples().then(function(o){o.forEach(function(t){r.samples[t]=r.sampleCount,r.sampleNames.push(t),r.sampleCount++}),r.featureSource.getFeatures(t,e,i).then(n).catch(a)}).catch(a):r.featureSource.getFeatures(t,e,i).then(n).catch(a)})},t.SegTrack.prototype.draw=function(e){function i(t){var e;if(void 0===S.isLog)for(S.isLog=!1,e=0;e<t.length;e++)if(t[e].value<0)return void(S.isLog=!0)}var r,n,a,o,s,h,l,c,u,d,p,f,g,v,m,b,y,w,k,x,S=this;if(k="SQUISHED"===this.displayMode?this.sampleSquishHeight:this.sampleExpandHeight,x="SQUISHED"===this.displayMode?0:1,n=e.context,s=e.pixelWidth,h=e.pixelHeight,t.graphics.fillRect(n,0,0,s,h,{fillStyle:"rgb(255, 255, 255)"}),r=e.features){for(a=e.bpPerPixel,o=e.bpStart,l=o+s*a+1,w=a,p=0,u=r.length;p<u;p++)d=r[p].sample,this.samples.hasOwnProperty(d)||(this.samples[d]=S.sampleCount,this.sampleNames.push(d),this.sampleCount++);for(i(r),p=0,u=r.length;p<u;p++)if(c=r[p],!(c.end<o)){if(c.start>l)break;f=S.samples[c.sample]*k+x,v=c.value,S.isLog||(v=Math.log2(v/2)),g=v<-.1?S.negColorScale.getColor(v):v>.1?S.posColorScale.getColor(v):"white",m=Math.round((c.start-o)/w),b=Math.round((c.end-o)/w),y=Math.max(1,b-m),t.graphics.fillRect(n,m,f,y,k-2*x,{fillStyle:g})}}else console.log("No feature list")},t.SegTrack.prototype.computePixelHeight=function(t){var e="SQUISHED"===this.displayMode?this.sampleSquishHeight:this.sampleExpandHeight;for(i=0,len=t.length;i<len;i++)sample=t[i].sample,this.samples.hasOwnProperty(sample)||(this.samples[sample]=this.sampleCount,this.sampleNames.push(sample),this.sampleCount++);return this.sampleCount*e},t.SegTrack.prototype.sortSamples=function(t,e,i,r,n){var a,o,s,h,l,c,u,d=this,p=i-e,f={};this.featureSource.getFeatures(t,e,i).then(function(t){for(l=0,p=t.length;l<p;l++)if(a=t[l],!(a.end<e)){if(a.start>i)break;o=Math.max(e,a.start),s=Math.min(i,a.end),h=(s-o)/p,c=f[a.sample],c||(c=0),f[a.sample]=c+h*a.value}for(u=Object.keys(d.samples),u.sort(function(t,e){var i=f[t],n=f[e];return i||(i=Number.MAX_VALUE),n||(n=Number.MAX_VALUE),i==n?0:i>n?r:r*-1}),l=0;l<u.length;l++)d.samples[u[l]]=l;d.sampleNames=u,n()})},t.SegTrack.prototype.altClick=function(i,r){var n=t.browser.referenceFrame,a=n.toBP(2.5),o=i-a,s=i+a,h=n.chr,l=this;this.sortSamples(h,o,s,e,function(){l.trackView.update(),$(l.trackView.viewportDiv).scrollTop(0)}),e*=-1},t.SegTrack.prototype.popupData=function(e,i,r){var n,a,o,s="SQUISHED"===this.displayMode?this.sampleSquishHeight:this.sampleExpandHeight;if(a=Math.floor(r/s),a<this.sampleNames.length){if(n=this.sampleNames[a],o=[{name:"Sample",value:n}],this.featureSource.featureCache){var h=t.browser.referenceFrame.chr,l=this.featureSource.featureCache.queryFeatures(h,e,e);l.forEach(function(t){t.sample===n&&o.push({name:"Value",value:t.value})})}return o}return null},t}(igv||{}),igv=function(t){return t.loadTribbleIndex=function(e,i){var r=t.browser?t.browser.genome:null;return new Promise(function(n,a){function o(t){var e=(t.getInt(),t.getInt(),t.getInt());t.getString(),t.getLong(),t.getLong(),t.getString();if(flags=t.getInt(),e<3&&(flags&SEQUENCE_DICTIONARY_FLAG)==SEQUENCE_DICTIONARY_FLAG,e>=3)for(var i=t.getInt();i-- >0;){t.getString(),t.getString()}}function s(t){var e=t.getString(),i=0;r&&(e=r.getChromosomeName(e));for(var n=(t.getInt(),t.getInt()),a=(t.getInt(),t.getInt()>0,t.getInt(),new Array),o=t.getLong(),a=new Array,s=0;s<n;s++){var h=t.getLong();a.push({min:o,max:h}),o=h,h>i&&(i=h)}return{chr:e,blocks:a}}igvxhr.loadArrayBuffer(e,{headers:i.headers,withCredentials:i.withCredentials}).then(function(e){if(e){var i={},r=new t.BinaryParser(new DataView(e));o(r);for(var a=r.getInt();a-- >0;){var h=s(r);i[h.chr]=h}n(new t.TribbleIndex(i))}else n(null)}).catch(function(t){console.log(t),n(null)})})},t.TribbleIndex=function(t){this.chrIndex=t},t.TribbleIndex.prototype.blocksForRange=function(t,e,i){var r=this.chrIndex[t];if(r){var n=r.blocks,a=n[n.length-1],o={minv:{block:n[0].min,offset:0},maxv:{block:a.max,offset:0}};return[o]}return null},t}(igv||{}),igv=function(t){function e(t){var e=0,i=-Number.MAX_VALUE;return t.forEach(function(t){e=Math.min(e,t.value),i=Math.max(i,t.value)}),{min:e,max:i}}function i(t,e){return t>0&&e<0||t<0&&e>0}return t.WIGTrack=function(e){this.config=e,this.url=e.url,void 0===e.color&&(e.color="rgb(150,150,150)"),t.configTrack(this,e),"bigwig"===e.format?this.featureSource=new t.BWSource(e):this.featureSource=new t.FeatureSource(e),this.dataRange={min:e.min,max:e.max},this.paintAxis=t.paintAxis},t.WIGTrack.prototype.getFeatures=function(t,e,i){var r=this;return new Promise(function(n,a){r.featureSource.getFeatures(t,e,i).then(n).catch(a)})},t.WIGTrack.prototype.popupMenuItems=function(e){var i=this,r=[],n=[];return r.push(t.colorPickerMenuItem(e,this.trackView)),r.push(t.dataRangeMenuItem(e,this.trackView)),n.push('<div class="igv-track-menu-item">'),n.push(!0===i.autoScale?'<i class="fa fa-check fa-check-shim">':'<i class="fa fa-check fa-check-shim fa-check-hidden">'),n.push("</i>"),n.push("Autoscale"),n.push("</div>"),r.push({object:$(n.join("")),click:function(){var t=$(this).find("i");e.hide(),i.autoScale=!i.autoScale,!0===i.autoScale?t.removeClass("fa-check-hidden"):t.addClass("fa-check-hidden"),i.trackView.update()}}),r},t.WIGTrack.prototype.draw=function(r){function n(e,r,n){var l,p,v,m,b;e.end<d||e.start>g||(v=Math.floor((e.start-d)/u),b=Math.ceil((e.end-d)/u),m=Math.max(1,b-v),i(a,o)?e.value<0?(l=o/s,p=-e.value/s):(l=(o-e.value)/s,p=e.value/s):a<0?(l=0,p=-e.value/s):(l=1-e.value/s,p=e.value/s),t.graphics.fillRect(c,v,l*f,m,p*f,{fillStyle:h.color}))}var a,o,s,h=this,l=r.features,c=r.context,u=r.bpPerPixel,d=r.bpStart,p=r.pixelWidth,f=r.pixelHeight,g=d+p*u+1;if(l&&l.length>0){if(h.autoScale||void 0===h.dataRange.max){var v=e(l);a=v.min,o=v.max}else a=void 0===h.dataRange.min?0:h.dataRange.min,o=h.dataRange.max;h.dataRange.min=a,h.dataRange.max=o,s=o-a,l.forEach(n)}},t}(igv||{}),igv=function(t){function e(t){var e,r,a,o=0,s=[];for(i=0;i<t.length;i++)e=t[i],a=n[e.operation],r=parseInt(e.operationLength),"M"!=a&&"EQ"!=a&&"X"!=a&&"D"!=a&&"N"!=a&&"="!=a||(o+=r),s.push({len:r,ltr:a});return{lengthOnRef:o,array:s}}function e(t){var e,r,a,o=0,s=[];for(i=0;i<t.length;i++)e=t[i],a=n[e.operation],r=parseInt(e.operationLength),"M"!=a&&"EQ"!=a&&"X"!=a&&"D"!=a&&"N"!=a&&"="!=a||(o+=r),s.push({len:r,ltr:a});return{lengthOnRef:o,array:s}}function r(t,e){for(var i,r,n,a=[],o=0,s=t.start,h=e.length,l=0;l<h;l++){var c=e[l];switch(c.ltr){case"H":break;case"P":break;case"S":o+=c.len,n="S";break;case"N":s+=c.len,n="N";break;case"D":s+=c.len,n="D";break;case"I":o+=c.len;break;case"M":case"EQ":case"=":case"X":i="*"===t.seq?"*":t.seq.substr(o,c.len),r="*"===t.qual?"*":t.qual.slice(o,c.len),a.push({start:s,len:c.len,seq:i,qual:r,gapType:n}),o+=c.len,s+=c.len;break;default:console.log("Error processing cigar element: "+c.len+c.ltr)}}return a}var n={ALIGNMENT_MATCH:"M",INSERT:"I",DELETE:"D",SKIP:"N",CLIP_SOFT:"S",CLIP_HARD:"H",PAD:"P",SEQUENCE_MATCH:"=",SEQUENCE_MISMATCH:"X"};return t.Ga4ghAlignment=function(t,i){this.readName=t.fragmentName,this.properPlacement=t.properPlacement,this.duplicateFragment=t.duplicateFragment,this.numberReads=t.numberReads,this.fragmentLength=t.fragmentLength,this.readNumber=t.readNumber,this.failedVendorQualityChecks=t.failedVendorQualityChecks,this.secondaryAlignment=t.secondaryAlignment,this.supplementaryAlignment=t.supplementaryAlignment,this.seq=t.alignedSequence,this.qual=t.alignedQuality,this.tagDict=t.info,alignment=t.alignment,alignment?(this.mapped=!0,this.chr=t.alignment.position.referenceName,i&&(this.chr=i.getChromosomeName(this.chr)),this.start=parseInt(t.alignment.position.position),this.strand=!t.alignment.position.reverseStrand,this.mq=t.alignment.mappingQuality,cigarDecoded=e(t.alignment.cigar),this.lengthOnRef=cigarDecoded.lengthOnRef,this.blocks=r(this,cigarDecoded.array)):this.mapped=!1,t.nextMatePosition&&(this.mate={chr:t.nextMatePosition.referenceFrame,position:parseInt(t.nextMatePosition.position),strand:!t.nextMatePosition.reverseStrand},this.info=t.info)},t.Ga4ghAlignment.prototype.isMapped=function(){return this.mapped},t.Ga4ghAlignment.prototype.isPaired=function(){return this.numberReads&&this.numberReads>1},t.Ga4ghAlignment.prototype.isProperPair=function(){return void 0===this.properPlacement||this.properPlacement},t.Ga4ghAlignment.prototype.isFirstOfPair=function(){return this.readNumber&&0===this.readNumber},t.Ga4ghAlignment.prototype.isSecondOfPair=function(){return this.readNumber&&1===this.readNumber},t.Ga4ghAlignment.prototype.isSecondary=function(){return this.secondaryAlignment},t.Ga4ghAlignment.prototype.isSupplementary=function(){return this.supplementaryAlignment},t.Ga4ghAlignment.prototype.isFailsVendorQualityCheck=function(){return this.failedVendorQualityChecks},t.Ga4ghAlignment.prototype.isDuplicate=function(){return this.duplicateFragment},t.Ga4ghAlignment.prototype.isMateMapped=function(){return this.mate},t.Ga4ghAlignment.prototype.mateStrand=function(){return this.mate&&this.mate.strand},t.Ga4ghAlignment.prototype.tags=function(){return this.info},t.Ga4ghAlignment.prototype.popupData=function(e){function i(t){return t?"Yes":"No"}var r;nameValues=[],nameValues.push({name:"Read Name",value:this.readName}),nameValues.push("<hr>"),nameValues.push({name:"Alignment Start",value:t.numberFormatter(1+this.start),borderTop:!0}),nameValues.push({name:"Read Strand",value:!0===this.strand?"(+)":"(-)",borderTop:!0}),nameValues.push({name:"Cigar",value:this.cigar}),nameValues.push({name:"Mapped",value:i(this.isMapped())}),nameValues.push({name:"Mapping Quality",value:this.mq}),nameValues.push({name:"Secondary",value:i(this.isSecondary())}),nameValues.push({name:"Supplementary",value:i(this.isSupplementary())}),nameValues.push({name:"Duplicate",value:i(this.isDuplicate())}),nameValues.push({name:"Failed QC",value:i(this.isFailsVendorQualityCheck())}),this.isPaired()&&(nameValues.push("<hr>"),nameValues.push({name:"First in Pair",value:!this.isSecondOfPair(),borderTop:!0}),nameValues.push({name:"Mate is Mapped",value:i(this.isMateMapped())}),this.isMapped()&&(nameValues.push({name:"Mate Start",value:this.matePos}),nameValues.push({name:"Mate Strand",value:this.mateStrand()?"(-)":"(+)"}),nameValues.push({name:"Insert Size",value:this.fragmentLength}))),nameValues.push("<hr>"),this.tags(),r=!0;for(var n in this.tagDict)this.tagDict.hasOwnProperty(n)&&(r?(nameValues.push({name:n,value:this.tagDict[n],borderTop:!0}),r=!1):nameValues.push({name:n,value:this.tagDict[n]}));return nameValues},t}(igv||{}),igv=function(t){function e(t,e){var i;if("461916304629"===e||"337315832689"===e){for(i=1;i<23;i++)t["chr"+i]=i;t.chrX="X",t.chrY="Y",t.chrM="MT"}}var i={ALIGNMENT_MATCH:"M",INSERT:"I",DELETE:"D",SKIP:"N",CLIP_SOFT:"S",CLIP_HARD:"H",PAD:"P",SEQUENCE_MATCH:"=",SEQUENCE_MISMATCH:"X"};return t.Ga4ghAlignmentReader=function(e){this.config=e,this.url=e.url,this.filter=e.filter||new t.BamFilter,this.readGroupSetIds=e.readGroupSetIds,this.authKey=e.authKey,this.samplingWindowSize=void 0===e.samplingWindowSize?100:e.samplingWindowSize,this.samplingDepth=void 0===e.samplingDepth?100:e.samplingDepth,e.viewAsPairs?this.pairsSupported=!0:this.pairsSupported=void 0===e.pairsSupported||e.pairsSupported},t.Ga4ghAlignmentReader.prototype.readAlignments=function(r,n,a){var o=this;return new Promise(function(s,h){function l(){return new Promise(function(i,r){o.chrNameMap?i(o.chrNameMap):o.readMetadata().then(function(n){if(o.chrNameMap={},t.browser&&n.readGroups&&n.readGroups.length>0){var a=n.readGroups[0].referenceSetId;if(console.log("No reference set specified"),a){var s=o.url+"/references/search";t.ga4ghSearch({url:s,body:{referenceSetId:a},decode:function(t){return t.references}}).then(function(e){e.forEach(function(e){var i=e.name,r=t.browser.genome.getChromosomeName(i);o.chrNameMap[r]=i}),i(o.chrNameMap)}).catch(r)}else e(o.chrNameMap,o.config.datasetId),i(o.chrNameMap)}else i(o.chrNameMap)}).catch(r)})}function c(e){function r(t){var e="";return t.forEach(function(t){var r=i[t.operation],n=t.operationLength;e+=n+r}),e}function n(t){return 0}function a(t){var e,r,n,a,o=0,s=[];for(a=0;a<t.length;a++)e=t[a],n=i[e.operation],r=parseInt(e.operationLength),"M"!==n&&"EQ"!==n&&"X"!==n&&"D"!==n&&"N"!==n&&"="!==n||(o+=r),s.push({len:r,ltr:n});return{lengthOnRef:o,array:s}}function s(t,e){for(var i,r,n,a,o=[],s=0,h=t.start,l=e.length,c=0;c<l;c++){var u=e[c];switch(u.ltr){case"H":break;case"P":break;case"S":s+=u.len,n="S";break;case"N":h+=u.len,n="N";break;case"D":h+=u.len,n="D";break;case"I":r="*"===t.seq?"*":t.seq.substr(s,u.len),a=t.qual?t.qual.slice(s,u.len):void 0,void 0===i&&(i=[]),i.push({start:h,len:u.len,seq:r,qual:a}),s+=u.len;break;case"M":case"EQ":case"=":case"X":r="*"===t.seq?"*":t.seq.substr(s,u.len),a=t.qual?t.qual.slice(s,u.len):void 0,o.push({start:h,len:u.len,seq:r,qual:a,gapType:n}),s+=u.len,h+=u.len;break;default:console.log("Error processing cigar element: "+u.len+u.ltr)}}return{blocks:o,insertions:i}}var h,e,l,c,u,d,p=e.alignments,f=p.length,g=[],v=t.browser.genome;for(h=0;h<f;h++)e=p[h],l=new t.BamAlignment,l.readName=e.fragmentName,l.properPlacement=e.properPlacement,l.duplicateFragment=e.duplicateFragment,l.numberReads=e.numberReads,l.fragmentLength=e.fragmentLength,l.readNumber=e.readNumber,l.failedVendorQualityChecks=e.failedVendorQualityChecks,l.secondaryAlignment=e.secondaryAlignment,l.supplementaryAlignment=e.supplementaryAlignment,l.seq=e.alignedSequence,l.qual=e.alignedQuality,l.matePos=e.nextMatePosition,l.tagDict=e.info,l.flags=n(e),c=e.alignment,c?(l.mapped=!0,l.chr=e.alignment.position.referenceName,v&&(l.chr=v.getChromosomeName(l.chr)),l.start=parseInt(e.alignment.position.position),l.strand=!e.alignment.position.reverseStrand,l.mq=e.alignment.mappingQuality,l.cigar=r(e.alignment.cigar),u=a(e.alignment.cigar),l.lengthOnRef=u.lengthOnRef,blocks=s(l,u.array),l.blocks=blocks.blocks,l.insertions=blocks.insertions):l.mapped=!1,d=e.nextMatePosition,d&&(l.mate={chr:d.referenceFrame,position:parseInt(d.position),strand:!d.reverseStrand}),o.filter.pass(l)&&g.push(l);return g}l().then(function(e){var i=e.hasOwnProperty(r)?e[r]:r,l=o.url+"/reads/search";t.ga4ghSearch({url:l,body:{readGroupSetIds:[o.readGroupSetIds],referenceName:i,start:n,end:a,pageSize:"10000"},decode:c,results:new t.AlignmentContainer(r,n,a,o.samplingWindowSize,o.samplingDepth,o.pairsSupported)}).then(s).catch(h)}).catch(h)})},t.Ga4ghAlignmentReader.prototype.readMetadata=function(){return t.ga4ghGet({url:this.url,entity:"readgroupsets",entityId:this.readGroupSetIds})},t.decodeGa4ghReadset=function(t){var e=[],i=t.fileData;return i.forEach(function(t){var i=t.refSequences;i.forEach(function(t){e.push(t.name)})}),e},t}(igv||{}),igv=function(t){function e(){var t={},e=oauth.google.access_token;return t["Cache-Control"]="no-cache",e&&(t.Authorization="Bearer "+e),t}return t.ga4ghGet=function(t){var e=t.url+"/"+t.entity+"/"+t.entityId;return igvxhr.loadJson(e,t)},t.ga4ghSearch=function(t){return new Promise(function(i,r){function n(t){t?s.pageToken=t:void 0!=s.pageToken&&delete s.pageToken;var l=JSON.stringify(s);igvxhr.loadJson(o,{sendData:l,contentType:"application/json",headers:e()}).then(function(t){var e,r;t?(r=h?h(t):t,r&&r.forEach(function(t){var e=!0;e&&a.push(t)}),e=t.nextPageToken,e?n(e):i(a)):i(a)}).catch(function(t){r(t)})}var a=t.results?t.results:[],o=t.url,s=t.body,h=t.decode,l=oauth.google.apiKey,c="?",u=t.fields;l&&(o=o+c+"key="+l,c="&"),u&&(o=o+c+"fields="+u),n()})},t.ga4ghSearchReadGroupSets=function(e){t.ga4ghSearch({url:e.url+"/readgroupsets/search",body:{datasetIds:[e.datasetId],pageSize:"10000"},decode:function(t){return t.readGroupSets}}).then(function(t){e.success(t)}).catch(function(t){console.log(t)})},t.ga4ghSearchVariantSets=function(e){t.ga4ghSearch({url:e.url+"/variantsets/search",body:{datasetIds:[e.datasetId],pageSize:"10000"},decode:function(t){return t.variantSets}}).then(function(t){e.success(t)}).catch(function(t){console.log(t)})},t.ga4ghSearchCallSets=function(e){e.datasetId?t.ga4ghSearchVariantSets({url:e.url,datasetId:e.datasetId,success:function(i){var r=[];i.forEach(function(t){r.push(t.id)}),e.datasetId=void 0,e.variantSetIds=r,t.ga4ghSearchCallSets(e)}}):t.ga4ghSearch({url:e.url+"/callsets/search",body:{variantSetIds:e.variantSetIds,pageSize:"10000"},decode:function(t){return t.callSets&&t.callSets.forEach(function(t){t.variantSetIds=e.variantSetIds}),t.callSets}}).then(function(t){e.success(t)}).catch(function(t){console.log(t)})},t.ga4ghSearchReadAndCallSets=function(e){t.ga4ghSearchReadGroupSets({url:e.url,datasetId:e.datasetId,success:function(i){t.ga4ghSearchCallSets({url:e.url,datasetId:e.datasetId,success:function(t){var r={};t.forEach(function(t){r[t.name]=t});var n=[];i.forEach(function(t){var i={readGroupSetId:t.id,name:t.name,datasetId:e.datasetId},a=r[t.name];a&&(i.callSetId=a.id,i.variantSetIds=a.variantSetIds),n.push(i)}),e.success(n)}})}})},t}(igv||{}),igv=function(t){return t.Ga4ghVariantReader=function(t){this.config=t,this.url=t.url,this.variantSetId=t.variantSetId,this.callSetIds=t.callSetIds,this.includeCalls=void 0===t.includeCalls||t.includeCalls},t.Ga4ghVariantReader.prototype.readHeader=function(){var e=this;return new Promise(function(i,r){if(e.header)i(e.header);else if(e.header={},e.includeCalls===!1)i(e.header);else{var n=e.url+"/callsets/search";t.ga4ghSearch({url:n,fields:"nextPageToken,callSets(id,name)",body:{variantSetIds:Array.isArray(e.variantSetId)?e.variantSetId:[e.variantSetId],pageSize:"10000"},decode:function(t){if(e.callSetIds){var i=[],r=new Set;return r.addAll(e.callSetIds),t.callSets.forEach(function(t){r.has(t.id)&&i.push(t)}),i}return t.callSets}}).then(function(t){e.header.callSets=t,i(e.header)}).catch(r)}})},t.Ga4ghVariantReader.prototype.readFeatures=function(e,i,r){function n(){return new Promise(function(e,i){a.chrNameMap?e(a.chrNameMap):a.readMetadata().then(function(i){a.metadata=i.metadata,a.chrNameMap={},i.referenceBounds&&t.browser&&i.referenceBounds.forEach(function(e){var i=e.referenceName,r=t.browser.genome.getChromosomeName(i);a.chrNameMap[r]=i}),e(a.chrNameMap)})})}var a=this;return new Promise(function(o,s){a.readHeader().then(function(h){n().then(function(n){var h=n.hasOwnProperty(e)?n[e]:e,l=a.url+"/variants/search";t.ga4ghSearch({url:l,fields:a.includeCalls?void 0:"nextPageToken,variants(id,variantSetId,names,referenceName,start,end,referenceBases,alternateBases,quality, filter, info)",body:{variantSetIds:Array.isArray(a.variantSetId)?a.variantSetId:[a.variantSetId],callSetIds:a.callSetIds?a.callSetIds:void 0,referenceName:h,start:i.toString(),end:r.toString(),pageSize:"10000"},decode:function(e){var i=[];return e.variants.forEach(function(e){i.push(t.createGAVariant(e))}),i}}).then(o).catch(s)}).catch(s)}).catch(s)})},t.Ga4ghVariantReader.prototype.readMetadata=function(){return t.ga4ghGet({url:this.url,entity:"variantsets",entityId:this.variantSetId})},t}(igv||{}),igv=function(t){return t.Google={isGoogleURL:function(t){return t.contains("googleapis")},translateGoogleCloudURL:function(t){var e=t.indexOf("/",5);if(e<0)return console.log("Invalid gs url: "+t),t;var i=t.substring(5,e),r=encodeURIComponent(t.substring(e+1));return"https://www.googleapis.com/storage/v1/b/"+i+"/o/"+r+"?alt=media"},addGoogleHeaders:function(t){t["Cache-Control"]="no-cache";var e=oauth.google.access_token;return e&&!t.hasOwnProperty("Authorization")&&(t.Authorization="Bearer "+e),t},addApiKey:function(t){var e=oauth.google.apiKey,i=t.contains("?")?"&":"?";return void 0===e||t.contains("key=")||e&&(t=t+i+"key="+e),t}},t}(igv||{}),igv=function(t){function e(e,i,r){igvxhr.loadString(e,{withCredentials:i}).then(function(e){for(var i,n=[],a=0,o=1,s=e.splitLines(),h=s.length,l={},c=0;c<h;c++){var u=s[c].split("\t"),d=u[0];if(i||(i=d),d!=i&&(l[i]=n,n=[],i=d,a=0,o++),5==u.length){var d=u[0],p=parseInt(u[1]),f=parseInt(u[2]),g=u[3],v=u[4];n[a++]=new t.Cytoband(p,f,g,v)}}r(l)})}function r(t,e,i){igvxhr.loadString(t,{withCredentials:e}).then(function(t){var e=t.splitLines(),r=[];e.forEach(function(t){!t.startsWith("#")&t.length>0&&r.push(t.split("\t"))}),i(r)})}return t.Genome=function(t,e,r){this.sequence=t,this.chromosomeNames=t.chromosomeNames,this.chromosomes=t.chromosomes,this.ideograms=e;var n={},a=this;this.chromosomeNames.forEach(function(t){var e=t.startsWith("chr")?t.substring(3):"chr"+t;n[e]=t,"chrM"===t&&(n.MT="chrM"),"MT"===t&&(n.chrmM="MT")}),r&&r.forEach(function(t){var e;for(i=0;i<t.length;i++)if(a.chromosomes[t[i]]){e=t[i];break}e&&t.forEach(function(t){t!==e&&(n[t]=e)})}),this.chrAliasTable=n},t.Genome.prototype.getChromosomeName=function(t){var e=this.chrAliasTable[t];return e?e:t},t.Genome.prototype.getChromosome=function(t){return t=this.getChromosomeName(t),this.chromosomes[t]},t.Genome.prototype.getCytobands=function(t){return this.ideograms?this.ideograms[t]:null},t.Genome.prototype.getLongestChromosome=function(){var t,e,i=this.chromosomes;for(e in i){if(i.hasOwnProperty(e)){var r=i[e];(void 0===t||r.bpLength>t.bpLength)&&(t=r)}return t}},t.Genome.prototype.getChromosomes=function(){return this.chromosomes},t.Chromosome=function(t,e,i){this.name=t,this.order=e,this.bpLength=i},t.Cytoband=function(t,e,i,r){this.start=t,this.end=e,this.name=i,this.stain=0,"acen"==r?this.type="c":(this.type=r.charAt(1),"p"==this.type&&(this.stain=parseInt(r.substring(4))))},t.GenomicInterval=function(t,e,i,r){this.chr=t,this.start=e,this.end=i,this.features=r},t.GenomicInterval.prototype.contains=function(t,e,i){return this.chr==t&&this.start<=e&&this.end>=i},t.GenomicInterval.prototype.containsRange=function(t){return this.chr===t.chr&&this.start<=t.start&&this.end>=t.end},t.loadGenome=function(i){return new Promise(function(n,a){function o(){var e=!(void 0!==u&&void 0===s||void 0!==d&&void 0===h);e&&n(new t.Genome(c,s,h))}var s,h,l,c,u=i.cytobandURL,d=i.aliasURL,p={};c=new t.FastaSequence(i),c.init().then(function(){l=c.chromosomeNames,p=c.chromosomes,u&&e(u,i.withCredentials,function(t){s=t,o()}),d&&r(d,i.withCredentials,function(t){h=t,o()}),o()}).catch(function(t){a(t)})})},t}(igv||{}),igv=function(t){function e(e,i){console.log(e+" "+i);var r="gtex"===i?"snp":"gene";this.selection=new GtexSelection("gene"==r?{gene:e}:{snp:e}),t.browser.update()}t.EqtlTrack=function(i){var r=i.url,n=i.name;this.config=i,this.url=r,this.name=n,this.pValueField=i.pValueField||"pValue",this.geneField=i.geneField||"geneName",this.minLogP=i.minLogP||3.5,this.maxLogP=i.maxLogP||25,this.background=i.background,this.divider=i.divider||"rgb(225,225,225)",this.dotSize=i.dotSize||2,this.height=i.height||100,this.autoHeight=!1,this.disableButtons=i.disableButtons,this.featureSource=new t.FeatureSource(i),this.onsearch=function(t,i){e.call(this,t,i)}},t.EqtlTrack.prototype.paintAxis=function(e,i,r){var n=this,a=(n.maxLogP-n.minLogP)/r,o={font:"normal 10px Arial",textAlign:"right",strokeStyle:"black"};t.graphics.fillRect(e,0,0,i,r,{fillStyle:"rgb(255, 255, 255)"});for(var s=4;s<=n.maxLogP;s+=2){var h,l,c,u,d;d=.85*i,h=d-5,l=d,c=u=r-Math.round((s-n.minLogP)/a),t.graphics.strokeLine(e,h,c,l,u,o),t.graphics.fillText(e,s,h-1,c+2,o)}o.textAlign="center",t.graphics.fillText(e,"-log10(pvalue)",i/4,r/2,o,{rotate:{angle:-90}})},t.EqtlTrack.prototype.getFeatures=function(t,e,i){return this.featureSource.getFeatures(t,e,i)},t.EqtlTrack.prototype.draw=function(e){function i(e){var i,d,p,f,g,v,m,b,y,w=e?2*r.dotSize:r.dotSize;for(t.graphics.setProperties(a,{fillStyle:"rgb(180, 180, 180)",strokeStyle:"rgb(180, 180, 180)"}),d=0;d<u;d++)if(i=n[d],m=i.snp.toUpperCase(),b=i[r.geneField].toUpperCase(),y=t.browser.selection,v=y&&(y.snp===m||y.gene===b),(!e||v)&&(y&&y.snp===m&&y.addGene(b),e&&y&&(g=y.colorForGene(b)),!(e&&void 0===g||(p=Math.round(i.position-s+.5)/o,p<0)))){if(p>h)break;var k=-Math.log(i[r.pValueField])/Math.LN10;k<r.minLogP||(f=Math.max(0+w,l-Math.round((k-r.minLogP)/c)),i.px=p,i.py=f,g&&t.graphics.setProperties(a,{fillStyle:g,strokeStyle:"black"}),t.graphics.fillCircle(a,p,f,w),t.graphics.strokeCircle(a,p,f,w))}}var r=this,n=e.features,a=e.context,o=e.bpPerPixel,s=e.bpStart,h=e.pixelWidth,l=e.pixelHeight,c=(r.maxLogP-r.minLogP)/l;if(this.background&&t.graphics.fillRect(a,0,0,h,l,{fillStyle:this.background}),t.graphics.strokeLine(a,0,l-1,h,l-1,{strokeStyle:this.divider}),a){var u=n.length;a.save(),i(!1),i(!0),a.restore()}},t.EqtlTrack.prototype.popupData=function(e,i,r){if(this.featureSource.featureCache){var n=t.browser.referenceFrame.chr,a=2*this.dotSize*t.browser.referenceFrame.bpPerPixel,o=this.featureSource.featureCache.queryFeatures(n,e-a,e+a),s=this.dotSize,h=this.name;if(o&&o.length>0){var l=[];return o.forEach(function(t){t.end>=e-a&&t.start<=e+a&&t.py-r<2*s&&(l.length>0&&l.push("<hr>"),l.push({name:"snp id",value:t.snp},{name:"gene id",value:t.geneId},{name:"gene name",value:t.geneName},{name:"p value",value:t.pValue},{name:"tissue",value:h}))}),l}}},GtexSelection=function(t){this.geneColors={},this.gene=null,this.snp=null,this.genesCount=0,t.gene&&(this.gene=t.gene.toUpperCase(),this.geneColors[this.gene]=i[this.genesCount++]),t.snp&&(this.snp=t.snp.toUpperCase())},GtexSelection.prototype.addGene=function(t){this.geneColors[t.toUpperCase()]||(this.geneColors[t.toUpperCase()]=i[this.genesCount++])},GtexSelection.prototype.colorForGene=function(t){return this.geneColors[t.toUpperCase()]};var i=new Array;return i.push("rgb(228,26,28)"),i.push("rgb(55,126,184)"),i.push("rgb(77,175,74)"),i.push("rgb(166,86,40)"),i.push("rgb(152,78,163)"),i.push("rgb(255,127,0)"),i.push("rgb(247,129,191)"),i.push("rgb(153,153,153)"),i.push("rgb(255,255,51)"),i.push("rgb(102, 194, 165"),i.push("rgb(252, 141, 98"),i.push("rgb(141, 160, 203"),i.push("rgb(231, 138, 195"),i.push("rgb(166, 216, 84"),i.push("rgb(255, 217, 47"),i.push("rgb(229, 196, 148"),i.push("rgb(179, 179, 179"),i.push("rgb( 141, 211, 199"),i.push("rgb(255, 255, 179"),i.push("rgb(190, 186, 218"),i.push("rgb(251, 128, 114"),i.push("rgb(128, 177, 211"),i.push("rgb(253, 180, 98"),i.push("rgb(179, 222, 105"),
i.push("rgb(252, 205, 229"),i.push("rgb(217, 217, 217"),i.push("rgb(188, 128, 189"),i.push("rgb(204, 235, 197"),i.push("rgb(255, 237, 111"),t}(igv||{}),igv=function(t){t.GtexSelection=function(t){this.geneColors={},this.gene=null,this.snp=null,this.genesCount=0,t.gene&&(this.gene=t.gene.toUpperCase(),this.geneColors[this.gene]=e[this.genesCount++]),t.snp&&(this.snp=t.snp.toUpperCase())},t.GtexSelection.prototype.addGene=function(t){this.geneColors[t.toUpperCase()]||(this.geneColors[t.toUpperCase()]=e[this.genesCount++])},t.GtexSelection.prototype.colorForGene=function(t){return this.geneColors[t.toUpperCase()]};var e=new Array;return e.push("rgb(228,26,28)"),e.push("rgb(55,126,184)"),e.push("rgb(77,175,74)"),e.push("rgb(166,86,40)"),e.push("rgb(152,78,163)"),e.push("rgb(255,127,0)"),e.push("rgb(247,129,191)"),e.push("rgb(153,153,153)"),e.push("rgb(255,255,51)"),e.push("rgb(102, 194, 165"),e.push("rgb(252, 141, 98"),e.push("rgb(141, 160, 203"),e.push("rgb(231, 138, 195"),e.push("rgb(166, 216, 84"),e.push("rgb(255, 217, 47"),e.push("rgb(229, 196, 148"),e.push("rgb(179, 179, 179"),e.push("rgb( 141, 211, 199"),e.push("rgb(255, 255, 179"),e.push("rgb(190, 186, 218"),e.push("rgb(251, 128, 114"),e.push("rgb(128, 177, 211"),e.push("rgb(253, 180, 98"),e.push("rgb(179, 222, 105"),e.push("rgb(252, 205, 229"),e.push("rgb(217, 217, 217"),e.push("rgb(188, 128, 189"),e.push("rgb(204, 235, 197"),e.push("rgb(255, 237, 111"),t}(igv||{}),igv=function(t){t.GtexFileReader=function(t){this.config=t,this.file=t.url,this.codec=this.file.endsWith(".bin")?i:e,this.cache={},this.binary=this.file.endsWith(".bin"),this.compressed=this.file.endsWith(".compressed.bin")},t.GtexFileReader.prototype.readFeatures=function(e,i,r){var n=this;return new Promise(function(i,r){function a(e,i,a){var o=e[i];if(o){var l=o.blocks,c=l[l.length-1],u=c.startPos+c.size,d=u-l[0].startPos,p={start:l[0].startPos,size:d};igvxhr.loadArrayBuffer(h,{range:p,withCredentials:n.config.withCredentials}).then(function(e){if(e){var i=new DataView(e),r=new t.BinaryParser(i),n=[];for(r.offset;r.hasNext();){var o=f(r);n.push(o)}a(n)}else a(null)}).catch(r)}else a([]);var f=function(t){var e=t.getString(),i=t.getString(),r=t.getInt(),n=t.getString(),a=t.getString(),o=t.getFloat();return new s(e,i,r,n,a,o)}}function o(e,i){var r=t.browser?t.browser.genome:null;igvxhr.loadArrayBuffer(e,{range:{start:0,size:200},withCredentials:n.config.withCredentials}).then(function(a){var o=new DataView(a),s=new t.BinaryParser(o),h=(s.getInt(),s.getInt(),s.getLong()),l=s.getInt();igvxhr.loadArrayBuffer(e,{range:{start:h,size:l},withCredentials:n.config.withCredentials}).then(function(e){for(var n=new DataView(e),a=null,o=new t.BinaryParser(n),a={},s=o.getInt();s-- >0;){var h=o.getString();r&&(h=r.getChromosomeName(h));var l=o.getLong(),c=o.getInt(),u=new Array;u.push(new Block(l,c)),a[h]=new ChrIdx(h,u)}i(a)})})}function s(t,e,i,r,n,a){this.snp=t,this.chr=e,this.position=i,this.start=i,this.end=i+1,this.geneId=r,this.geneName=n,this.pValue=a}var h=n.file,l=n.index;l?a(l,e,i):o(n.file,function(t){n.index=t,a(t,e,i)}),s.prototype.description=function(){return"<b>snp</b>:&nbsp"+this.snp+"<br/><b>location</b>:&nbsp"+this.chr+":"+formatNumber(this.position+1)+"<br/><b>gene</b>:&nbsp"+this.geneName+"<br/><b>pValue</b>:&nbsp"+this.pValue+"<br/><b>mLogP</b>:&nbsp"+this.mLogP},Block=function(t,e){this.startPos=t,this.size=e},ChrIdx=function(t,e){this.chr=t,this.blocks=e}})};var e=function(t){var e=t[0],i=t[1],r=parseInt(t[2])-1,n=t[3],a=t[4],o=t[5],s=parseFloat(t[6]),h=parseFloat(t[7]);return new Eqtl(e,i,r,n,a,o,s,h)},i=function(t){var e=t.getString(),i=t.getString(),r=t.getInt(),n=t.getString(),a=t.getString(),o=t.getFloat();return new Eqtl(e,i,r,n,a,o)};return t}(igv||{}),igv=function(t){return t.GtexReader=function(t){this.config=t,this.url=t.url,this.tissueName=t.tissueName,this.indexed=!0},t.GtexReader.prototype.readFeatures=function(t,e,i){var r=this,n=t.startsWith("chr")?t.substr(3):t,a=e,o=i,s=this.url+"?chromosome="+n+"&start="+a+"&end="+o+"&tissueName="+this.tissueName;return new Promise(function(t,e){igvxhr.loadJson(s,{withCredentials:r.config.withCredentials}).then(function(e){e&&e.singleTissueEqtl?(e.singleTissueEqtl.forEach(function(t){t.chr="chr"+t.chromosome,t.position=t.start,t.start=t.start-1,t.snp=t.snpId,t.geneName=t.geneSymbol,t.geneId=t.gencodeId,t.end=t.start}),t(e.singleTissueEqtl)):t(null)}).catch(e)})},t}(igv||{}),igv=function(t){return t.ImmVarReader=function(t){this.config=t,this.url=t.url,this.cellConditionId=t.cellConditionId,this.valueThreshold=t.valueThreshold?t.valueThreshold:.05},t.ImmVarReader.prototype.readFeatures=function(t,e,i){var r=this,n=this.url+"?chromosome="+t+"&start="+e+"&end="+i+"&cell_condition_id="+this.cellConditionId;return new Promise(function(t,e){igvxhr.loadJson(n,{withCredentials:r.config.withCredentials}).then(function(e){e?(e.eqtls.forEach(function(t){t.chr=t.chromosome,t.start=t.position,t.end=t.position+1}),t(e.eqtls)):t(null)}).catch(function(t){e(t)})})},t}(igv||{}),igv=function(t){const e=1e8;return t.GWASTrack=function(i){this.config=i,this.url=i.url,this.name=i.name,this.trait=i.trait,this.height=i.height||100,this.minLogP=i.minLogP||0,this.maxLogP=i.maxLogP||15,this.background=i.background,this.divider=i.divider||"rgb(225,225,225)",this.dotSize=i.dotSize||4,this.popoverWindow=void 0===i.popoverWindow?e:i.popoverWindow,this.description=i.description,this.proxy=i.proxy,this.portalURL=i.portalURL?i.portalURL:window.location.origin,this.variantURL=i.variantURL||"http://www.type2diabetesgenetics.org/variant/variantInfo/",this.traitURL=i.traitURL||"http://www.type2diabetesgenetics.org/trait/traitInfo/";var r=i.colorScale||{thresholds:[5e-8,5e-4,.5],colors:["rgb(255,50,50)","rgb(251,100,100)","rgb(251,170,170)","rgb(227,238,249)"]};this.pvalue=i.pvalue?i.pvalue:"PVALUE",this.colorScale=new t.BinnedColorScale(r),i.format&&"gtexGWAS"===i.format?this.featureSource=new t.FeatureSource(i):this.featureSource=new t.T2DVariantSource(i)},t.GWASTrack.prototype.getFeatures=function(t,e,i){return this.featureSource.getFeatures(t,e,i)},t.GWASTrack.prototype.draw=function(i){var r=this,n=i.features,a=i.context,o=i.bpPerPixel,s=i.bpStart,h=i.pixelWidth,l=i.pixelHeight,c=s+h*o+1,u=(r.maxLogP-r.minLogP)/l,d=c-s<e;d?this.po=[]:this.po=void 0,this.background&&t.graphics.fillRect(a,0,0,h,l,{fillStyle:this.background}),t.graphics.strokeLine(a,0,l-1,h,l-1,{strokeStyle:this.divider});var p,f,g,v,m,b,y,w,k;if(n){g=n.length;for(var x=0;x<g;x++)if(p=n[x],f=p.start,!(f<s)){if(f>c)break;w=p.pvalue||p[r.pvalue],w&&(y=r.colorScale.getColor(w),k=-Math.log(w)/2.302585092994046,v=o,m=Math.round((f-s)/v),b=Math.max(r.dotSize,l-Math.round((k-r.minLogP)/u)),y&&t.graphics.setProperties(a,{fillStyle:y,strokeStyle:"black"}),t.graphics.fillCircle(a,m,b,r.dotSize),d&&r.po.push({x:m,y:b,feature:p}))}}},t.GWASTrack.prototype.paintAxis=function(e,i,r){var n=this,a=(n.maxLogP-n.minLogP)/r,o={font:"normal 10px Arial",textAlign:"right",strokeStyle:"black"};t.graphics.fillRect(e,0,0,i,r,{fillStyle:"rgb(255, 255, 255)"});for(var s=2;s<n.maxLogP;s+=2){var h=r-Math.round((s-n.minLogP)/a);t.graphics.strokeLine(e,45,h-2,50,h-2,o),t.graphics.fillText(e,s,44,h+2,o)}o.textAlign="center",t.graphics.fillText(e,"-log10(pvalue)",i/2,r/2,o,{rotate:{angle:-90}})},t.GWASTrack.prototype.popupData=function(t,e,i){var r,n,a,o,s,h,l,c,u=[];if(this.po)for(r=0,n=this.po.length;r<n;r++)a=this.po[r],Math.abs(e-a.x)<this.dotSize&&Math.abs(i-a.y)<=this.dotSize&&(h=a.feature.CHROM||a.feature.chr,l=a.feature.POS||a.feature.start,c=a.feature[this.pvalue]||a.feature.pvalue,o=a.feature.DBSNP_ID,o&&(s=this.variantURL.startsWith("http")?this.variantURL:this.portalURL+"/"+this.variantURL,u.push("<a target='_blank' href='"+s+(s.endsWith("/")?"":"/")+o+"' >"+o+"</a>")),u.push(h+":"+l.toString()),u.push({name:"p-value",value:c}),a.feature.ZSCORE&&u.push({name:"z-score",value:a.feature.ZSCORE}),o&&(s=this.traitURL.startsWith("http")?this.traitURL:this.portalURL+"/"+this.traitURL,u.push("<a target='_blank' href='"+s+(s.endsWith("/")?"":"/")+o+"'>see all available statistics for this variant</a>")),r<n-1&&u.push("<p/>"));else u.push("Popover not available at this resolution.");return u},t}(igv||{}),igv=function(t){function e(t,e){return variants=[],t.variants.forEach(function(t){var i={};t.forEach(function(t){for(var e in t)t.hasOwnProperty(e)&&("POS"===e&&(i.start=t[e]-1),i[e]=t[e])}),i.pvalue=i[e.pvalue][e.dataset][e.trait],i[e.pvalue]=void 0,variants.push(i)}),variants}function i(t,e,i,r){var n=r.trait,a=r.pvalue,o=r.dataset,s={cproperty:["VAR_ID","DBSNP_ID","CHROM","POS"],orderBy:["CHROM"],dproperty:{},pproperty:JSON.parse('{"'+a+'": {"'+o+'": ["'+n+'"]}}')},h=[{dataset_id:"x",phenotype:"x",operand:"CHROM",operator:"EQ",value:t,operand_type:"STRING"},{dataset_id:"x",phenotype:"x",operand:"POS",operator:"GTE",value:e,operand_type:"INTEGER"},{dataset_id:"x",phenotype:"x",operand:"POS",operator:"LTE",value:i,operand_type:"INTEGER"},{dataset_id:o,phenotype:n,operand:a,operator:"LT",value:r.valueThreshold,operand_type:"FLOAT"}],l={passback:"x",entity:"variant",properties:s,filters:h};return JSON.stringify(l)}function r(t,e,i,r){var n=r.url.contains("variant")?a:o,s=r.pvalue?r.pvalue:"PVALUE",h=[{operand:"CHROM",operator:"EQ",value:t,filter_type:"STRING"},{operand:"POS",operator:"GT",value:e,filter_type:"FLOAT"},{operand:"POS",operator:"LT",value:i,filter_type:"FLOAT"},{operand:s,operator:"LTE",value:r.valueThreshold,filter_type:"FLOAT"}],l=n===o?["CHROM","POS","DBSNP_ID","PVALUE","ZSCORE"]:["CHROM","POS",s,"DBSNP_ID"],c={user_group:"ui",filters:h,columns:l};return n===o&&(c.trait=r.trait),r.proxy?"url="+r.url+"&data="+JSON.stringify(c):JSON.stringify(c)}function n(t,e){return t.variants.forEach(function(t){t.chr=t.CHROM,t.start=t.POS-1}),t.variants}const a="VARIANT",o="TRAIT";t.T2DVariantSource=function(t){this.config=t,this.url=t.url,this.trait=t.trait,this.dataset=t.dataset,this.pvalue=t.pvalue,void 0===t.valueThreshold&&(t.valueThreshold=.05),void 0===t.dataset?(this.queryJson=t.queryJson||r,this.jsonToVariants=t.jsonToVariants||n):(this.queryJson=t.queryJson||i,this.jsonToVariants=t.jsonToVariants||e)},t.T2DVariantSource.prototype.getFeatures=function(e,i,r){var n=this;return new Promise(function(a,o){if(n.cache&&n.cache.chr===e&&n.cache.end>r&&n.cache.start<i)a(n.cache.featuresBetween(i,r));else{var h=Math.max(r-i,1e7)/2,l=(r+i)/2,c=e.startsWith("chr")?e.substring(3):e,u=Math.max(0,l-h),d=l+h,p=n.config.proxy?n.config.proxy:n.url,f=n.queryJson(c,u,d,n.config);igvxhr.loadJson(p,{sendData:f,withCredentials:n.config.withCredentials}).then(function(i){var r;i?i.error_code?(t.presentAlert("Error querying trait "+n.trait+"  (error_code="+i.error_code+")"),a(null)):(r=n.jsonToVariants(i,n.config),r.sort(function(t,e){return t.POS-e.POS}),n.cache=new s(e,u,d,r),a(r)):a(null)}).catch(o)}})};var s=function(t,e,i,r){var n,a,o;for(this.chr=t,this.start=e,this.end=i,this.binSize=(i-e)/100,this.binIndeces=[0],this.features=r,o=0,n=0;n<r.length;n++)a=Math.max(0,Math.floor((r[n].POS-this.start)/this.binSize)),a>o&&(this.binIndeces.push(n),o=a)};return s.prototype.featuresBetween=function(t,e){var i=Math.max(0,Math.min(Math.floor((t-this.start)/this.binSize)-1,this.binIndeces.length-1)),r=Math.max(0,Math.min(Math.floor((e-this.start)/this.binSize),this.binIndeces.length-1));this.binIndeces[i],this.binIndeces[r];return this.features},t}(igv||{}),igv=function(t){return t.IdeoPanel=function(e){this.ideograms={},this.contentDiv=$('<div class="igv-ideogram-content-div"></div>'),$(e).append(this.contentDiv[0]);var i=this;this.contentDiv.click(function(e){var r,n,a,o,s,h,l;r=t.translateMouseCoordinates(e,i.contentDiv),n=r.x/i.contentDiv.width(),s=t.browser.trackViewportWidthBP(),a=t.browser.genome.getChromosome(t.browser.referenceFrame.chr),o=a.bpLength,h=s/o,n-h/2<0&&(n=h/2),n+h/2>1&&(n=1-h/2),l=t.browser.referenceFrame.chr+":"+t.numberFormatter(1+Math.floor((n-h/2)*o))+"-"+t.numberFormatter(Math.floor((n+h/2)*o)),t.browser.search(l,void 0)}),this.canvas=$('<canvas class="igv-ideogram-canvas"></canvas>')[0],$(this.contentDiv).append(this.canvas),this.canvas.setAttribute("width",this.contentDiv.width()),this.canvas.setAttribute("height",this.contentDiv.height()),this.ctx=this.canvas.getContext("2d")},t.IdeoPanel.prototype.resize=function(){this.canvas.setAttribute("width",this.contentDiv.width()),this.canvas.setAttribute("height",this.contentDiv.height()),this.ideograms={},this.repaint()},t.IdeoPanel.prototype.repaint=function(){function e(t,e,r){var n=0;if(p){var a=p.getCytobands(f.chr);if(a){var o=n+r/2,s=[],h=[],l=a.length;if(0==l)return;for(var c=a[l-1].end,u=e/c,d=-1,g=0;g<a.length;g++){var v=a[g],m=u*v.start,b=u*v.end;b>d&&("c"==v.type?("p"==v.name.charAt(0)?(s[0]=m,h[0]=r+n,s[1]=m,h[1]=n,s[2]=b,h[2]=o):(s[0]=b,h[0]=r+n,s[1]=b,h[1]=n,s[2]=m,h[2]=o),t.fillStyle="rgb(150, 0, 0)",t.strokeStyle="rgb(150, 0, 0)",t.polygon(s,h,1,0)):(t.fillStyle=i(v),t.fillRect(m,n,b-m,r)))}}t.strokeStyle="black",t.roundRect(0,n,e,r,r/2,0,1),d=b}}function i(t){if("c"==t.type)return"rgb(150, 10, 10)";var e=t.stain,i=230;"p"==t.type&&(i=Math.floor(230-e/100*230));var r=g[i];return null==r&&(r="rgb("+i+","+i+","+i+")",g[i]=r),r}try{var r,n,a,o,s,h,l,c,u,d,p=t.browser.genome,f=t.browser.referenceFrame,g=[];if(this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),!(p&&f&&p.getChromosome(f.chr)))return;n=this.ideograms[t.browser.referenceFrame.chr],n||(n=document.createElement("canvas"),n.width=this.canvas.width,n.height=13,a=n.getContext("2d"),e(a,this.canvas.width,n.height),this.ideograms[t.browser.referenceFrame.chr]=n),r=(this.canvas.height-n.height)/2,this.ctx.drawImage(n,0,r),this.ctx.save(),o=t.browser.genome.getChromosome(t.browser.referenceFrame.chr),c=Math.floor(t.browser.trackViewportWidthBP()),d=t.browser.referenceFrame.start,c<o.bpLength&&(s=c/o.bpLength,h=d/o.bpLength,u=Math.floor(h*this.canvas.width),l=Math.floor(s*this.canvas.width),u=Math.max(0,u),u=Math.min(this.canvas.width-l,u),this.ctx.strokeStyle="red",this.ctx.lineWidth=2,this.ctx.strokeRect(u,r,l,n.height+this.ctx.lineWidth-1),this.ctx.restore())}catch(t){console.log("Error painting ideogram: "+t.message)}},t}(igv||{}),igv=function(t){function e(t,e,i){var r,n=e.length;for(r=0;r<n;r++)e[r]=Math.round(e[r]),i[r]=Math.round(i[r]);for(t.beginPath(),t.moveTo(e[0],i[0]),r=1;r<n;r++)t.lineTo(e[r],i[r]);t.closePath()}var i=!1,r=function(t){if(i){var e=new Date,r=e.getHours()+":"+e.getMinutes()+":"+e.getSeconds();"undefined"!=typeof copy&&copy(t),"undefined"!=typeof console&&console.log("igv-canvas: "+r+" "+t)}};return t.graphics={setProperties:function(t,e){for(var i in e)if(e.hasOwnProperty(i)){var r=e[i];t[i]=r}},strokeLine:function(e,i,n,a,o,s){i=Math.floor(i)+.5,n=Math.floor(n)+.5,a=Math.floor(a)+.5,o=Math.floor(o)+.5,r("stroke line, prop: "+s),e.save(),s&&t.graphics.setProperties(e,s),e.beginPath(),e.moveTo(i,n),e.lineTo(a,o),e.stroke(),e.restore()},fillRect:function(e,i,r,n,a,o){i=Math.round(i),r=Math.round(r),o&&(e.save(),t.graphics.setProperties(e,o)),e.fillRect(i,r,n,a),o&&e.restore()},fillPolygon:function(i,r,n,a){i.save(),a&&t.graphics.setProperties(i,a),e(i,r,n),i.fill(),i.restore()},strokePolygon:function(i,r,n,a){i.save(),a&&t.graphics.setProperties(i,a),e(i,r,n),i.stroke(),i.restore()},fillText:function(e,i,r,n,a,o){if(a&&(e.save(),t.graphics.setProperties(e,a)),e.save(),e.translate(r,n),o)for(var s in o){var h=o[s];"translate"==s&&e.translate(h.x,h.y),"rotate"==s&&e.rotate(h.angle*Math.PI/180)}e.fillText(i,0,0),e.restore(),a&&e.restore()},strokeText:function(e,i,r,n,a,o){if(e.save(),a&&t.graphics.setProperties(e,a),e.translate(r,n),o)for(var s in o){var h=o[s];"translate"==s&&e.translate(h.x,h.y),"rotate"==s&&e.rotate(h.angle*Math.PI/180)}e.strokeText(i,0,0),e.restore()},strokeCircle:function(t,e,i,r){t.beginPath(),t.arc(e,i,r,0,2*Math.PI),t.stroke()},fillCircle:function(t,e,i,r){t.beginPath(),t.arc(e,i,r,0,2*Math.PI),t.fill()},drawArrowhead:function(t,e,i,r,n){t.save(),r||(r=5),n&&(t.lineWidth=n),t.beginPath(),t.moveTo(e,i-r/2),t.lineTo(e,i+r/2),t.lineTo(e+r,i),t.lineTo(e,i-r/2),t.closePath(),t.fill(),t.restore()},dashedLine:function(e,i,n,a,o,s,h){e.save(),i=Math.round(i),n=Math.round(n),a=Math.round(a),o=Math.round(o),s=Math.round(s),r("dashedLine"),h&&t.graphics.setProperties(e,h),void 0==s&&(s=2),e.moveTo(i,n);for(var l=a-i,c=o-n,u=Math.floor(Math.sqrt(l*l+c*c)/s),d=l/u,p=c/u,f=0;f++<u;)i+=d,n+=p,e[f%2==0?"moveTo":"lineTo"](i,n);e[f%2==0?"moveTo":"lineTo"](a,o),e.restore()}},t}(igv||{}),igv=function(t){function e(t,e,i){return Math.min(Math.max(t,e),i)}t.hex2Color=function(t){var e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);if(null!==e)return"rgb("+parseInt(e[1],16)+","+parseInt(e[2],16)+","+parseInt(e[3],16)+")"},t.rgbaColor=function(t,i,r,n){return t=e(t,0,255),i=e(i,0,255),r=e(r,0,255),n=e(n,0,1),"rgba("+t+","+i+","+r+","+n+")"},t.rgbColor=function(t,i,r){return t=e(t,0,255),i=e(i,0,255),r=e(r,0,255),"rgb("+t+","+i+","+r+")"},t.addAlphaToRGB=function(t,e){return t.startsWith("rgb")?t.replace("rgb","rgba").replace(")",", "+e+")"):(console.log(t+" is not an rgb style string"),t)},t.greyScale=function(t){var i=e(t,0,255);return"rgb("+i+","+i+","+i+")"},t.randomGrey=function(i,r){i=e(i,0,255),r=e(r,0,255);var n=Math.round(t.random(i,r)).toString(10);return"rgb("+n+","+n+","+n+")"},t.randomRGB=function(i,r){i=e(i,0,255),r=e(r,0,255);var n=Math.round(t.random(i,r)).toString(10),a=Math.round(t.random(i,r)).toString(10),o=Math.round(t.random(i,r)).toString(10);return"rgb("+n+","+a+","+o+")"},t.nucleotideColorComponents={A:[0,200,0],C:[0,0,200],T:[255,0,0],G:[209,113,5],a:[0,200,0],c:[0,0,200],t:[255,0,0],g:[209,113,5]},t.nucleotideColors={A:"rgb(  0, 200,   0)",C:"rgb(  0,   0, 200)",T:"rgb(255,   0,   0)",G:"rgb(209, 113,   5)",a:"rgb(  0, 200,   0)",c:"rgb(  0,   0, 200)",t:"rgb(255,   0,   0)",g:"rgb(209, 113,   5)"},t.getCompositeColor=function(t,e,i){var r=Math.floor(i*e[0]+(1-i)*t[0]),n=Math.floor(i*e[1]+(1-i)*t[1]),a=Math.floor(i*e[2]+(1-i)*t[2]);return"rgb("+r+","+n+","+a+")"},t.createColorString=function(t){return t.includes(",")?t.startsWith("rgb")?t:"rgb("+t+")":t},t.BinnedColorScale=function(t){this.thresholds=t.thresholds,this.colors=t.colors},t.BinnedColorScale.prototype.getColor=function(t){var e,i=this.thresholds.length;for(e=0;e<i;e++)if(t<this.thresholds[e])return this.colors[e];return this.colors[this.colors.length-1]},t.GradientColorScale=function(t){this.scale=t,this.lowColor="rgb("+t.lowR+","+t.lowG+","+t.lowB+")",this.highColor="rgb("+t.highR+","+t.highG+","+t.highB+")",this.diff=t.high-t.low},t.GradientColorScale.prototype.getColor=function(t){var e,i,r,n,a=this.scale;return t<=a.low?this.lowColor:t>=a.high?this.highColor:(n=(t-a.low)/this.diff,e=Math.floor(a.lowR+n*(a.highR-a.lowR)),i=Math.floor(a.lowG+n*(a.highG-a.lowG)),r=Math.floor(a.lowB+n*(a.highB-a.lowB)),"rgb("+e+","+i+","+r+")")};var i={Set1:["rgb(228,26,28)","rgb(55,126,184)","rgb(77,175,74)","rgb(166,86,40)","rgb(152,78,163)","rgb(255,127,0)","rgb(247,129,191)","rgb(153,153,153)","rgb(255,255,51)"],Dark2:["rgb(27,158,119)","rgb(217,95,2)","rgb(117,112,179)","rgb(231,41,138)","rgb(102,166,30)","rgb(230,171,2)","rgb(166,118,29)","rgb(102,102,102)"],Set2:["rgb(102, 194,165)","rgb(252,141,98)","rgb(141,160,203)","rgb(231,138,195)","rgb(166,216,84)","rgb(255,217,47)","rgb(229,196,148)","rgb(179,179,179)"],Set3:["rgb(141,211,199)","rgb(255,255,179)","rgb(190,186,218)","rgb(251,128,114)","rgb(128,177,211)","rgb(253,180,98)","rgb(179,222,105)","rgb(252,205,229)","rgb(217,217,217)","rgb(188,128,189)","rgb(204,235,197)","rgb(255,237,111)"],Pastel1:["rgb(251,180,174)","rgb(179,205,227)","rgb(204,235,197)","rgb(222,203,228)","rgb(254,217,166)","rgb(255,255,204)","rgb(229,216,189)","rgb(253,218,236)"],Pastel2:["rgb(173,226,207)","rgb(253,205,172)","rgb(203,213,232)","rgb(244,202,228)","rgb(230,245,201)","rgb(255,242,174)","rgb(243,225,206)"],Accent:["rgb(127,201,127)","rgb(190,174,212)","rgb(253,192,134)","rgb(255,255,153)","rgb(56,108,176)","rgb(240,2,127)","rgb(191,91,23)"]};return t.PaletteColorTable=function(t){this.colors=i[t],Array.isArray(this.colors)||(this.colors=[]),this.colorTable={},this.nextIdx=0,this.colorGenerator=new RColor},t.PaletteColorTable.prototype.getColor=function(t){return this.colorTable.hasOwnProperty(t)||(this.nextIdx<this.colors.length?this.colorTable[t]=this.colors[this.nextIdx]:this.colorTable[t]=this.colorGenerator.get(),this.nextIdx++),this.colorTable[t]},RColor=function(){this.hue=Math.random(),this.goldenRatio=.618033988749895,this.hexwidth=2},RColor.prototype.hsvToRgb=function(t,e,i){var r=Math.floor(6*t),n=6*t-r,a=i*(1-e),o=i*(1-n*e),s=i*(1-(1-n)*e),h=255,l=255,c=255;switch(r){case 0:h=i,l=s,c=a;break;case 1:h=o,l=i,c=a;break;case 2:h=a,l=i,c=s;break;case 3:h=a,l=o,c=i;break;case 4:h=s,l=a,c=i;break;case 5:h=i,l=a,c=o}return[Math.floor(256*h),Math.floor(256*l),Math.floor(256*c)]},RColor.prototype.padHex=function(t){return t.length>this.hexwidth?t:new Array(this.hexwidth-t.length+1).join("0")+t},RColor.prototype.get=function(t,e){this.hue+=this.goldenRatio,this.hue%=1,"number"!=typeof t&&(t=.5),"number"!=typeof e&&(e=.95);var i=this.hsvToRgb(this.hue,t,e);return"#"+this.padHex(i[0].toString(16))+this.padHex(i[1].toString(16))+this.padHex(i[2].toString(16))},t}(igv||{}),igv=function(t){function e(e,i){var r,n,a,o,s,h,l,c,u,d,p,f,g;return n=$('<div id="igvControlDiv">'),i.showNavigation&&(o=$('<div class="igvNavigation">'),n.append(o[0]),r=$('<div class="igv-logo">'),s=$('<div class="igvNavigationSearch">'),e.$searchInput=$('<input class="igvNavigationSearchInput" type="text" placeholder="Locus Search">'),e.$searchInput.change(function(){e.search($(this).val())}),h=$('<i class="igv-app-icon fa fa-search fa-18px shim-left-6">'),h.click(function(){e.search(e.$searchInput.val())}),s.append(e.$searchInput[0]),s.append(h[0]),o.append(r[0]),o.append(s[0]),e.$searchResults=$('<div class="igvNavigationSearchResults">'),e.$searchResultsTable=$('<table class="igvNavigationSearchResultsTable">'),e.$searchResults.append(e.$searchResultsTable[0]),s.append(e.$searchResults[0]),e.$searchResults.hide(),e.windowSizePanel=new t.WindowSizePanel(o),p=$('<i class="fa fa-minus-circle igv-app-icon fa-24px" style="padding-right: 4px;">'),p.click(function(){t.browser.zoomOut()}),d=$('<i class="fa fa-plus-circle igv-app-icon fa-24px">'),d.click(function(){t.browser.zoomIn()}),u=$('<div class="igvNavigationZoom">'),u.append(p[0]),u.append(d[0]),o.append(u[0]),l=$('<div class="igv-toggle-track-labels">'),l.text("hide labels"),l.click(function(){e.trackLabelsVisible=!e.trackLabelsVisible,$(this).text(!0===e.trackLabelsVisible?"hide labels":"show labels"),$(e.trackContainerDiv).find(".igv-track-label").toggle()}),e.centerGuide=new t.CenterGuide($(e.trackContainerDiv),i),e.$cursorTrackingGuide=$('<div class="igv-cursor-tracking-guide">'),$(e.trackContainerDiv).append(e.$cursorTrackingGuide),e.$cursorTrackingGuide.css("display",i.showCursorTrackingGuide&&1==i.showCursorTrackingGuide?"block":"none"),c=$('<div class="igv-toggle-track-labels">'),g=e.$cursorTrackingGuide.css("display"),c.text("none"===g?"show cursor guide":"hide cursor guide"),c.click(function(){g=e.$cursorTrackingGuide.css("display"),"none"===g?(e.$cursorTrackingGuide.css("display","block"),c.text("hide cursor guide")):(e.$cursorTrackingGuide.css("display","none"),c.text("show cursor guide"))}),void 0!==i.showCursorTrackingGuide&&0!=i.showCursorTrackingGuide||c.css("display","none"),o.append(c),o.append(e.centerGuide.$centerGuideToggle),o.append(l)),i.showKaryo&&(a=$("#igvKaryoDiv")[0],a||(a=$('<div id="igvKaryoDiv" class="igv-karyo-div">')[0],n.append(a)),e.karyoPanel=new t.KaryoPanel(a),f=$('<div class="igv-toggle-track-labels">'),"hide"===i.showKaryo?(f.text("Show Karyotype"),$(a).addClass("igv-karyo-hide")):f.text("Hide Karyotype"),f.click(function(){var t=$(".igv-karyo-div").hasClass("igv-karyo-hide");t?(f.text("Hide Karyotype"),$(".igv-karyo-div").removeClass("igv-karyo-hide")):(f.text("Show Karyotype"),$(".igv-karyo-div").addClass("igv-karyo-hide"))}),o.append(f[0])),n[0]}function i(t){var e={id:t};switch(t){case"hg18":e.fastaURL="https://s3.amazonaws.com/igv.broadinstitute.org/genomes/seq/hg18/hg18.fasta",e.cytobandURL="https://s3.amazonaws.com/igv.broadinstitute.org/genomes/seq/hg18/cytoBand.txt.gz";break;case"hg19":case"GRCh37":default:e.fastaURL="https://s3.amazonaws.com/igv.broadinstitute.org/genomes/seq/hg19/hg19.fasta",e.cytobandURL="https://s3.amazonaws.com/igv.broadinstitute.org/genomes/seq/hg19/cytoBand.txt"}return e}function r(t){t.showKaryo=t.showKaryo||!1,void 0===t.showControls&&(t.showControls=!0),void 0===t.showNavigation&&(t.showNavigation=!0),void 0===t.showRuler&&(t.showRuler=!0),void 0===t.showSequence&&(t.showSequence=!0),void 0===t.showIdeogram&&(t.showIdoegram=!0),void 0===t.flanking&&(t.flanking=1e3),void 0===t.pairsSupported&&(t.pairsSupported=!0),void 0===t.type&&(t.type="IGV"),t.tracks||(t.tracks=[]),t.showSequence&&t.tracks.push({type:"sequence",order:-9999})}function n(){var t="https://data.broadinstitute.org/igv/projects/current/counter_igvjs.php?version="+a;igvxhr.load(t).then(function(t){console.log(t)}).catch(function(t){console.log(t)})}var a="beta";return t.version=a,t.createBrowser=function(a,o){var s,h,l,c,u,d,p,f=1;if(t.browser&&t.removeBrowser(),o||(o={}),r(o),oauth.google.apiKey=o.apiKey,oauth.google.access_token=o.oauthToken,o.genome?o.reference=i(o.genome):o.fastaURL?o.reference={fastaURL:o.fastaURL,cytobandURL:o.cytobandURL}:o.reference&&void 0!==o.reference.id&&void 0===o.reference.fastaURL&&(o.reference=i(o.reference.id)),!o.reference||!o.reference.fastaURL)throw t.presentAlert("Fatal error:  reference must be defined"),new Error("Fatal error:  reference must be defined");return o.tracks&&o.tracks.forEach(function(t){void 0===t.order&&(t.order=f++)}),c=$('<div class="igv-track-container-div">')[0],u=new t.Browser(o,c),d=u.div,$(document).mousedown(function(t){u.isMouseDown=!0}),$(document).mouseup(function(t){u.isMouseDown=void 0,u.dragTrackView&&$(u.dragTrackView.igvTrackDragScrim).hide(),u.dragTrackView=void 0}),$(document).click(function(e){var i=e.target;t.browser.div.contains(i)||t.popover.hide()}),$(a).append($(d)),o.showCommandBar!==!1&&o.showControls!==!1&&(p=o.createControls?o.createControls(u,o):e(u,o),$(d).append($(p))),h=$('<div class="igv-content-div">')[0],$(d).append(h),l=$("<div>")[0],$(h).append(l),$(h).append(c),u.userFeedback=new t.UserFeedback($(h)),u.userFeedback.hide(),t.popover=new t.Popover($(h),"igv-popover"),t.colorPicker=new t.ColorPicker($(d),o.palette,"igv-color-picker"),t.colorPicker.hide(),t.alert=new t.AlertDialog($(d),"igv-alert"),t.alert.hide(),t.dialog=new t.Dialog($(d),t.Dialog.dialogConstructor,"igv-dialog"),t.dialog.hide(),t.dataRangeDialog=new t.DataRangeDialog($(d),"igv-data-range-dialog"),t.dataRangeDialog.hide(),o.showNavigation||(s=$('<div class="igv-logo-nonav">'),$(l).append(s[0])),o.hideIdeogram&&!0===o.hideIdeogram||(u.ideoPanel=new t.IdeoPanel(l),u.ideoPanel.resize()),n(),t.loadGenome(o.reference).then(function(e){e.id=o.reference.genomeId,u.genome=e,o.showRuler&&u.addTrack(new t.RulerTrack);var i=u.trackViewportWidth();0===i&&(i=500);var r=u.genome.chromosomeNames[0],n=u.genome.chromosomes[r];if(u.referenceFrame=new t.ReferenceFrame(r,0,n.bpLength/i),u.controlPanelWidth=50,u.updateLocusSearch(u.referenceFrame),u.ideoPanel&&u.ideoPanel.repaint(),u.karyoPanel&&u.karyoPanel.resize(),u.initialLocus||o.locus){var s=u.initialLocus?u.initialLocus:o.locus;t.startSpinnerAtParentElement(a),u.search(s,function(){t.stopSpinnerAtParentElement(a);var e=u.referenceFrame,i=e.start;i+u.trackViewportWidth()*e.bpPerPixel;o.tracks&&u.loadTracksWithConfigList(o.tracks)},!0)}else o.tracks&&u.loadTracksWithConfigList(o.tracks)}).catch(function(e){t.presentAlert(e),console.log(e)}),u},t.removeBrowser=function(){$(t.browser.div).remove(),$(".igv-grid-container-colorpicker").remove(),$(".igv-grid-container-dialog").remove(),$(".igv-grid-container-dialog").remove()},t}(igv||{});CanvasRenderingContext2D.prototype.strokeLine=function(t,e,i,r,n){this.save(),this.beginPath(),n&&(this.lineWidth=n),this.moveTo(t,e),this.lineTo(i,r),this.stroke(),this.restore()},CanvasRenderingContext2D.prototype.drawArrowhead=function(t,e,i,r){this.save(),i||(i=5),r&&(this.lineWidth=r),this.beginPath(),this.moveTo(t,e-i/2),this.lineTo(t,e+i/2),this.lineTo(t+i,e),this.lineTo(t,e-i/2),this.closePath(),this.fill(),this.restore()},CanvasRenderingContext2D.prototype.roundRect=function(t,e,i,r,n,a,o){this.save(),"undefined"==typeof o&&(o=!0),"undefined"==typeof n&&(n=5),this.beginPath(),this.moveTo(t+n,e),this.lineTo(t+i-n,e),this.quadraticCurveTo(t+i,e,t+i,e+n),this.lineTo(t+i,e+r-n),this.quadraticCurveTo(t+i,e+r,t+i-n,e+r),this.lineTo(t+n,e+r),this.quadraticCurveTo(t,e+r,t,e+r-n),this.lineTo(t,e+n),this.quadraticCurveTo(t,e,t+n,e),this.closePath(),o&&this.stroke(),a&&this.fill(),this.restore()},CanvasRenderingContext2D.prototype.polygon=function(t,e,i,r){this.save(),"undefined"==typeof r&&(r=!0),this.beginPath();var n=t.length;this.moveTo(t[0],e[0]);for(var a=1;a<n;a++)this.lineTo(t[a],e[a]);this.closePath(),r&&this.stroke(),i&&this.fill(),this.restore()},CanvasRenderingContext2D.prototype.eqTriangle=function(t,e,i){this.save();var r=t*(Math.sqrt(3)/2);this.beginPath(),this.moveTo(e,i-r/2),this.lineTo(e-t/2,i+r/2),this.lineTo(e+t/2,i+r/2),this.lineTo(e,i-r/2),this.closePath(),this.stroke(),this.fill(),this.restore()},"undefined"==typeof String.prototype.startsWith&&(String.prototype.startsWith=function(t){return!(this.length<t.length)&&this.substr(0,t.length)==t}),"undefined"==typeof String.prototype.endsWith&&(String.prototype.endsWith=function(t){return!(this.length<t.length)&&this.substr(this.length-t.length,t.length)==t}),"undefined"==typeof String.prototype.contains&&(String.prototype.contains=function(t){return this.indexOf(t)!=-1}),"undefined"==typeof String.prototype.includes&&(String.prototype.includes=function(t){return this.indexOf(t)!=-1}),"undefined"==typeof String.prototype.splitLines&&(String.prototype.splitLines=function(){return this.split(/\r\n|\n|\r/gm)}),"undefined"==typeof Uint8Array.prototype.toText&&(Uint8Array.prototype.toText=function(){var t,e,i;for(i="",t=0,e=this.byteLength;t<e;t++)i+=String.fromCharCode(this[t]);return i});var log2=Math.log(2);"undefined"==typeof Math.log2&&(Math.log2=function(t){return Math.log(t)/log2}),"undefined"==typeof Function.prototype.bind&&(Function.prototype.bind=function(){var t=this,e=Array.prototype.slice.call(arguments),i=e.shift();return function(){return t.apply(i,e.concat(Array.prototype.slice.call(arguments)))}}),Date.now||(Date.now=function(){return(new Date).getTime()}),Object.keys||(Object.keys=function(){"use strict";var t=Object.prototype.hasOwnProperty,e=!{toString:null}.propertyIsEnumerable("toString"),i=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],r=i.length;return function(n){if("object"!=typeof n&&("function"!=typeof n||null===n))throw new TypeError("Object.keys called on non-object");var a,o,s=[];for(a in n)t.call(n,a)&&s.push(a);if(e)for(o=0;o<r;o++)t.call(n,i[o])&&s.push(i[o]);return s}}()),Array.isArray||(Array.isArray=function(t){return"[object Array]"===Object.prototype.toString.call(t)});var igv=function(t){return t.presentAlert=function(e){t.alert.$dialogLabel.text(e),t.alert.show(void 0),t.popover.hide()},t.trackMenuItems=function(e,i){var r,n=[];return n.push(t.dialogMenuItem(e,i,"Set track name",function(){return"Track Name"},i.track.name,function(){function e(t){var e=/(?=.*[a-zA-Z].*)([a-zA-Z0-9 ]+)/,i=e.exec(t);return null!==i?i[0]:"untitled"}var r=e(t.dialog.$dialogInput.val());void 0!==r&&(t.setTrackLabel(i.track,r),i.update())},void 0)),n.push(t.dialogMenuItem(e,i,"Set track height",function(){return"Track Height"},i.trackDiv.clientHeight,function(){var e=parseFloat(t.dialog.$dialogInput.val(),10);void 0!==e&&(void 0!==i.track.minHeight&&i.track.minHeight>e&&(i.track.minHeight=e),
void 0!==i.track.maxHeight&&i.track.maxHeight<e&&(i.track.minHeight=e),i.setTrackHeight(e),i.track.autoHeight=!1)},void 0)),i.track.popupMenuItems&&(r=i.track.popupMenuItems(e),r&&r.length>0&&r.forEach(function(t,e){var i;t.name?(i=0===e?'<div class="igv-track-menu-item igv-track-menu-border-top">':'<div class="igv-track-menu-item">',i=i+t.name+"</div>",n.push({object:$(i),click:t.click,init:t.init})):0===e?(t.object.addClass("igv-track-menu-border-top"),n.push(t)):n.push(t)})),i.track.removable!==!1&&n.push(t.dialogMenuItem(e,i,"Remove track",function(){var t="Remove "+i.track.name;return'<div class="igv-dialog-label-centered">'+t+"</div>"},void 0,function(){e.hide(),i.browser.removeTrack(i.track)},!0)),n},t.dialogMenuItem=function(e,i,r,n,a,o,s){var h=!0===s?'<div class="igv-track-menu-item igv-track-menu-border-top">':'<div class="igv-track-menu-item">';return{object:$(h+r+"</div>"),click:function(){t.dialog.configure(n,a,o),t.dialog.show($(i.trackDiv)),e.hide()}}},t.dataRangeMenuItem=function(e,i){return{object:$('<div class="igv-track-menu-item">Set data range</div>'),click:function(){t.dataRangeDialog.configureWithTrackView(i),t.dataRangeDialog.show(),e.hide()}}},t.colorPickerMenuItem=function(e,i){return{object:$('<div class="igv-track-menu-item">Set track color</div>'),click:function(){t.colorPicker.configure(i),t.colorPicker.show(),e.hide()}}},t.attachDialogCloseHandlerWithParent=function(t,e){var i=$('<div class="igv-dialog-close-container">'),r=$('<i class="fa fa-times igv-dialog-close-fa">');i.append(r[0]),t.append(i[0]),r.hover(function(){r.removeClass("fa-times"),r.addClass("fa-times-circle"),r.css({color:"#222"})},function(){r.removeClass("fa-times-circle"),r.addClass("fa-times"),r.css({color:"#444"})}),r.click(e)},t.spinner=function(t){var e,i;return i=$('<i class="fa fa-spinner fa-spin">'),t&&i.css("font-size",t),e=$('<div class="igv-spinner-container">'),e.append(i[0]),e[0]},t.getSpinnerObjectWithParentElement=function(t){return $(t).find("div.igv-spinner-container")},t.startSpinnerAtParentElement=function(e){var i=t.getSpinnerObjectWithParentElement(e);i&&i.show()},t.stopSpinnerAtParentElement=function(e){var i=t.getSpinnerObjectWithParentElement(e);i&&i.hide()},t.parseUri=function(e){for(var i=t.parseUri.options,r=i.parser[i.strictMode?"strict":"loose"].exec(e),n={},a=14;a--;)n[i.key[a]]=r[a]||"";return n[i.q.name]={},n[i.key[12]].replace(i.q.parser,function(t,e,r){e&&(n[i.q.name][e]=r)}),n},t.parseUri.options={strictMode:!1,key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}},t.domElementRectAsString=function(t){return" x "+t.clientLeft+" y "+t.clientTop+" w "+t.clientWidth+" h "+t.clientHeight},t.isNumber=function(t){return""!==t&&(void 0!==t&&(!isNaN(parseFloat(t))&&isFinite(t)))},t.guid=function(){return("0000"+(Math.random()*Math.pow(36,4)<<0).toString(36)).slice(-4)},t.random=function(t,e){return Math.random()*(e-t)+t},t.numberFormatter=function(t){var e=String(t).split(/[.,]/),i=",",r=".";return e[0].split("").reverse().reduce(function(t,e,r){return r%3===0?t+i+e:t+e}).split("").reverse().join("")+(e[1]?r+e[1]:"")},t.numberUnFormatter=function(t){return t.split(",").join().replace(",","","g")},t.translateMouseCoordinates=function(t,e){var i=$.event.fix(t),r=i.pageX-$(e).offset().left,n=i.pageY-$(e).offset().top;return{x:r,y:n}},t.formatPopoverText=function(t){var e='<table class="igv-popover-table">';return t.forEach(function(t){e+=t.name?'<tr><td class="igv-popover-td"><div class="igv-popoverNameValue"><span class="igv-popoverName">'+t.name+'</span><span class="igv-popoverValue">'+t.value+"</span></div></td></tr>":"<tr><td>"+t.toString()+"</td></tr>"}),e+="</table>"},t.throttle=function(t,e,i){e||(e=200);var r,n;return function(){var a=i||this,o=+new Date,s=arguments;r&&o<r+e?(clearTimeout(n),n=setTimeout(function(){r=o,t.apply(a,s)},e)):(r=o,t.apply(a,s))}},t.splitStringRespectingQuotes=function(t,e){var i,r,n=[],a=t.length,o=0,s=!1;if(a>0)for(n[o]=t.charAt(0),i=1;i<a;i++)r=t.charAt(i),'"'===r?s=!s:s||r!==e?n[o]+=r:(o++,n[o]="");return n},t.addAjaxExtensions=function(){$.ajaxTransport("+binary",function(t,e,i){return{send:function(e,i){var r=new XMLHttpRequest,n=t.url,a=t.type,o="arraybuffer";t.data||null;if(r.addEventListener("load",function(){var e={};e[t.dataType]=r.response,i(r.status,r.statusText,e,r.getAllResponseHeaders())}),r.open(a,n),r.responseType=o,t.headers)for(var s in t.headers)t.headers.hasOwnProperty(s)&&r.setRequestHeader(s,t.headers[s])},abort:function(){i.abort()}}})},t.isStringOrNumber=function(t){return!(!t.substring&&!t.toFixed)},t.constrainBBox=function(t,e){var i,r,n={},a={};return a.left=a.top=0,a.right=e.outerWidth(),a.bottom=e.outerHeight(),r=t.offset(),n.left=r.left-e.offset().left,n.top=r.top-e.offset().top,n.right=n.left+t.outerWidth(),n.bottom=n.top+t.outerHeight(),i=n.bottom-a.bottom,i>0&&(r.top-=i,n.top-=i,n.bottom-=i,i=n.top-a.top,i<0&&(r.top-=i)),r},t.log=function(e){t.enableLogging&&console&&console.log&&console.log(e)},t}(igv||{}),igvxhr=function(t){function e(t){var e=window.location.origin;return!t.startsWith(e)}const i=0,r=1,n=2;return t.load=function(i,r){return r||(r={}),new Promise(function(n,a){function o(t){if(!a)throw Error(t);a(t)}var s,h,l,c,u=new XMLHttpRequest,d=r.sendData,p=r.method||(d?"POST":"GET"),f=r.range,g=r.responseType,v=r.contentType,m=r.mimeType,b=r.headers,y=(0==navigator.vendor.indexOf("Apple")&&/\sSafari\//.test(navigator.userAgent),r.withCredentials);if(i=i.startsWith("gs://")?igv.Google.translateGoogleCloudURL(i):i,igv.Google.isGoogleURL(i)&&(i=igv.Google.addApiKey(i),b=b||{},igv.Google.addGoogleHeaders(b),f&&(i+=i.includes("?")?"&":"?",i+="someRandomSeed="+Math.random().toString(36))),u.open(p,i),f){var w=f.size?f.start+f.size-1:"";u.setRequestHeader("Range","bytes="+f.start+"-"+w)}if(v&&u.setRequestHeader("Content-Type",v),m&&u.overrideMimeType(m),g&&(u.responseType=g),b)for(s=Object.keys(b),c=0;c<s.length;c++)h=s[c],l=b[h],u.setRequestHeader(h,l);y===!0&&(u.withCredentials=!0),u.onload=function(t){0==u.status||u.status>=200&&u.status<=300?f&&206!=u.status?o("ERROR: range-byte header was ignored for url: "+i):n(u.response,u):o(416===u.status?"Unsatisfiable range":"Error accessing resource: "+u.status)},u.onerror=function(a){e(i)&&i&&!r.crossDomainRetried&&igv.browser.crossDomainProxy&&i!=igv.browser.crossDomainProxy?(r.sendData="url="+i,r.crossDomainRetried=!0,t.load(igv.browser.crossDomainProxy,r).then(n)):o("Error accessing resource: "+i+" Status: "+u.status)},u.ontimeout=function(t){o("Timed out")},u.onabort=function(t){console.log("Aborted"),a(new igv.AbortLoad)};try{u.send(d)}catch(t){console.log(t)}})},t.loadArrayBuffer=function(e,i){return void 0===i&&(i={}),i.responseType="arraybuffer",t.load(e,i)},t.loadJson=function(e,i){var r=i.method||(i.sendData?"POST":"GET");return"POST"==r&&(i.contentType="application/json"),new Promise(function(r,n){t.load(e,i).then(function(t){r(t?JSON.parse(t):t)}).catch(n)})},t.loadString=function(e,a){var o,s,h;return void 0===a&&(a={}),h=e.indexOf("?"),s=h>0?e.substring(0,h):e,o=a.bgz?n:s.endsWith(".gz")?r:i,o===i?(a.mimeType="text/plain; charset=x-user-defined",t.load(e,a)):(a.responseType="arraybuffer",new Promise(function(i,r){t.load(e,a).then(function(e){var r=t.arrayBufferToString(e,o);i(r)}).catch(r)}))},t.loadStringFromFile=function(e,a){return new Promise(function(o,s){var h=new FileReader;a.range;h.onload=function(s){var l,c;l=a.bgz?n:e.name.endsWith(".gz")?r:i,c=t.arrayBufferToString(h.result,l),o(c,e)},h.onerror=function(t){console.log("reject uploading local file "+e.name),s(null,h)},h.readAsArrayBuffer(e)})},t.arrayBufferToString=function(t,e){var i,a;e===r?(a=new Zlib.Gunzip(new Uint8Array(t)),i=a.decompress()):i=e===n?new Uint8Array(igv.unbgzf(t)):new Uint8Array(t);for(var o="",s=0,h=i.length;s<h;s++)o+=String.fromCharCode(i[s]);return o},igv.AbortLoad=function(){},t}(igvxhr||{}),igv=function(t){function e(t,i,r){return i.interval.overlaps(t)&&r.push(i.interval),i.left!=l&&i.left.max>=t.low&&e.call(this,t,i.left,r),i.right!=l&&i.right.min<=t.high&&e.call(this,t,i.right,r),r}function i(t){var e=t.right;t.right=e.left,e.left!=l&&(e.left.parent=t),e.parent=t.parent,t.parent==l?this.root=e:t.parent.left==t?t.parent.left=e:t.parent.right=e,e.left=t,t.parent=e,n.call(this,t)}function r(t){var e=t.left;t.left=e.right,e.right!=l&&(e.right.parent=t),e.parent=t.parent,t.parent==l?this.root=e:t.parent.right==t?t.parent.right=e:t.parent.left=e,e.right=t,t.parent=e,n.call(this,t)}function n(t){for(;t!=l;){var e=t.left.max>t.right.max?t.left.max:t.right.max,i=t.interval.high;t.max=e>i?e:i;var r=t.left.min<t.right.min?t.left.min:t.right.min,n=t.interval.low;t.min=r<n?r:n,t=t.parent}}function a(t,e,i){this.low=t,this.high=e,this.value=i}function o(t){this.parent=l,this.left=l,this.right=l,this.interval=t,this.color=h}var s=1,h=2,l={};return l.color=s,l.parent=l,l.left=l,l.right=l,t.IntervalTree=function(){this.root=l},t.IntervalTree.prototype.insert=function(t,e,n){var l=new a(t,e,n),c=new o(l);for(this.treeInsert(c),c.color=h;c!=this.root&&c.parent.color==h;)if(c.parent==c.parent.parent.left){var u=c.parent.parent.right;u.color==h?(c.parent.color=s,u.color=s,c.parent.parent.color=h,c=c.parent.parent):(c==c.parent.right&&(c=c.parent,i.call(this,c)),c.parent.color=s,c.parent.parent.color=h,r.call(this,c.parent.parent))}else{var u=c.parent.parent.left;u.color==h?(c.parent.color=s,u.color=s,c.parent.parent.color=h,c=c.parent.parent):(c==c.parent.left&&(c=c.parent,r.call(this,c)),c.parent.color=s,c.parent.parent.color=h,i.call(this,c.parent.parent))}this.root.color=s},t.IntervalTree.prototype.findOverlapping=function(t,i){var r=new a(t,i,0);if(this.root===l)return[];var n=e.call(this,r,this.root,[]);return n.length>1&&n.sort(function(t,e){return t.low-e.low}),n},t.IntervalTree.prototype.logIntervals=function(){function t(e,i){for(var r="",n=0;n<i;n++)r+=" ";console.log(r+e.interval.low+" "+e.interval.high),i+=5,e.left!=l&&t(e.left,i),e.right!=l&&t(e.right,i)}t(this.root,0)},t.IntervalTree.prototype.mapIntervals=function(t){function e(i){t(i.interval),i.left!=l&&e(i.left),i.right!=l&&e(i.right)}e(this.root)},t.IntervalTree.prototype.treeInsert=function(t){for(var e=this.root,i=l;e!=l;)i=e,e=t.interval.low<=e.interval.low?e.left:e.right;t.parent=i,i==l?(this.root=t,t.left=t.right=l):t.interval.low<=i.interval.low?i.left=t:i.right=t,n.call(this,t)},a.prototype.equals=function(t){return!!t&&(this==t||this.low==otherInterval.low&&this.high==otherInterval.high)},a.prototype.compareTo=function(t){return this.low<t.low?-1:this.low>t.low?1:this.high<t.high?-1:this.high>t.high?1:0},a.prototype.overlaps=function(e){try{return this.low<=e.high&&e.low<=this.high}catch(e){t.presentAlert(e)}},t}(igv||{}),igv=function(t){var e=function(t){};return t.KaryoPanel=function(e){this.ideograms=null,t.guichromosomes=[],this.div=$('<div class="igv-karyo-div"></div>')[0],$(e).append(this.div);var i=$('<div class="igv-karyo-content-div"></div>')[0];$(this.div).append(i);var r=$('<canvas class="igv-karyo-canvas"></canvas>')[0];$(i).append(r),r.setAttribute("width",i.offsetWidth),r.setAttribute("height",i.offsetHeight),this.canvas=r,this.ctx=r.getContext("2d");var n=document.createElement("canvas");n.style.position="absolute",n.style.width="100px",n.style.height="20px",n.style.left="-2000px",n.setAttribute("width","100px"),n.setAttribute("height","20px");var a=n.getContext("2d");i.appendChild(n),this.canvas.onmousemove=function(e){for(var i=t.translateMouseCoordinates(e,r),o=i.x,s=i.y,h=!1,l=0;l<t.guichromosomes.length;l++){var c=t.guichromosomes[l];if(c.x<o&&c.right>o&&c.y<s&&c.bottom>s){var u=s-c.y,d=Math.round(c.size*u/c.h);n.style.left=Math.round(o+20)+"px",n.style.top=Math.round(s-5)+"px",a.clearRect(0,0,n.width,n.height),a.fillStyle="rgb(255,255,220)",a.fillRect(0,0,n.width,n.height),a.fillStyle="rgb(0,0,0)";var p=Math.round(d/1e6);a.fillText(c.name+" @ "+p+" MB",3,12),h=!0;break}}h||(n.style.left="-2000px")},this.canvas.onclick=function(e){var i=t.translateMouseCoordinates(e,r),n=i.x,a=i.y;t.navigateKaryo(n,a)}},t.navigateKaryo=function(i,r){for(var n=0;n<t.guichromosomes.length;n++){var a=t.guichromosomes[n];if(a.x<i&&a.right>i&&a.y<r&&a.bottom>r){var o=r-a.y,s=Math.round(a.size*o/a.h);e("Going to position "+s),t.browser.goto(a.name,s,void 0);break}}t.browser.update()},t.KaryoPanel.prototype.resize=function(){var t=this.canvas;t.setAttribute("width",t.clientWidth),t.setAttribute("height",t.clientHeight),e("Resize called: width="+t.clientWidth+"/"+t.clientHeight),this.ideograms=void 0,this.repaint()},t.KaryoPanel.prototype.repaint=function(){function i(){p=document.createElement("canvas"),p.width=c,p.height=u;var i=p.getContext("2d"),r=0,a=0,h=1,l=b;t.guichromosomes=[];for(_ in d){if(r>f)break;1==h&&2==g&&r+1>f/2&&(h=2,a=0,l=l+y+b),r++,a++;var w=s.getChromosome(_);"chrM"!=_||w.bpLength||(w.bpLength=16e3),w.x=a*v,w.y=l;var k=new Object;k.name=_,t.guichromosomes.push(k),n(k,w.x,w.y,w,i,m,y,S)}this.ideograms=p,e("============= PROCESSING "+t.browser.trackViews.length+" TRACKS");for(var x=0,C=0;C<t.browser.trackViews.length;C++){var T=t.browser.trackViews[C],A=T.track;if(A.getSummary&&A.loadSummary){e("Found track with summary: "+A.name);var E=A;window.source=A,E.loadSummary("chr1",0,1e6,function(e){if(e){r=0;for(_ in d){var n=t.guichromosomes[r];r++,n&&n.size&&o(E,_,0,n.size,n,i,x)}}}),x++}}}function r(t,e,i,r,n,a,o,h,l,c){if(s&&i&&e){var u=e.length;if(0!=u)for(var d=h/l,p=1,f=0;f<e.length;f++){var g=e[f],v="rgb(0,0,150)",m=g.score;t.getColor&&(v=t.getColor(m));var b=d*g.start+n,y=d*g.end+n,w=Math.max(.01,y-b);a.fillStyle=v,a.fillRect(r+o+2*c+1,b,p,w)}}}function n(t,e,i,r,n,o,h,l){if(s&&r){var c=s.getCytobands(r.name);if(c){var u=e+o/2,d=[],p=[],f=c.length,g=h/l;t.x=e,t.y=i,t.w=o,t.right=e+o;var v=0,m=-1;if(f>0)v=c[f-1].end,t.h=g*v,t.size=v;else{var b=5;m=i+b,t.h=b,t.size=b/g}if(t.longest=l,t.bottom=i+t.h,f>0)for(var y=0;y<c.length;y++){var w=c[y],k=g*w.start+i,x=g*w.end+i;if(x>m)if("c"==w.type)"p"==w.name.charAt(0)?(p[0]=k,d[0]=o+e,p[1]=k,d[1]=e,p[2]=x,d[2]=u):(p[0]=x,d[0]=o+e,p[1]=x,d[1]=e,p[2]=k,d[2]=u),n.fillStyle="rgb(220, 150, 100)",n.strokeStyle="rgb(150, 0, 0)",n.polygon(d,p,1,0);else{var S=x-k;n.fillStyle=a(w),n.fillRect(e,k,o,S)}m=x}}n.fillStyle=null,n.lineWidth=1,n.strokeStyle="darkgray";var _=o/2;n.roundRect(e,i-_/2,o,m-i+_,o/2,0,1),n.font="bold 10px Arial",n.fillStyle="rgb(0, 0, 0)";var C=r.name;C.length>3&&(C=C.substring(3)),n.fillText(C,e+o/2-3*C.length,i-10)}}function a(t){if("c"==t.type)return"rgb(150, 10, 10)";var e=t.stain,i=230;"p"==t.type&&(i=Math.floor(230-e/100*230));var r=l[i];return null==r&&(r="rgb("+i+","+i+","+i+")",l[i]=r),r}function o(t,e,i,n,a,o,s){t.getSummary(e,i,n,function(e){e&&(len=e.length,r(t,e,a,a.x,a.y,o,m,y,S,s),x.repaint())})}var s=t.browser.genome,h=t.browser.referenceFrame,l=[],c=this.canvas.width,u=this.canvas.height;if(this.ctx.clearRect(0,0,c,u),s&&h&&s.chromosomes&&h.chr){var d=s.getChromosomes(),p=this.ideograms;if(d.length<1)return void e("No chromosomes yet, returning");var f=24,g=1;c<300&&(g=2);var v=Math.min(50,(c-20)/(f+2)*g),m=Math.min(20,v/2),b=25,y=(u-25)/g-b,w=s.getLongestChromosome(),k=s.getCytobands(w.name),x=this,S=k[k.length-1].end;p&&null!=p||i.call(this),this.ctx.drawImage(p,0,0),this.ctx.save();var _=h.chr;this.genome&&(_=this.genome.getChromosomeName(_));var C=t.browser.genome.getChromosome(_);if(C){var T=w.bpLength/y,A=C.y-3+Math.round(h.start/T),E=Math.max(3,t.browser.trackViewportWidth()*h.bpPerPixel/T);this.ctx.strokeStyle="rgb(150, 0, 0)",this.ctx.lineWidth=2,this.ctx.strokeRect(C.x-3,A,m+6,E+6),this.ctx.restore()}else e("Could not find chromosome "+_)}},t}(igv||{}),oauth=function(t){if(!t.google){var e,i,r,n="https://accounts.google.com/o/oauth2/auth?",a="https://www.googleapis.com/oauth2/v1/tokeninfo?access_token=",o="http://localhost/igv-web/emptyPage.html",s=n+"scope=https://www.googleapis.com/auth/cloud-platform https://www.googleapis.com/auth/genomics https://www.googleapis.com/auth/devstorage.read_only https://www.googleapis.com/auth/userinfo.profile&state=%2Fprofile&redirect_uri=http%3A%2F%2Flocalhost%2Figv-web%2FemptyPage.html&response_type=token&client_id=661332306814-8nt29308rppg325bkq372vli8nm3na14.apps.googleusercontent.com",h=!1;t.google={login:function(r){var n=window.open(s,"windowname1","width=800, height=600"),a=window.setInterval(function(){try{if(console.log(n.document.URL),n.document.URL.indexOf(o)!=-1){window.clearInterval(a);var s=n.document.URL;t.google.access_token=t.google.gup(s,"access_token"),e=t.google.gup(s,"token_type"),i=t.google.gup(s,"expires_in"),n.close(),t.google.validateToken(t.google.access_token),r&&r()}}catch(t){}},500)},validateToken:function(e){$.ajax({url:a+e,data:null,success:function(e){t.google.getUserInfo(),h=!0},dataType:"jsonp"})},getUserInfo:function(){$.ajax({url:"https://www.googleapis.com/oauth2/v1/userinfo?access_token="+t.google.access_token,data:null,success:function(t){r=t,console.log(r)},dataType:"jsonp"})},gup:function(t,e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var i="[\\#&]"+e+"=([^&#]*)",r=new RegExp(i),n=r.exec(t);return null==n?"":n[1]}}}return t}(oauth||{}),igv=function(t){return t.oauth=oauth,t}(igv||{}),igv=function(t){return t.isBlank=function(t){var e=t.match(/\S+/g);return!e},t.isComment=function(t){var e=t.indexOf("#");return 0==e},t.getQueryValue=function(t){t=t.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var e="[\\?&]"+t+"=([^&#]*)",i=new RegExp(e),r=i.exec(window.location.href);return null==r?void 0:r[1]},t}(igv||{}),igv=function(t){return t.ReferenceFrame=function(t,e,i){this.chr=t,this.start=e,this.bpPerPixel=i},t.ReferenceFrame.prototype.toPixels=function(t){return t/this.bpPerPixel},t.ReferenceFrame.prototype.toBP=function(t){return this.bpPerPixel*t},t.ReferenceFrame.prototype.shiftPixels=function(t){this.start+=t*this.bpPerPixel},t.ReferenceFrame.prototype.description=function(){return"ReferenceFrame "+this.chr+" "+t.numberFormatter(Math.floor(this.start))+" bpp "+this.bpPerPixel},t}(igv||{}),igv=function(t){function e(t,e,i){this.majorTick=t,this.majorUnit=e,this.unitMultiplier=i}function i(t){function i(t){var e=Math.log(10);return Math.log(t)/e}if(t<10)return new e(1,"",1);var r=Math.floor(i(t)),n="",a=1;r>9&&(n="gb",a=1e9),r>6?(n="mb",a=1e6):r>3&&(n="kb",a=1e3);var o=t/Math.pow(10,r-1);return o<25?new e(Math.pow(10,r-1),n,a):new e(Math.pow(10,r)/2,n,a)}return t.RulerTrack=function(){this.height=50,this.name="",this.id="ruler",this.disableButtons=!0,this.ignoreTrackMenu=!0,this.order=-Number.MAX_VALUE},t.RulerTrack.prototype.getFeatures=function(t,e,i){return new Promise(function(t,e){t([])})},t.RulerTrack.prototype.draw=function(e){function r(t,e){var i=10;switch(e){case 0:i=1;break;case 1:i=10;break;case 2:i=100;break;default:i=1e3}var r=Math.abs(Math.round(t*i)/i),n=""+r;n.indexOf(".")==-1&&(n+=".");for(var a=n.substr(0,n.indexOf(".")),o=a-0,s=n.substr(n.indexOf("."));s.length-1<e;)s+="0";if("."==s&&(s=""),o>=1e3){var h=a.length;a=parseInt(""+o/1e3)+","+a.substring(h-3,h)}o>=1e6&&(h=a.length,a=parseInt(""+o/1e6)+","+a.substring(h-7,h));var l=a+s;return t<0&&(l="("+l+")"),l}var n,a,o,s,h,l,c=e.context;for(n={textAlign:"center",font:"10px PT Sans",fillStyle:"rgba(64, 64, 64, 1)",strokeStyle:"rgba(64, 64, 64, 1)"},a=Math.floor(1100*e.bpPerPixel),o=i(a),s=o.majorTick,h=Math.floor(e.bpStart/s)-1,l=0,t.graphics.setProperties(c,n);l<e.pixelWidth;){var u=Math.floor(h*s),d=2;l=Math.round((u-1-e.bpStart+.5)/e.bpPerPixel);var p=r(u/o.unitMultiplier,0)+" "+o.majorUnit;h%1==0&&t.graphics.fillText(c,p,l,this.height-15),t.graphics.strokeLine(c,l,this.height-10,l,this.height-d),h++}t.graphics.strokeLine(c,0,this.height-d,e.pixelWidth,this.height-d)},t}(igv||{}),igv=function(t){return t.SequenceTrack=function(t){this.name="",this.id="sequence",this.sequenceType=t.sequenceType||"dna",this.height=15,this.disableButtons=!0,this.order=t.order||9999,this.ignoreTrackMenu=!0},t.SequenceTrack.prototype.getFeatures=function(e,i,r){return new Promise(function(n,a){t.browser.referenceFrame.bpPerPixel>1?n(null):t.browser.genome.sequence.getSequence(e,i,r).then(n).catch(a)})},t.SequenceTrack.prototype.draw=function(e){var i,r,n,a,o,s,h,l,c,u,d=e.features,p=e.context,f=e.bpPerPixel,g=e.bpStart,v=e.pixelWidth,m=g+v*f+1;if(d)for(i=d.length,r=1/f,n=this.height/2,a=g;a<=m;a++)o=a-g,o<i&&(s=d[o],h=Math.floor(o*r),l=Math.floor((o+1)*r),c=Math.round((h+l)/2),u=this.color?this.color:"dna"===this.sequenceType?t.nucleotideColors[s]:"rgb(0, 0, 150)",u||(u="gray"),f>.1?t.graphics.fillRect(p,h,0,l-h,10,{fillStyle:u}):t.graphics.strokeText(p,s,c,n,{strokeStyle:u,font:"normal 10px Arial",textAlign:"center"}))},t}(igv||{});Array.isArray||(Array.isArray=function(t){return"[object Array]"===Object.prototype.toString.call(t)}),"undefined"!=typeof Set?(Set.prototype.isEmpty=function(){return 0===this.size},Set.prototype.addAll=function(t){if(Array.isArray(t)||this._isPseudoArray(t))for(var e=0;e<t.length;e++)this.add(t[e]);else if(t instanceof Set){var i=this;t.each(function(t,e){i.add(e,t)})}}):(Set=function(){this.data={},this.add.apply(this,arguments)},Set.prototype={add:function(){for(var t,e=0;e<arguments.length;e++)if(t=arguments[e],Array.isArray(t)||this._isPseudoArray(t))for(var i=0;i<t.length;i++)this._add(t[i]);else if(t instanceof Set){var r=this;t.each(function(t,e){r._add(e,t)})}else this._add(t);return this},addAll:function(t){if(Array.isArray(t)||this._isPseudoArray(t))for(var e=0;e<t.length;e++)this._add(t[e]);else if(t instanceof Set){var i=this;t.each(function(t,e){i._add(e,t)})}return this},_add:function(t,e){return"undefined"==typeof e&&(e=t),this.data[this._makeKey(t)]=e,this},_getKey:function(t){return t},_makeKey:function(t){return t},_removeItem:function(t){delete this.data[this._getKey(t)]},_isPseudoArray:function(t){return!1},delete:function(t){for(var e,i=0;i<arguments.length;i++)if(e=arguments[i],Array.isArray(e)||this._isPseudoArray(e))for(var r=0;r<e.length;r++)this._removeItem(e[r]);else this._removeItem(e);return this},has:function(t){return t=this._makeKey(t),Object.prototype.hasOwnProperty.call(this.data,t)},hasAll:function(t){var e=this.makeNew.apply(this,arguments),i=this;return e.every(function(t,e){return i.has(e)})},makeSet:function(t){return t instanceof Set?t:this.makeNew.apply(this,arguments)},equals:function(t){return t=this.makeSet(t),this.isSubset(t)&&this.isSuperset(t)},isEmpty:function(){for(var t in this.data)if(this.has(t))return!1;return!0},size:function(){var t=0;for(var e in this.data)this.has(e)&&t++;return t},keys:function(){var t=[];return this.each(function(e){t.push(e)}),t},clear:function(){return this.data={},this},makeNew:function(){var t=new this.constructor;return arguments.length&&t.add.apply(t,arguments),t},union:function(t){t=this.makeSet(t);var e=this.makeNew(this);return e.add(t),e},intersection:function(t){t=this.makeSet(t);var e=this.makeNew();return this.each(function(i,r){t.has(r)&&e._add(r,i)}),e},difference:function(t){t=this.makeSet(t);var e=this.makeNew();return this.each(function(i,r){t.has(r)||e._add(r,i)}),e},notInBoth:function(t){t=this.makeSet(t);var e=this.difference(t);return e.add(t.difference(this))},isSubset:function(t){return t=this.makeSet(t),this.eachReturn(function(e,i){if(!t.has(i))return!1})},isSuperset:function(t){t=this.makeSet(t);var e=this;return t.eachReturn(function(t,i){if(!e.has(i))return!1})},each:function(t){return this.eachReturn(t),this},eachReturn:function(t){for(var e in this.data)if(this.has(e)&&t.call(this,this.data[e],e)===!1)return!1;return!0},filter:function(t){var e=this.makeNew();return this.each(function(i,r){t.call(this,r)===!0&&e._add(r,i)}),e},map:function(t){var e=this.makeNew();return this.each(function(i,r){var n=t.call(this,r);"undefined"!=typeof n&&e._add(r,i)}),e},some:function(t){var e=!1;return this.eachReturn(function(i){if(t.call(this,i)===!0)return e=!0,!1}),e},every:function(t){return this.eachReturn(t)}},Set.prototype.constructor=Set);var igv=function(t){var e;return t.SVG=function(){this.svg="",this.contents=[],e=[]},t.SVG.prototype.setProperties=function(t){var e="";for(var i in t)if(t.hasOwnProperty(i)){var r=t[i];"font-family"===i?e+="font-family:"+r+";":"font-size"===i?e+="font-size:"+r+";":"fillStyle"==i?e+="fill:"+r+";":"fill"===i?e+="fill:"+r+";":"strokeStyle"==i?e+="stroke:"+r+";":"stroke"===i?e+="stroke:"+r+";":"stroke-width"===i?e+="stroke-width:"+r+";":console.log("Unknown property: "+i)}return e},t.SVG.prototype.setTransforms=function(t,e,i){var r="";for(var n in t){if(t.hasOwnProperty(n)){var a=t[n];"rotate"===n?(r+="rotate("+a.angle,r+=","+e,r+=","+i,r+=")"):"translate"===n?(r+="translate("+a[e],"y"in a&&(r+=","+a.y),r+=")"):console.log("Unknown transform: "+n)}r+=" "}return r},t.SVG.prototype.clearRect=function(t,e,i,r){},t.SVG.prototype.strokeLine=function(t,e,i,r,n,a){var o="";o+='<line x1="'+t+'" y1="'+e+'" x2="'+i+'" y2="'+r+'"',n&&(o+=' style="'+this.setProperties(n)+'"'),a&&(o+=' transform="'+this.setTransforms(a,t,e)+'"'),o+="/>",this.contents.push(o)},t.SVG.prototype.fillRect=function(t,e,i,r,n,a){var o="";o+='<rect x="'+t+'" y="'+e,o+='" width="'+i+'" height="'+r+'"',n&&(o+=' style="'+this.setProperties(n)+'"'),a&&(o+=' transform="'+this.setTransforms(a,t,e)+'"'),o+="/>",this.contents.push(o)},t.SVG.prototype.fillRectWithCenter=function(t,e,i,r,n,a){var o="";o+='<rect x="'+(t-i/2)+'" y="'+(e-r/2),o+='" width="'+i+'" height="'+r+'"',n&&(o+=' style="'+this.setProperties(n)+'"'),a&&(o+=' transform="'+this.setTransforms(a,t,e)+'"'),o+="/>",this.contents.push(o)},t.SVG.prototype.fillPolygon=function(t,e,i,r){var n="";n+='<polygon points="';for(var a=0;a<t.length;a++)n+=" "+t[a]+","+e[a];n+='"',i&&(n+=' style="'+this.setProperties(i)+'"'),r&&(n+=' transform="'+this.setTransforms(r,t,e)+'"'),n+="/>",this.contents.push(n)},t.SVG.prototype.fillText=function(t,e,i,r,n){var a="";a+='<text x="'+e+'" y="'+i+'"',r&&(a+=' style="'+this.setProperties(r)+'"'),n&&(a+=' transform="'+this.setTransforms(n,e,i)+'"'),a+=">",a+=t,a+="</text>",this.contents.push(a)},t.SVG.prototype.strokeText=function(t,e,i,r,n){var a="";a+='<text x="'+e+'" y="'+i+'"',r&&(a+=' style="'+this.setProperties(r)+'"'),n&&(a+=' transform="'+this.setTransforms(n,e,i)+'"'),a+=">",a+=t,a+="</text>",this.contents.push(a)},t.SVG.prototype.strokeCircle=function(t,e,i,r,n){var a="";a+='<circle cx="'+t+'" cy="'+e+'" r="'+i+'" stroke="black" fill-opacity="0.0"/>',this.contents.push(a)},t.SVG.prototype.string=function(){var t="";t+='<svg width="100%" height="100%" version="1.1" xmlns="http://www.w3.org/2000/svg">';for(var e=0;e<this.contents.length;e++)t+="\n"+this.contents[e];return t+="</svg>"},t.SVG.prototype.innerString=function(){for(var t="",e=0;e<this.contents.length;e++)t+="\n"+this.contents[e];return t},t}(igv||{}),igv=function(t){return t.configTrack=function(e,i){e.config=i,e.url=i.url,i.name=i.name||i.label,i.name?e.name=i.name:i.localFile?e.name=i.localFile.name:e.name=i.url,e.id=i.id||e.name,e.order=i.order,e.color=i.color||t.browser.constants.defaultColor,e.removable=void 0===i.removable||i.removable,e.height=i.height||("wig"===i.type?50:100),void 0===i.autoHeight&&(i.autoHeight=i.autoheight),e.autoHeight=void 0===i.autoHeight?void 0===i.height:i.autoHeight,e.minHeight=i.minHeight||Math.min(50,e.height),e.maxHeight=i.maxHeight||Math.max(500,e.height),i.visibilityWindow&&(e.visibilityWindow=i.visibilityWindow)},t.setTrackLabel=function(t,e){t.name=e,$(t.trackView.viewportDiv).find(".igv-track-label").html(t.name),t.trackView&&t.trackView.repaint()},t.setTrackColor=function(t,e){t.color=e,t.trackView&&t.trackView.repaint()},t.paintAxis=function(e,i,r){function n(t){return 0===t?"0":Math.abs(t)>=10?t.toFixed():Math.abs(t)>=1?t.toFixed(1):t.toFixed(2)}var a,o,s,h,l,c,u,d,p={font:"normal 10px Arial",textAlign:"right",strokeStyle:"black"};void 0!==this.dataRange&&void 0!==this.dataRange.max&&void 0!==this.dataRange.min&&(t.graphics.fillRect(e,0,0,i,r,{fillStyle:"rgb(255, 255, 255)"}),u=.95*i,a=u-8,o=u,d=.01,s=h=d*r,l={x:o,y:s},t.graphics.strokeLine(e,a,s,o,h,p),t.graphics.fillText(e,n(this.dataRange.max),a+4,s+12,p),s=h=(1-d)*r,c={x:o,y:s},t.graphics.strokeLine(e,a,s,o,h,p),t.graphics.fillText(e,n(this.dataRange.min),a+4,s-4,p),t.graphics.strokeLine(e,l.x,l.y,c.x,c.y,p))},t}(igv||{}),igv=function(t){function e(t,e){var i;this.track.minHeight&&(t=Math.max(this.track.minHeight,t)),this.track.maxHeight&&(t=Math.min(this.track.maxHeight,t)),i=t+"px",this.track.height=t,this.trackDiv.style.height=i,this.track.paintAxis&&(this.controlCanvas.style.height=i,this.controlCanvas.setAttribute("height",t)),this.viewportDiv.style.height=i,void 0!==e&&e!==!0||this.update()}function i(t,e,i,r,n){this.chr=t,this.startBP=e,this.endBP=i,this.scale=r,this.image=n}function r(e){var i,r,n,a=void 0,o=void 0,s=void 0,h=void 0,l=1;$(document).mousedown(function(n){s=t.translateMouseCoordinates(n,e.contentDiv),i=s.x,r=0,e.rulerSweeper.css({display:"inline",left:i+"px",width:r+"px"}),o=!0}),$(e.contentDiv).mousedown(function(t){a=!0}),$(document).mousemove(function(c){a&&o&&(h=t.translateMouseCoordinates(c,e.contentDiv),n=h.x-s.x,r=Math.abs(n),r>l&&(e.rulerSweeper.css({width:r+"px"}),n<0&&(i=s.x+n,e.rulerSweeper.css({left:i+"px"}))))}),$(document).mouseup(function(n){var s,h,c;a&&(a=!1,o=!1,e.rulerSweeper.css({display:"none",left:"0px",width:"0px"}),h=t.browser.referenceFrame.start+i*t.browser.referenceFrame.bpPerPixel,c=h+r*t.browser.referenceFrame.bpPerPixel,r>l&&(s=t.browser.referenceFrame.chr+":"+t.numberFormatter(Math.floor(h))+"-"+t.numberFormatter(Math.floor(c)),t.browser.search(s)))})}function n(e){var i,r=!1,n=void 0,a=void 0,o=0,s=t.browser.constants.doubleClickDelay;$(e.canvas).mousedown(function(i){var o=t.translateMouseCoordinates(i,e.canvas);r=!0,n=o.x,a=n}),$(e.canvas).click(function(h){h=$.event.fix(h),h.stopPropagation();var l=t.translateMouseCoordinates(h,e.canvas),c=e.browser.referenceFrame,u=Math.floor(c.start+c.toBP(l.x)),d=Date.now();if(c){if(d-o<s){i&&(window.clearTimeout(i),i=void 0);var p=Math.round(c.start+l.x*c.bpPerPixel);c.bpPerPixel/=2,t.browser.goto(c.chr,p)}else h.shiftKey?e.track.shiftClick&&e.tile&&e.track.shiftClick(u,h):h.altKey?e.track.altClick&&e.tile&&e.track.altClick(u,h):Math.abs(l.x-a)<=t.browser.constants.dragThreshold&&e.track.popupData&&(i=window.setTimeout(function(){var r,n;if(void 0!==u&&null!==e.tile){n=Math.round(c.toPixels(e.tile.startBP-c.start)),r=e.track.popupData(u,l.x-n,l.y);var o=t.browser.fireEvent("trackclick",[e.track,r]);void 0===o?r&&r.length>0&&t.popover.presentTrackPopup(h.pageX,h.pageY,t.formatPopoverText(r),!1):"string"==typeof o&&t.popover.presentTrackPopup(h.pageX,h.pageY,o,!1),a=void 0,i=void 0}},s));a=void 0,r=!1,n=void 0,o=d}})}return t.TrackView=function(e,i){function a(e){s.igvTrackDragScrim=$('<div class="igv-track-drag-scrim">')[0],$(s.viewportDiv).append(s.igvTrackDragScrim),$(s.igvTrackDragScrim).hide(),s.igvTrackManipulationHandle=$('<div class="igv-track-manipulation-handle">')[0],$(s.trackDiv).append(s.igvTrackManipulationHandle),$(s.igvTrackManipulationHandle).mousedown(function(e){s.isMouseDown=!0,t.browser.dragTrackView=s}),$(s.igvTrackManipulationHandle).mouseup(function(t){s.isMouseDown=void 0}),$(s.igvTrackManipulationHandle).mouseenter(function(e){s.isMouseIn=!0,t.browser.dragTargetTrackView=s,void 0===t.browser.dragTrackView?$(s.igvTrackDragScrim).show():s===t.browser.dragTrackView&&$(s.igvTrackDragScrim).show(),t.browser.dragTargetTrackView&&t.browser.dragTrackView&&t.browser.dragTargetTrackView!==t.browser.dragTrackView&&(t.browser.dragTargetTrackView.track.order<t.browser.dragTrackView.track.order?(t.browser.dragTrackView.track.order=t.browser.dragTargetTrackView.track.order,
t.browser.dragTargetTrackView.track.order=1+t.browser.dragTrackView.track.order):(t.browser.dragTrackView.track.order=t.browser.dragTargetTrackView.track.order,t.browser.dragTargetTrackView.track.order=t.browser.dragTrackView.track.order-1),t.browser.reorderTracks())}),$(s.igvTrackManipulationHandle).mouseleave(function(e){s.isMouseIn=void 0,t.browser.dragTargetTrackView=void 0,s!==t.browser.dragTrackView&&$(s.igvTrackDragScrim).hide()})}var o,s=this;this.track=e,this.browser=i,this.trackDiv=$('<div class="igv-track-div">')[0],$(i.trackContainerDiv).append(this.trackDiv),e.height&&(this.trackDiv.style.height=e.height+"px"),this.appendLeftHandGutterDivToTrackDiv($(this.trackDiv)),this.appendViewportDivToTrackDiv($(this.trackDiv)),o=this.createRightHandGutter(),o&&$(this.trackDiv).append(o),this.trackDiv.appendChild(t.spinner()),a(this.track),this.track instanceof t.RulerTrack?(this.trackDiv.dataset.rulerTrack="rulerTrack",this.rulerSweeper=$('<div class="igv-ruler-sweeper-div">'),$(this.contentDiv).append(this.rulerSweeper[0]),r(this)):n(this),$(".igv-ideogram-content-div").addClass("igv-ideogram-gutter-shim"),$(".igv-viewport-div").addClass("igv-gutter-shim")},t.TrackView.prototype.appendViewportDivToTrackDiv=function(e){var i,r,n=this;this.viewportDiv=$('<div class="igv-viewport-div">')[0],e.append(this.viewportDiv),this.contentDiv=$('<div class="igv-content-div">')[0],$(this.viewportDiv).append(this.contentDiv),this.canvas=$('<canvas class = "igv-content-canvas">')[0],$(this.contentDiv).append(this.canvas),this.canvas.setAttribute("width",this.contentDiv.clientWidth),this.canvas.setAttribute("height",this.contentDiv.clientHeight),this.ctx=this.canvas.getContext("2d"),void 0!==this.track.visibilityWindow&&(n.$zoomInNotice=$('<div class="zoom-in-notice">'),n.$zoomInNotice.text("Zoom in to see features"),$(this.contentDiv).append(n.$zoomInNotice[0]),n.$zoomInNotice.hide()),"hidden"===$(this.viewportDiv).css("overflow-y")&&(this.scrollbar=new TrackScrollbar(this.viewportDiv,this.contentDiv),this.scrollbar.update(),$(this.viewportDiv).append(this.scrollbar.outerScrollDiv)),this.track.name&&(i=this.track.description||this.track.name,r=$('<div class="igv-track-label">'),r.html(this.track.name),r.click(function(e){t.popover.presentTrackPopup(e.pageX,e.pageY,i,!1)}),$(this.viewportDiv).append(r[0]))},t.TrackView.prototype.appendLeftHandGutterDivToTrackDiv=function(e){var i,r,n,a,o=this;this.track.paintAxis&&(i=$('<div class="igv-left-hand-gutter">'),e.append(i[0]),r=$('<canvas class ="igv-track-control-canvas">'),n=i.outerWidth(),a=i.outerHeight(),r.attr("width",n),r.attr("height",a),i.append(r[0]),this.controlCanvas=r[0],this.controlCtx=this.controlCanvas.getContext("2d"),this.track.dataRange&&(i.click(function(e){t.dataRangeDialog.configureWithTrackView(o),t.dataRangeDialog.show()}),i.addClass("igv-clickable")),this.leftHandGutter=i[0])},t.TrackView.prototype.createRightHandGutter=function(){var e,i=this;if(!this.track.ignoreTrackMenu)return e=$('<i class="fa fa-gear fa-20px igv-track-menu-gear igv-app-icon">'),$(e).click(function(e){t.popover.presentTrackMenu(e.pageX,e.pageY,i)}),this.rightHandGutter=$('<div class="igv-right-hand-gutter">')[0],$(this.rightHandGutter).append(e[0]),this.rightHandGutter},t.TrackView.prototype.resize=function(){var t=this.canvas,e=this.contentDiv,i=this.viewportDiv.clientWidth;i>0&&(e.style.width=i+"px",t.style.width=i+"px",t.setAttribute("width",i),this.update())},t.TrackView.prototype.setTrackHeight=function(t,i){e.call(this,t,i||!0)},t.TrackView.prototype.setContentHeight=function(t){t=Math.min(t,32e3),this.track.minHeight&&(t=Math.max(this.track.minHeight,t));var i=t+"px";this.track.autoHeight&&e.call(this,t,!1),this.contentDiv.style.height=i,this.canvas.setAttribute("height",this.canvas.clientHeight),this.track.paintAxis&&(this.controlCanvas.style.height=i,this.controlCanvas.setAttribute("height",t)),this.scrollbar&&this.scrollbar.update()},t.TrackView.prototype.update=function(){this.tile=null,this.scrollbar&&this.scrollbar.update(),this.repaint()},t.TrackView.prototype.repaint=function(){function e(){return this.track&&this.browser&&this.browser.referenceFrame}var r,n,a,o,s,h,l,c,u,d=this;if(e.call(this)){if(void 0!==this.track.visibilityWindow&&this.track.visibilityWindow>0){if(t.browser.trackViewportWidthBP()>this.track.visibilityWindow)return this.tile=null,this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),t.stopSpinnerAtParentElement(this.trackDiv),void this.$zoomInNotice.show();this.$zoomInNotice.hide()}if(h=this.browser.referenceFrame,l=h.chr,c=h.start,u=c+h.toBP(this.canvas.width),this.tile&&this.tile.containsRange(l,c,u,h.bpPerPixel))this.paintImage();else{if(r=3*this.canvas.width,n=Math.round(h.toBP(r)),a=Math.max(0,Math.round(h.start-n/3)),o=a+n,d.loading&&d.loading.start===a&&d.loading.end===o)return;d.loading={start:a,end:o},t.startSpinnerAtParentElement(d.trackDiv),this.track.getFeatures(h.chr,a,o).then(function(e){if(d.loading=!1,t.stopSpinnerAtParentElement(d.trackDiv),e){if("function"==typeof d.track.computePixelHeight){var n=d.track.computePixelHeight(e);n!=d.contentDiv.clientHeight&&d.setContentHeight(n)}var l=document.createElement("canvas");if(l.width=r,l.height=d.canvas.height,s=l.getContext("2d"),d.track.draw({features:e,context:s,bpStart:a,bpPerPixel:h.bpPerPixel,pixelWidth:l.width,pixelHeight:l.height}),d.track.paintAxis&&d.controlCanvas.width>0&&d.controlCanvas.height>0){var c=document.createElement("canvas");c.width=d.controlCanvas.width,c.height=d.controlCanvas.height;var u=c.getContext("2d");d.track.paintAxis(u,c.width,c.height),d.controlCtx.drawImage(c,0,0)}d.tile=new i(h.chr,a,o,h.bpPerPixel,l),d.paintImage()}else d.ctx.clearRect(0,0,d.canvas.width,d.canvas.height)}).catch(function(e){d.loading=!1,e instanceof t.AbortLoad?console.log("Aborted ---"):(t.stopSpinnerAtParentElement(d.trackDiv),console.log(e),t.presentAlert(e))})}}},i.prototype.containsRange=function(t,e,i,r){return this.scale===r&&e>=this.startBP&&i<=this.endBP&&t===this.chr},i.prototype.overlapsRange=function(t,e,i){return this.chr===t&&this.endBP>=e&&this.startBP<=i},t.TrackView.prototype.paintImage=function(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.tile&&(this.xOffset=Math.round(this.browser.referenceFrame.toPixels(this.tile.startBP-this.browser.referenceFrame.start)),this.ctx.drawImage(this.tile.image,this.xOffset,0),this.ctx.save(),this.ctx.restore())},TrackScrollbar=function(t,e){function i(t){n(t.pageY-a),t.stopPropagation()}function r(t){$(window).off("mousemove .igv",null,i),$(window).off("mouseup .igv",null,r)}function n(i){var r=$(o).height(),n=$(s).height();newTop=Math.min(Math.max(0,i),r-n),contentTop=-Math.round(newTop*($(e).height()/$(t).height())),$(s).css("top",newTop+"px"),$(e).css("top",contentTop+"px")}var a,o=$('<div class="igv-scrollbar-outer-div">')[0],s=$('<div class="igv-scrollbar-inner-div">')[0];$(o).append(s),this.viewportDiv=t,this.contentDiv=e,this.outerScrollDiv=o,this.innerScrollDiv=s,$(this.innerScrollDiv).mousedown(function(t){a=t.pageY-$(s).position().top,$(window).on("mousemove .igv",null,null,i),$(window).on("mouseup .igv",null,null,r),t.stopPropagation()}),$(this.innerScrollDiv).click(function(t){t.stopPropagation()}),$(this.outerScrollDiv).click(function(t){n(t.offsetY-$(s).height()/2),t.stopPropagation()})},TrackScrollbar.prototype.update=function(){var t=$(this.viewportDiv).height(),e=$(this.contentDiv).height(),i=Math.round(t/e*t);e>t?($(this.outerScrollDiv).show(),$(this.innerScrollDiv).height(i)):$(this.outerScrollDiv).hide()},t.TrackView.prototype.redrawTile=function(t){if(this.tile){var e=this,r=e.tile.chr,n=e.tile.startBP,a=e.tile.endBP,o=document.createElement("canvas"),s=e.tile.scale;o.width=e.tile.image.width,o.height=e.tile.image.height;var h=o.getContext("2d");e.track.draw({features:t,context:h,bpStart:n,bpPerPixel:s,pixelWidth:o.width,pixelHeight:o.height}),e.tile=new i(r,n,a,s,o),e.paintImage()}},t}(igv||{}),igv=function(t){return t.AlertDialog=function(e,i){var r,n,a=this;this.$container=$("<div>",{id:i,class:"igv-grid-container-alert-dialog"}),e.append(this.$container),r=$('<div class="igv-grid-header">'),n=$('<div class="igv-grid-header-blurb">'),r.append(n),t.attachDialogCloseHandlerWithParent(r,function(){a.hide()}),this.$container.append(r),this.$container.append(this.alertTextContainer()),this.$container.append(this.rowOfOk())},t.AlertDialog.prototype.alertTextContainer=function(){var t;return t=$('<div class="igv-grid-rect">'),this.$dialogLabel=$("<div>",{class:"igv-col igv-col-4-4 igv-alert-dialog-text"}),t.append(this.$dialogLabel),t},t.AlertDialog.prototype.rowOfOk=function(){var t,e,i=this;return t=$('<div class="igv-grid-rect">'),e=$('<div class="igv-col igv-col-1-4">'),t.append(e),e=$('<div class="igv-col igv-col-2-4">'),this.$ok=$('<div class="igv-col-filler-ok-button">'),this.$ok.text("OK"),this.$ok.unbind(),this.$ok.click(function(){i.hide()}),e.append(this.$ok),t.append(e),t},t.AlertDialog.prototype.hide=function(){this.$container.hasClass("igv-grid-container-dialog")&&this.$container.offset({left:0,top:0}),this.$container.hide()},t.AlertDialog.prototype.show=function(t){var e,i,r,n;e=$("body").scrollTop(),this.$container.hasClass("igv-grid-container-dialog")&&(i=t.offset(),r=i.top+e,n=t.outerWidth()-300,this.$container.offset({left:n,top:r})),this.$container.show()},t}(igv||{}),igv=function(t){return t.CenterGuide=function(t,e){var i,r=this;this.$container=$('<div class="igv-center-guide igv-center-guide-thin">'),t.append(this.$container),this.$container.css("display",e.showCenterGuide&&1==e.showCenterGuide?"block":"none"),i=this.$container.css("display"),this.$centerGuideToggle=$('<div class="igv-toggle-track-labels">'),this.$centerGuideToggle.text("none"===i?"show center guide":"hide center guide"),this.$centerGuideToggle.click(function(){i=r.$container.css("display"),"none"===i?(r.$container.css("display","block"),r.$centerGuideToggle.text("hide center guide")):(r.$container.css("display","none"),r.$centerGuideToggle.text("show center guide"))}),void 0!==e.showCenterGuide&&0!=e.showCenterGuide||this.$centerGuideToggle.css("display","none")},t.CenterGuide.prototype.repaint=function(){var e,i,r,n,a=Math.floor(1/t.browser.referenceFrame.bpPerPixel),o=this.$container.position.x;n=o+this.$container.outerWidth()/2,a>1?(e=n-a/2,i=e.toString()+"px",r=a.toString()+"px",this.$container.css({left:i,width:r}),this.$container.removeClass("igv-center-guide-thin"),this.$container.addClass("igv-center-guide-wide")):(i="50%",r="1px",this.$container.css({left:i,width:r}),this.$container.removeClass("igv-center-guide-wide"),this.$container.addClass("igv-center-guide-thin"))},t}(igv||{}),igv=function(t){var e=8;return t.ColorPicker=function(i,r,n){function a(){function i(e){var i,r;return i=d.rgb_re.exec(e),null!==i?"rgb("+i[0]+")":(r=d.hex_re.exec(e),null!==r?t.hex2Color(r[0]):void 0)}function r(t){void 0===d.userColorsIndex?(d.userColorsIndex=0,d.userColorsRowIndex=0):e===d.userColorsRowIndex&&(d.userColorsRowIndex=0,d.userColorsIndex=(1+d.userColorsIndex)%d.userColors.length),n(t,d.userColorsIndex,d.userColorsRowIndex),++d.userColorsRowIndex}function n(e,i,r){var n,a;n=d.userColors[i],n.removeClass("igv-grid-rect-hidden"),n.addClass("igv-grid-rect"),a=n.find(".igv-grid-colorpicker").find(".igv-col").find("div").eq(r),a.removeClass("igv-col-filler-no-color"),a.removeClass("igv-grid-rect-hidden"),a.addClass("igv-col-filler"),a.css("background-color",e),a.click(function(){t.setTrackColor(d.trackView.track,$(this).css("background-color")),d.trackView.update()})}var a,o,s,l,u;for(d.userColors=[],u=0;u<5;u++)o=h(u),d.userColors.push(o),d.$container.append(o[0]),o.find(".igv-col-filler-no-color").addClass("igv-grid-rect-hidden");return d.userColorsIndex=void 0,d.userColorsRowIndex=0,o=$('<div class="igv-grid-colorpicker">'),s=$('<div class="igv-col igv-col-7-8">'),l=$('<input class="igv-user-input-colorpicker" type="text" placeholder="Ex: #ff0000 or 255,0,0">'),l.change(function(){var e=i($(this).val());e?(t.setTrackColor(d.trackView.track,e),d.trackView.update(),r(e),$(this).val(""),$(this).attr("placeholder","Ex: #ff0000 or 255,0,0"),d.$userColorFeeback.css("background-color","white"),d.$userColorFeeback.hide()):d.$userError.show()}),l.mousedown(function(){$(this).attr("placeholder","")}),l.keyup(function(){var t;""===$(this).val()&&(d.$userError.hide(),$(this).attr("placeholder","Ex: #ff0000 or 255,0,0")),t=i($(this).val()),void 0!==t?(d.$userColorFeeback.css("background-color",t),d.$userColorFeeback.show()):(d.$userColorFeeback.css("background-color","white"),d.$userColorFeeback.hide())}),s.append(l),o.append(s),s=c(null),d.$userColorFeeback=s.find("div").first(),o.append(s),d.$userColorFeeback.hide(),a=$('<div class="igv-grid-rect">'),a.append(o),d.$userError=$("<span>"),d.$userError.text("ERROR.    Ex: #ff0000 or 255,0,0"),d.$userError.hide(),o=$('<div class="igv-grid-colorpicker-user-error">'),o.append(d.$userError),a.append(o),a}function o(){var e,i,r;return i=$('<div class="igv-grid-colorpicker">'),d.$defaultColor=$('<div class="igv-col-filler">'),d.$defaultColor.css("background-color","#eee"),r=$('<div class="igv-col igv-col-1-8">'),r.append(d.$defaultColor),r.click(function(){t.setTrackColor(d.trackView.track,$(this).find(".igv-col-filler").css("background-color")),d.trackView.update()}),i.append(r),r=$('<div class="igv-col igv-col-7-8 igv-col-label">'),r.text("Default Color"),i.append(r),e=$('<div class="igv-grid-rect">'),e.append(i),e}function s(){var e,i,r;return i=$('<div class="igv-grid-colorpicker">'),d.$previousColor=$('<div class="igv-col-filler">'),d.$previousColor.css("background-color","#eee"),r=$('<div class="igv-col igv-col-1-8">'),r.append(d.$previousColor),r.click(function(){t.setTrackColor(d.trackView.track,$(this).find(".igv-col-filler").css("background-color")),d.trackView.update()}),i.append(r),r=$('<div class="igv-col igv-col-7-8 igv-col-label">'),r.text("Previous Color"),i.append(r),e=$('<div class="igv-grid-rect">'),e.append(i),e}function h(t){var i,r=$('<div class="igv-grid-rect-hidden">'),n=$('<div class="igv-grid-colorpicker">');for(i=0;i<e;i++)n.append(c(null));return r.append(n),r}function l(t){var i,r=$('<div class="igv-grid-rect">'),n=$('<div class="igv-grid-colorpicker">');for(i=0;i<Math.min(e,t.length);i++)n.append(c(t[i]));return r.append(n),r}function c(e){var i=$('<div class="igv-col igv-col-1-8">'),r=$("<div>");return i.append(r),null!==e?(r.addClass("igv-col-filler"),r.css("background-color",e),r.click(function(){t.setTrackColor(d.trackView.track,$(this).css("background-color")),d.trackView.update()})):(r.addClass("igv-col-filler-no-color"),r.css("background-color","white")),i}var u,d=this,p=r||["#666666","#0000cc","#009900","#cc0000","#ffcc00","#9900cc","#00ccff","#ff6600","#ff6600"],f=Math.ceil(p.length/e);for(this.rgb_re=/^\s*(0|[1-9]\d?|1\d\d?|2[0-4]\d|25[0-5])\s*,\s*(0|[1-9]\d?|1\d\d?|2[0-4]\d|25[0-5])\s*,\s*(0|[1-9]\d?|1\d\d?|2[0-4]\d|25[0-5])\s*$/,this.hex_re=new RegExp("^#([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$"),this.$container=$('<div class="igv-grid-container-colorpicker">'),n&&this.$container.attr("id",n),i.append(this.$container),this.$container.draggable(),this.$header=$('<div class="igv-grid-header">'),this.$headerBlurb=$('<div class="igv-grid-header-blurb">'),this.$header.append(this.$headerBlurb),t.attachDialogCloseHandlerWithParent(this.$header,function(){d.hide()}),this.$container.append(this.$header),u=0;u<f;u++)d.$container.append(l(p.slice(u*e)));d.$container.append($('<hr class="igv-grid-dividing-line">')),d.$container.append(a()),d.$container.append(s()),d.$container.append(o())},t.ColorPicker.prototype.configure=function(e){this.trackView=e,this.$defaultColor.css("background-color",e.track.config.color||t.browser.constants.defaultColor),this.$previousColor.css("background-color",e.track.color)},t.ColorPicker.prototype.hide=function(){$(this.$container).offset({left:0,top:0}),this.$container.hide()},t.ColorPicker.prototype.show=function(){var e,i=$("body").scrollTop(),r=$(this.trackView.trackDiv).offset(),n={width:$(this.trackView.trackDiv).outerWidth(),height:$(this.trackView.trackDiv).outerHeight()};({width:$(this.$container).outerWidth(),height:$(this.$container).outerHeight()});$(this.$container).offset({left:n.width-300,top:r.top+i}),e=$(".igv-user-input-color"),e.val(""),e.attr("placeholder","Ex: #ff0000 or 255,0,0"),this.$container.show(),this.$userError.hide(),$(this.$container).offset(t.constrainBBox($(this.$container),$(t.browser.trackContainerDiv)))},t}(igv||{}),igv=function(t){return t.DataRangeDialog=function(e,i){function r(){var t,e,i,r;return e=$('<div class="igv-grid-dialog">'),i=$('<div class="igv-col igv-col-1-8">'),e.append(i[0]),i=$('<div class="igv-col igv-col-3-8">'),a.ok=$('<div class="igv-col-filler-ok-button">'),a.ok.text("OK"),i.append(a.ok[0]),e.append(i[0]),i=$('<div class="igv-col igv-col-3-8">'),r=$('<div class="igv-col-filler-cancel-button">'),r.text("Cancel"),r.click(function(){a.hide()}),i.append(r[0]),e.append(i[0]),i=$('<div class="igv-col igv-col-1-8">'),e.append(i[0]),t=$('<div class="igv-grid-rect">'),t.append(e[0]),t}function n(){var t,e,i=$('<div class="igv-grid-rect">');return t=$('<div class="igv-grid-dialog">'),e=$('<div class="spacer10">'),t.append(e[0]),e=$('<div class="igv-col igv-col-3-8">'),a.minLabel=$('<div class="igv-data-range-input-label">'),a.minLabel.text("Minimum"),e.append(a.minLabel[0]),t.append(e[0]),e=$('<div class="igv-col igv-col-3-8">'),a.minInput=$('<input class="igv-data-range-input" type="text" value="125">'),e.append(a.minInput[0]),t.append(e[0]),i.append(t[0]),t=$('<div class="igv-grid-dialog">'),e=$('<div class="igv-col igv-col-3-8">'),a.maxLabel=$('<div class="igv-data-range-input-label">'),a.maxLabel.text("Maximum"),e.append(a.maxLabel[0]),t.append(e[0]),e=$('<div class="igv-col igv-col-3-8">'),a.maxInput=$('<input class="igv-data-range-input" type="text" value="250">'),e.append(a.maxInput[0]),t.append(e[0]),i.append(t[0]),i}var a=this;this.container=$('<div class="igv-grid-container-dialog">'),i&&this.container.attr("id",i),e.append(this.container[0]),this.container.draggable(),this.header=$('<div class="igv-grid-header">'),this.headerBlurb=$('<div class="igv-grid-header-blurb">'),this.header.append(this.headerBlurb[0]),t.attachDialogCloseHandlerWithParent(this.header,function(){a.hide()}),this.container.append(this.header[0]),a.container.append(n()[0]),a.container.append(r()[0])},t.DataRangeDialog.prototype.configureWithTrackView=function(e){var i,r,n=this;this.trackView=e,e.track.dataRange?(i=e.track.dataRange.min,r=e.track.dataRange.max):(i=0,r=100),this.minInput.val(i),this.maxInput.val(r),this.ok.unbind(),this.ok.click(function(){i=parseFloat(n.minInput.val()),r=parseFloat(n.maxInput.val()),isNaN(i)||isNaN(r)?t.presentAlert("Must input numeric values"):(e.track.dataRange.min=i,e.track.dataRange.max=r,e.track.autoScale=!1,n.hide(),e.update())})},t.DataRangeDialog.prototype.hide=function(){this.container.offset({left:0,top:0}),this.container.hide()},t.DataRangeDialog.prototype.show=function(){var e=$("body").scrollTop(),i=($(this.trackView.trackDiv).scrollTop(),$(this.trackView.trackDiv).offset()),r={width:$(this.trackView.trackDiv).outerWidth(),height:$(this.trackView.trackDiv).outerHeight()};({width:this.container.outerWidth(),height:this.container.outerHeight()});this.container.show(),this.container.offset({left:r.width-300,top:i.top+e}),this.container.offset(t.constrainBBox(this.container,$(t.browser.trackContainerDiv)))},t}(igv||{}),igv=function(t){return t.Dialog=function(e,i,r){var n,a,o=this;this.$container=$('<div class="igv-grid-container-dialog">'),r&&this.$container.attr("id",r),e.append(this.$container[0]),n=$('<div class="igv-grid-header">'),a=$('<div class="igv-grid-header-blurb">'),n.append(a[0]),this.$container.append(n[0]),i(this),t.attachDialogCloseHandlerWithParent(n,function(){o.hide()})},t.Dialog.dialogConstructor=function(t){t.$container.append(t.rowOfLabel()[0]),t.$container.append(t.rowOfInput()[0]),t.$container.append(t.rowOfOkCancel()[0]),t.$container.draggable()},t.Dialog.prototype.rowOfOk=function(){var t,e,i,r;return e=$('<div class="igv-grid-dialog">'),i=$('<div class="igv-col igv-col-1-4">'),e.append(i[0]),i=$('<div class="igv-col igv-col-2-4">'),r=$('<div class="igv-col-filler-ok-button">'),r.text("OK"),this.$ok=r,i.append(r[0]),e.append(i[0]),t=$('<div class="igv-grid-rect">'),t.append(e[0]),t},t.Dialog.prototype.rowOfOkCancel=function(){var t,e,i,r,n=this;return e=$('<div class="igv-grid-dialog">'),i=$('<div class="igv-col igv-col-1-8">'),e.append(i[0]),i=$('<div class="igv-col igv-col-3-8">'),r=$('<div class="igv-col-filler-ok-button">'),r.text("OK"),this.$ok=r,i.append(r[0]),e.append(i[0]),i=$('<div class="igv-col igv-col-3-8">'),r=$('<div class="igv-col-filler-cancel-button">'),r.text("Cancel"),r.click(function(){n.$dialogInput.val(void 0),n.hide()}),i.append(r[0]),e.append(i[0]),i=$('<div class="igv-col igv-col-1-8">'),e.append(i[0]),t=$('<div class="igv-grid-rect">'),t.append(e[0]),t},t.Dialog.prototype.rowOfLabel=function(){var t,e,i;return e=$('<div class="igv-grid-dialog">'),i=$('<div class="igv-col igv-col-4-4">'),this.$dialogLabel=$('<div class="igv-user-input-label">'),i.append(this.$dialogLabel[0]),e.append(i[0]),t=$('<div class="igv-grid-rect">'),t.append(e[0]),t},t.Dialog.prototype.rowOfInput=function(){var t,e,i;return e=$('<div class="igv-grid-dialog">'),i=$('<div class="igv-col igv-col-4-4">'),this.$dialogInput=$('<input class="igv-user-input-dialog" type="text" value="#000000">'),i.append(this.$dialogInput[0]),e.append(i[0]),t=$('<div class="igv-grid-rect">'),t.append(e[0]),t},t.Dialog.prototype.configure=function(t,e,i){var r=this;t?(r.$dialogLabel.html(t()),r.$dialogLabel.show()):r.$dialogLabel.hide(),void 0!==e?(r.$dialogInput.val(e),r.$dialogInput.unbind(),r.$dialogInput.change(function(){i&&i(),r.hide()}),r.$dialogInput.show()):r.$dialogInput.hide(),r.$ok.unbind(),r.$ok.click(function(){i&&i(),r.hide()})},t.Dialog.prototype.hide=function(){this.$container.hasClass("igv-grid-container-dialog")&&this.$container.offset({left:0,top:0}),this.$container.hide()},t.Dialog.prototype.show=function(t){var e,i,r,n;e=$("body").scrollTop(),this.$container.hasClass("igv-grid-container-dialog")&&(i=t.offset(),r=i.top+e,n=t.outerWidth()-300,this.$container.offset({left:n,top:r})),this.$container.show()},t}(igv||{}),igv=function(t){function e(t,e,i){var r,n,a={x:t,y:e},o={x:0,y:0,width:$(window).width(),height:$(window).height()},s=t,h=e;return s-=i.$parent.offset().left,h-=i.$parent.offset().top,n={x:s,y:h,width:i.popover.outerWidth(),height:i.popover.outerHeight()},r=s,a.x+n.width>o.width&&(r=s-n.width),{left:r+"px",top:h+"px"}}return t.Popover=function(t,e){this.markupWith$Parent(t,e),this.$popoverContent.kinetic({})},t.Popover.prototype.markupWith$Parent=function(e,i){var r,n=this;this.$parent||(this.$parent=e,this.popover=$('<div class="igv-popover">'),i&&this.popover.attr("id",i),this.$parent.append(this.popover[0]),r=$('<div class="igv-popoverHeader">'),this.popover.append(r[0]),t.attachDialogCloseHandlerWithParent(r,function(){n.hide()}),this.$popoverContent=$("<div>"),this.popover.append(this.$popoverContent[0]),this.popover.draggable())},t.Popover.prototype.testData=function(t){var e,i,r=[];for(e=0;e<t;e++)i="name "+e,r.push({name:i,value:"verbsgohuman"});return r},t.Popover.prototype.hide=function(){this.popover.hide()},t.Popover.prototype.presentTrackMenu=function(i,r,n){var a=$('<div class="igv-track-menu-container">'),o=t.trackMenuItems(this,n);o.forEach(function(t){a.append(t.object||t)}),this.$popoverContent.empty(),this.$popoverContent.removeClass("igv-popoverTrackPopupContent"),this.$popoverContent.append(a),o.forEach(function(t){t.object&&t.click&&t.object.click(t.click),t.init&&t.init()}),this.popover.css(e(i,r,this)),this.popover.show(),this.popover.offset(t.constrainBBox(this.popover,$(t.browser.trackContainerDiv)))},t.Popover.prototype.presentTrackPopup=function(t,i,r,n){var a,o,s=this;r&&(o=r,!0===n&&(a='<button name="button" class="igv-popover-ok-button">OK</button>',o=r+a),this.$popoverContent.addClass("igv-popoverTrackPopupContent"),this.$popoverContent.html(o),this.popover.css(e(t,i,this)).show(),!0===n?($(".igv-dialog-close-container").hide(),$(".igv-popover-ok-button").click(function(){s.hide()})):$(".igv-dialog-close-container").show())},t}(igv||{}),igv=function(t){return t.TrackMenuPopupDialog=function(t,e,i,r,n,a){var o,s,h,l=this;h='<div id="dialog-form" title="DIALOG_LABEL"><p class="validateTips"></p><form><fieldset><input type="text" name="name" id="name" value="INPUT_VALUE"></fieldset></form></div>',o=new RegExp("DIALOG_LABEL","g"),h=h.replace(o,e),s=new RegExp("INPUT_VALUE","g"),h=h.replace(s,i),$("body").append($.parseHTML(h)),this.dialogForm=$("#dialog-form"),this.form=this.dialogForm.find("form"),this.name=$("#name"),this.tips=$(".validateTips"),this.dialogForm.dialog({autoOpen:!1,width:n||320,height:a||256,modal:!0,buttons:{ok:r,cancel:function(){l.dialogForm.dialog("close")}},close:function(){l.form[0].reset(),l.dialogForm.remove(),l.dialogForm=void 0,t&&t.hide()}}),this.form.on("submit",function(t){t.preventDefault(),$("#users").find(" tbody").append("<tr><td>"+l.name.val()+"</td></tr>"),l.dialogForm.dialog("close")})},t.TrackMenuPopupDialog.prototype.updateTips=function(t){var e=this;this.tips.text(t).addClass("ui-state-highlight"),setTimeout(function(){e.tips.removeClass("ui-state-highlight",1500)},500)},t}(igv||{}),igv=function(t){return t.UserFeedback=function(t){var e=this;this.userFeedback=$('<div class="igvUserFeedback">'),t.append(this.userFeedback[0]),this.userFeedbackHeader=$('<div class="igvUserFeedbackHeader">'),this.userFeedback.append(this.userFeedbackHeader[0]),this.userFeedbackAlert=$('<i class="fa fa-exclamation-triangle fa-20px igvUserFeedbackAlert">'),this.userFeedbackHeader.append(this.userFeedbackAlert[0]),this.userFeedbackDismiss=$('<i class="fa fa-times-circle fa-20px igvUserFeedbackDismiss">'),this.userFeedbackHeader.append(this.userFeedbackDismiss[0]),this.userFeedbackDismiss.click(function(){e.userFeedbackBodyCopy.html(""),e.userFeedback.hide()}),this.userFeedbackBodyCopy=$('<div class="igvUserFeedbackBodyCopy">'),this.userFeedback.append(this.userFeedbackBodyCopy[0])},t.UserFeedback.prototype.show=function(){this.userFeedback.show()},t.UserFeedback.prototype.hide=function(){this.userFeedback.hide()},t.UserFeedback.prototype.bodyCopy=function(t){this.userFeedbackBodyCopy.html(t)},t}(igv||{}),igv=function(t){function e(t){altTokens=t.alternateBases.split(","),altTokens.length>0?(t.alleles=[],t.alleles.push(t.referenceBases),t.start=Number.MAX_VALUE,t.end=0,altTokens.forEach(function(e){var i,r,n;t.alleles.push(e),e.length>0&&(n=t.referenceBases.length-e.length,n>0?(i=t.pos+e.length,r=i+n):n<0?(i=t.pos+t.referenceBases.length,r=i+1):(i=t.pos,r=i+e.length),t.start=Math.min(t.start,i),t.end=Math.max(t.end,r))})):(t.start=t.pos-1,t.end=t.pos)}function i(t){if(t){var e,i="";for(t.length>0&&(i=t[0]),e=1;e<t.length;e++)i+=", "+t[1];return i}}return t.createVCFVariant=function(i){var r=new t.Variant;return r.chr=i[0],r.pos=parseInt(i[1])-1,r.names=i[2],r.referenceBases=i[3],r.alternateBases=i[4],r.quality=parseInt(i[5]),r.filter=i[6],r.info=i[7],e(r),r},t.createGAVariant=function(r){var n=new t.Variant;n.chr=r.referenceName,n.pos=parseInt(r.start),n.names=i(r.names),n.referenceBases=r.referenceBases+"",n.alternateBases=r.alternateBases+"",n.quality=r.quality,n.filter=i(r.filter),n.info=r.info,n.calls={};var a,o=0;return r.calls&&r.calls.forEach(function(t){a=t.callSetId,n.calls[a]=t,o++}),e(n),n},t.Variant=function(){},t.Variant.prototype.popupData=function(t){var e,r,n=this;return e=[{name:"Chr",value:this.chr},{name:"Pos",value:this.pos+1},{name:"Names",value:this.names?this.names:""},{name:"Ref",value:this.referenceBases},{name:"Alt",value:this.alternateBases},{name:"Qual",value:this.quality},{name:"Filter",value:this.filter}],this.calls&&1===this.calls.length&&(r=this.alleles[this.calls[0].genotype[0]]+this.alleles[this.calls[0].genotype[1]],e.push({name:"Genotype",value:r})),this.info&&(e.push("<HR>"),Object.keys(this.info).forEach(function(t){e.push({name:t,value:i(n.info[t])})})),e},t}(igv||{}),igv=function(t){function e(){this.callSets?this.callSets.length<10?this.visibilityWindow=n:this.visibilityWindow=1e3+2500/this.callSets.length*40:this.visibilityWindow=n,this.featureSource.visibilityWindow=this.visibilityWindow}function i(t,e){var i,r="";return t.genotype.forEach(function(t){r+=0===t?e.referenceBases:e.alternateBases[t-1]}),i=[],void 0!==t.callSetName&&i.push({name:"Name",value:t.callSetName}),i.push({name:"Genotype",value:r}),void 0!==t.phaseset&&i.push({name:"Phase set",value:t.phaseset}),void 0!==t.genotypeLikelihood&&i.push({name:"genotypeLikelihood",value:t.genotypeLikelihood.toString()}),Object.keys(t.info).forEach(function(e){i.push({name:e,value:t.info[e]})}),i}var r=2,n=1e5;return t.VariantTrack=function(e){this.visibilityWindow=void 0===e.visibilityWindow?"compute":e.visibilityWindow,t.configTrack(this,e),this.displayMode=e.displayMode||"EXPANDED",this.labelDisplayMode=e.labelDisplayMode,this.variantHeight=e.variantHeight||10,this.squishedCallHeight=e.squishedCallHeight||1,this.expandedCallHeight=e.expandedCallHeight||10,this.featureHeight=e.featureHeight||14,this.featureSource=new t.FeatureSource(e),this.homrefColor=e.homrefColor||"rgb(200, 200, 200)",this.homvarColor=e.homvarColor||"rgb(17,248,254)",this.hetvarColor=e.hetvarColor||"rgb(34,12,253)",this.nRows=1},t.VariantTrack.prototype.getFileHeader=function(){var t=this;return new Promise(function(i,r){"function"==typeof t.featureSource.getFileHeader?t.featureSource.getFileHeader().then(function(r){r&&(r.name&&!t.config.name&&(t.name=r.name),r.color&&!t.config.color&&(t.color="rgb("+r.color+")"),t.callSets=r.callSets,"compute"===t.visibilityWindow&&e.call(t)),i(r)}).catch(r):i(null)})},t.VariantTrack.prototype.getFeatures=function(t,e,i){var r=this;return new Promise(function(n,a){r.featureSource.getFeatures(t,e,i).then(function(t){n(t)}).catch(a)})},t.VariantTrack.prototype.computePixelHeight=function(t){var e,i,n=this.callSets,a=n?n.length:0;if("COLLAPSED"===this.displayMode)return this.nRows=1,10+this.variantHeight;var o=0;return t&&"function"==typeof t.forEach&&t.forEach(function(t){t.row&&t.row>o&&(o=t.row)}),e=o+1,i=10+e*(this.variantHeight+r),this.nRows=e,a*e*this.expandedCallHeight>2e3&&(this.expandedCallHeight=Math.max(1,2e3/(a*e))),i+r+a*e*("EXPANDED"===this.displayMode?this.expandedCallHeight:this.squishedCallHeight)},t.VariantTrack.prototype.draw=function(e){var i,n,a,o,s,h,l,c,u,d,p,f,g,v=e.features,m=e.context,b=e.bpPerPixel,y=e.bpStart,w=e.pixelWidth,k=e.pixelHeight,x=y+w*b+1,S="EXPANDED"===this.displayMode?this.expandedCallHeight:this.squishedCallHeight;if(this.variantBandHeight=10+this.nRows*(this.variantHeight+r),g=this.callSets,t.graphics.fillRect(m,0,0,w,k,{fillStyle:"rgb(255, 255, 255)"}),g&&g.length>0&&"COLLAPSED"!==this.displayMode&&t.graphics.strokeLine(m,0,this.variantBandHeight,w,this.variantBandHeight,{strokeStyle:"rgb(224,224,224) "}),v){for(h=0,len=v.length;h<len;h++)if(l=v[h],!(l.end<y)){if(l.start>x)break;if(o=10+("COLLAPSED"===this.displayMode?0:l.row*(this.variantHeight+r)),s=this.variantHeight,i=Math.round((l.start-y)/b),n=Math.round((l.end-y)/b),a=Math.max(1,n-i),a<3?(a=3,i-=1):a>5&&(i+=1,a-=2),m.fillStyle=this.color,m.fillRect(i,o,a,s),g&&l.calls&&"COLLAPSED"!==this.displayMode)for(s=S,d=0;d<g.length;d++)u=g[d],c=l.calls[u.id],c&&(f=p=!0,c.genotype.forEach(function(t){0!=t&&(p=!1),0==t&&(f=!1)}),p?m.fillStyle=this.homrefColor:f?m.fillStyle=this.homvarColor:m.fillStyle=this.hetvarColor,o=this.variantBandHeight+r+(d+l.row)*S,m.fillRect(i,o,a,s))}}else console.log("No feature list")},t.VariantTrack.prototype.popupData=function(e,n,a){if(this.featureSource.featureCache){var o=t.browser.referenceFrame.chr,s=Math.floor(2*t.browser.referenceFrame.bpPerPixel),h=this.featureSource.featureCache.queryFeatures(o,e-s,e+s),l=[],c=this;
return h&&h.length>0&&h.forEach(function(t){var n,o,h,u,d;t.start<=e+s&&t.end>e-s&&(l.length>0&&l.push("<HR>"),"COLLAPSED"==c.displayMode?Array.prototype.push.apply(l,t.popupData(e)):a<=c.variantBandHeight?(n=Math.floor((a-10)/(c.variantHeight+r)),t.row===n&&Array.prototype.push.apply(l,t.popupData(e))):(h=c.callSets,h&&t.calls&&(o=c.nRows*("SQUISHED"===c.displayMode?c.squishedCallHeight:c.expandedCallHeight),n=Math.floor((a-c.variantBandHeight-r)/o),u=h[n],d=t.calls[u.id],Array.prototype.push.apply(l,i(d,t)))))}),l}},t.VariantTrack.prototype.popupMenuItems=function(e){var i=this,r=[],n={COLLAPSED:"Collapse",SQUISHED:"Squish",EXPANDED:"Expand"},a='<i class="fa fa-check fa-check-shim"></i>',o='<i class="fa fa-check fa-check-shim fa-check-hidden"></i>',s='<div class="igv-track-menu-item">',h='<div class="igv-track-menu-item igv-track-menu-border-top">';return r.push(t.colorPickerMenuItem(e,this.trackView)),["COLLAPSED","SQUISHED","EXPANDED"].forEach(function(t,l){var c,u;c=0===l?h:s,u=t===i.displayMode?c+a+n[t]+"</div>":c+o+n[t]+"</div>",r.push({object:$(u),click:function(){e.hide(),i.displayMode=t,i.trackView.update()}})}),r},t}(igv||{}),igv=function(t){function e(t){var e,i={genotypeIndex:-1,genotypeLikelihoodIndex:-1,phasesetIndex:-1,fields:t};for(e=0;e<t.length;e++)"GT"===t[e]?i.genotypeIndex=e:"GL"===t[e]?i.genotypeLikelihoodIndex=e:"PS"===t[e]&&(i.phasesetIndex=e);return i}function i(t){var e,i=this;this.chr=t[0],this.pos=parseInt(t[1]),this.names=t[2],this.referenceBases=t[3],this.alternateBases=t[4],this.quality=parseInt(t[5]),this.filter=t[6],this.info=t[7],e=this.alternateBases.split(","),e.length>0?(this.alleles=[],this.start=Number.MAX_VALUE,this.end=0,e.forEach(function(t){var e,r,n;t.length>0&&(n=i.referenceBases.length-t.length,n>0?(e=i.pos-1+t.length,r=e+n):n<0?(e=i.pos-1+i.referenceBases.length,r=e+1):(e=i.pos-1,r=e+t.length),i.alleles.push({allele:t,start:e,end:r}),i.start=Math.min(i.start,e),i.end=Math.max(i.end,r))})):(this.start=this.pos-1,this.end=this.pos)}return t.VcfParser=function(){},t.VcfParser.prototype.parseHeader=function(e){var i,r,n,a,o,s,h,l,c,u=e.splitLines(),d=u.length,p={};if(!u[0].startsWith("##fileformat"))throw new Error("Invalid VCF file: missing fileformat line");for(p.version=u[0].substr(13),r=1;r<d&&(i=u[r].trim(),i.startsWith("#"));r++)if(o=null,s={},i.startsWith("##")){if(i.startsWith("##INFO")||i.startsWith("##FILTER")||i.startsWith("##FORMAT")){if(h=i.indexOf("<"),l=i.lastIndexOf(">"),!(h>2&&l>0)){console.log("Malformed VCF header line: "+i);continue}c=i.substring(2,h-1),p[c]||(p[c]={}),a=t.splitStringRespectingQuotes(i.substring(h+1,l-1),","),a.forEach(function(t){var e=t.split("=");e.length>1&&("ID"===e[0]?o=e[1]:s[e[0]]=e[1])}),o&&(p[c][o]=s)}}else if(i.startsWith("#CHROM")&&(a=i.split("\t"),a.length>8))for(p.callSets=[],n=9;n<a.length;n++)p.callSets.push({id:n,name:a[n]});return this.header=p,p},t.VcfParser.prototype.parseFeatures=function(t){var r=t.split("\n"),n=[],a=this.header.callSets;return r.forEach(function(t){var r,o,s,h,l;if(!t.startsWith("#")&&(o=t.split("\t"),o.length>=8&&(r=new i(o),r.header=this.header,n.push(r),o.length>9)))for(s=e(o[8].split(":")),r.calls={},h=9;h<o.length;h++){l=o[h];var c=a[h-9],u={callSetName:c.name,info:{}};r.calls[c.id]=u,l.split(":").forEach(function(t,e){switch(e){case s.genotypeIndex:u.genotype=[],t.split(/[\|\/]/).forEach(function(t){u.genotype.push(parseInt(t))});break;case s.genotypeLikelihoodIndex:u.genotypeLikelihood=[],t.split(",").forEach(function(t){u.genotype.push(parseFloat(t))});break;case s.phasesetIndex:u.phaseset=t;break;default:u.info[s.fields[e]]=t}})}}),n},i.prototype.popupData=function(t){var e,i;return e=[{name:"Names",value:this.names},{name:"Ref",value:this.referenceBases},{name:"Alt",value:this.alternateBases},{name:"Qual",value:this.quality},{name:"Filter",value:this.filter},"<hr>"],i=this.info.split(";"),i.forEach(function(t){var i=t.split("=");i.length>1&&e.push({name:i[0],value:i[1]})}),e},t}(igv||{}),igv=function(t){return t.WindowSizePanel=function(t){this.contentDiv=$('<div class="igv-windowsizepanel-content-div"></div>'),t.append(this.contentDiv[0])},t.WindowSizePanel.prototype.update=function(e){function i(e){return e>1e7?(a=1e6,o=" mb",r=e/a,n=Math.floor(r),n.toString()+o):e>1e4?(a=1e3,o=" kb",r=e/a,n=Math.floor(r),t.numberFormatter(n)+o):t.numberFormatter(e)+" bp"}var r,n,a,o;this.contentDiv.text(i(e))},t}(igv||{}),MAX_WBITS=15,DEF_WBITS=MAX_WBITS,MAX_MEM_LEVEL=9,MANY=1440,BMAX=15,PRESET_DICT=32,Z_NO_FLUSH=0,Z_PARTIAL_FLUSH=1,Z_SYNC_FLUSH=2,Z_FULL_FLUSH=3,Z_FINISH=4,Z_DEFLATED=8,Z_OK=0,Z_STREAM_END=1,Z_NEED_DICT=2,Z_ERRNO=-1,Z_STREAM_ERROR=-2,Z_DATA_ERROR=-3,Z_MEM_ERROR=-4,Z_BUF_ERROR=-5,Z_VERSION_ERROR=-6,METHOD=0,FLAG=1,DICT4=2,DICT3=3,DICT2=4,DICT1=5,DICT0=6,BLOCKS=7,CHECK4=8,CHECK3=9,CHECK2=10,CHECK1=11,DONE=12,BAD=13,inflate_mask=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535],IB_TYPE=0,IB_LENS=1,IB_STORED=2,IB_TABLE=3,IB_BTREE=4,IB_DTREE=5,IB_CODES=6,IB_DRY=7,IB_DONE=8,IB_BAD=9,fixed_bl=9,fixed_bd=5,fixed_tl=[96,7,256,0,8,80,0,8,16,84,8,115,82,7,31,0,8,112,0,8,48,0,9,192,80,7,10,0,8,96,0,8,32,0,9,160,0,8,0,0,8,128,0,8,64,0,9,224,80,7,6,0,8,88,0,8,24,0,9,144,83,7,59,0,8,120,0,8,56,0,9,208,81,7,17,0,8,104,0,8,40,0,9,176,0,8,8,0,8,136,0,8,72,0,9,240,80,7,4,0,8,84,0,8,20,85,8,227,83,7,43,0,8,116,0,8,52,0,9,200,81,7,13,0,8,100,0,8,36,0,9,168,0,8,4,0,8,132,0,8,68,0,9,232,80,7,8,0,8,92,0,8,28,0,9,152,84,7,83,0,8,124,0,8,60,0,9,216,82,7,23,0,8,108,0,8,44,0,9,184,0,8,12,0,8,140,0,8,76,0,9,248,80,7,3,0,8,82,0,8,18,85,8,163,83,7,35,0,8,114,0,8,50,0,9,196,81,7,11,0,8,98,0,8,34,0,9,164,0,8,2,0,8,130,0,8,66,0,9,228,80,7,7,0,8,90,0,8,26,0,9,148,84,7,67,0,8,122,0,8,58,0,9,212,82,7,19,0,8,106,0,8,42,0,9,180,0,8,10,0,8,138,0,8,74,0,9,244,80,7,5,0,8,86,0,8,22,192,8,0,83,7,51,0,8,118,0,8,54,0,9,204,81,7,15,0,8,102,0,8,38,0,9,172,0,8,6,0,8,134,0,8,70,0,9,236,80,7,9,0,8,94,0,8,30,0,9,156,84,7,99,0,8,126,0,8,62,0,9,220,82,7,27,0,8,110,0,8,46,0,9,188,0,8,14,0,8,142,0,8,78,0,9,252,96,7,256,0,8,81,0,8,17,85,8,131,82,7,31,0,8,113,0,8,49,0,9,194,80,7,10,0,8,97,0,8,33,0,9,162,0,8,1,0,8,129,0,8,65,0,9,226,80,7,6,0,8,89,0,8,25,0,9,146,83,7,59,0,8,121,0,8,57,0,9,210,81,7,17,0,8,105,0,8,41,0,9,178,0,8,9,0,8,137,0,8,73,0,9,242,80,7,4,0,8,85,0,8,21,80,8,258,83,7,43,0,8,117,0,8,53,0,9,202,81,7,13,0,8,101,0,8,37,0,9,170,0,8,5,0,8,133,0,8,69,0,9,234,80,7,8,0,8,93,0,8,29,0,9,154,84,7,83,0,8,125,0,8,61,0,9,218,82,7,23,0,8,109,0,8,45,0,9,186,0,8,13,0,8,141,0,8,77,0,9,250,80,7,3,0,8,83,0,8,19,85,8,195,83,7,35,0,8,115,0,8,51,0,9,198,81,7,11,0,8,99,0,8,35,0,9,166,0,8,3,0,8,131,0,8,67,0,9,230,80,7,7,0,8,91,0,8,27,0,9,150,84,7,67,0,8,123,0,8,59,0,9,214,82,7,19,0,8,107,0,8,43,0,9,182,0,8,11,0,8,139,0,8,75,0,9,246,80,7,5,0,8,87,0,8,23,192,8,0,83,7,51,0,8,119,0,8,55,0,9,206,81,7,15,0,8,103,0,8,39,0,9,174,0,8,7,0,8,135,0,8,71,0,9,238,80,7,9,0,8,95,0,8,31,0,9,158,84,7,99,0,8,127,0,8,63,0,9,222,82,7,27,0,8,111,0,8,47,0,9,190,0,8,15,0,8,143,0,8,79,0,9,254,96,7,256,0,8,80,0,8,16,84,8,115,82,7,31,0,8,112,0,8,48,0,9,193,80,7,10,0,8,96,0,8,32,0,9,161,0,8,0,0,8,128,0,8,64,0,9,225,80,7,6,0,8,88,0,8,24,0,9,145,83,7,59,0,8,120,0,8,56,0,9,209,81,7,17,0,8,104,0,8,40,0,9,177,0,8,8,0,8,136,0,8,72,0,9,241,80,7,4,0,8,84,0,8,20,85,8,227,83,7,43,0,8,116,0,8,52,0,9,201,81,7,13,0,8,100,0,8,36,0,9,169,0,8,4,0,8,132,0,8,68,0,9,233,80,7,8,0,8,92,0,8,28,0,9,153,84,7,83,0,8,124,0,8,60,0,9,217,82,7,23,0,8,108,0,8,44,0,9,185,0,8,12,0,8,140,0,8,76,0,9,249,80,7,3,0,8,82,0,8,18,85,8,163,83,7,35,0,8,114,0,8,50,0,9,197,81,7,11,0,8,98,0,8,34,0,9,165,0,8,2,0,8,130,0,8,66,0,9,229,80,7,7,0,8,90,0,8,26,0,9,149,84,7,67,0,8,122,0,8,58,0,9,213,82,7,19,0,8,106,0,8,42,0,9,181,0,8,10,0,8,138,0,8,74,0,9,245,80,7,5,0,8,86,0,8,22,192,8,0,83,7,51,0,8,118,0,8,54,0,9,205,81,7,15,0,8,102,0,8,38,0,9,173,0,8,6,0,8,134,0,8,70,0,9,237,80,7,9,0,8,94,0,8,30,0,9,157,84,7,99,0,8,126,0,8,62,0,9,221,82,7,27,0,8,110,0,8,46,0,9,189,0,8,14,0,8,142,0,8,78,0,9,253,96,7,256,0,8,81,0,8,17,85,8,131,82,7,31,0,8,113,0,8,49,0,9,195,80,7,10,0,8,97,0,8,33,0,9,163,0,8,1,0,8,129,0,8,65,0,9,227,80,7,6,0,8,89,0,8,25,0,9,147,83,7,59,0,8,121,0,8,57,0,9,211,81,7,17,0,8,105,0,8,41,0,9,179,0,8,9,0,8,137,0,8,73,0,9,243,80,7,4,0,8,85,0,8,21,80,8,258,83,7,43,0,8,117,0,8,53,0,9,203,81,7,13,0,8,101,0,8,37,0,9,171,0,8,5,0,8,133,0,8,69,0,9,235,80,7,8,0,8,93,0,8,29,0,9,155,84,7,83,0,8,125,0,8,61,0,9,219,82,7,23,0,8,109,0,8,45,0,9,187,0,8,13,0,8,141,0,8,77,0,9,251,80,7,3,0,8,83,0,8,19,85,8,195,83,7,35,0,8,115,0,8,51,0,9,199,81,7,11,0,8,99,0,8,35,0,9,167,0,8,3,0,8,131,0,8,67,0,9,231,80,7,7,0,8,91,0,8,27,0,9,151,84,7,67,0,8,123,0,8,59,0,9,215,82,7,19,0,8,107,0,8,43,0,9,183,0,8,11,0,8,139,0,8,75,0,9,247,80,7,5,0,8,87,0,8,23,192,8,0,83,7,51,0,8,119,0,8,55,0,9,207,81,7,15,0,8,103,0,8,39,0,9,175,0,8,7,0,8,135,0,8,71,0,9,239,80,7,9,0,8,95,0,8,31,0,9,159,84,7,99,0,8,127,0,8,63,0,9,223,82,7,27,0,8,111,0,8,47,0,9,191,0,8,15,0,8,143,0,8,79,0,9,255],fixed_td=[80,5,1,87,5,257,83,5,17,91,5,4097,81,5,5,89,5,1025,85,5,65,93,5,16385,80,5,3,88,5,513,84,5,33,92,5,8193,82,5,9,90,5,2049,86,5,129,192,5,24577,80,5,2,87,5,385,83,5,25,91,5,6145,81,5,7,89,5,1537,85,5,97,93,5,24577,80,5,4,88,5,769,84,5,49,92,5,12289,82,5,13,90,5,3073,86,5,193,192,5,24577],cplens=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],cplext=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,112,112],cpdist=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],cpdext=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13];ZStream.prototype.inflateInit=function(t,e){return t||(t=DEF_WBITS),e&&(e=!1),this.istate=new Inflate,this.istate.inflateInit(this,e?-t:t)},ZStream.prototype.inflate=function(t){return null==this.istate?Z_STREAM_ERROR:this.istate.inflate(this,t)},ZStream.prototype.inflateEnd=function(){if(null==this.istate)return Z_STREAM_ERROR;var t=istate.inflateEnd(this);return this.istate=null,t},ZStream.prototype.inflateSync=function(){return istate.inflateSync(this)},ZStream.prototype.inflateSetDictionary=function(t,e){return istate.inflateSetDictionary(this,t,e)},Inflate.prototype.inflateReset=function(t){return null==t||null==t.istate?Z_STREAM_ERROR:(t.total_in=t.total_out=0,t.msg=null,t.istate.mode=0!=t.istate.nowrap?BLOCKS:METHOD,t.istate.blocks.reset(t,null),Z_OK)},Inflate.prototype.inflateEnd=function(t){return null!=this.blocks&&this.blocks.free(t),this.blocks=null,Z_OK},Inflate.prototype.inflateInit=function(t,e){return t.msg=null,this.blocks=null,nowrap=0,e<0&&(e=-e,nowrap=1),e<8||e>15?(this.inflateEnd(t),Z_STREAM_ERROR):(this.wbits=e,t.istate.blocks=new InfBlocks(t,0!=t.istate.nowrap?null:this,1<<e),this.inflateReset(t),Z_OK)},Inflate.prototype.inflate=function(t,e){var i,r;if(null==t||null==t.istate||null==t.next_in)return Z_STREAM_ERROR;for(e=e==Z_FINISH?Z_BUF_ERROR:Z_OK,i=Z_BUF_ERROR;;)switch(t.istate.mode){case METHOD:if(0==t.avail_in)return i;if(i=e,t.avail_in--,t.total_in++,(15&(t.istate.method=t.next_in[t.next_in_index++]))!=Z_DEFLATED){t.istate.mode=BAD,t.msg="unknown compression method",t.istate.marker=5;break}if((t.istate.method>>4)+8>t.istate.wbits){t.istate.mode=BAD,t.msg="invalid window size",t.istate.marker=5;break}t.istate.mode=FLAG;case FLAG:if(0==t.avail_in)return i;if(i=e,t.avail_in--,t.total_in++,r=255&t.next_in[t.next_in_index++],((t.istate.method<<8)+r)%31!=0){t.istate.mode=BAD,t.msg="incorrect header check",t.istate.marker=5;break}if(0==(r&PRESET_DICT)){t.istate.mode=BLOCKS;break}t.istate.mode=DICT4;case DICT4:if(0==t.avail_in)return i;i=e,t.avail_in--,t.total_in++,t.istate.need=(255&t.next_in[t.next_in_index++])<<24&4278190080,t.istate.mode=DICT3;case DICT3:if(0==t.avail_in)return i;i=e,t.avail_in--,t.total_in++,t.istate.need+=(255&t.next_in[t.next_in_index++])<<16&16711680,t.istate.mode=DICT2;case DICT2:if(0==t.avail_in)return i;i=e,t.avail_in--,t.total_in++,t.istate.need+=(255&t.next_in[t.next_in_index++])<<8&65280,t.istate.mode=DICT1;case DICT1:return 0==t.avail_in?i:(i=e,t.avail_in--,t.total_in++,t.istate.need+=255&t.next_in[t.next_in_index++],t.adler=t.istate.need,t.istate.mode=DICT0,Z_NEED_DICT);case DICT0:return t.istate.mode=BAD,t.msg="need dictionary",t.istate.marker=0,Z_STREAM_ERROR;case BLOCKS:if(i=t.istate.blocks.proc(t,i),i==Z_DATA_ERROR){t.istate.mode=BAD,t.istate.marker=0;break}if(i==Z_OK&&(i=e),i!=Z_STREAM_END)return i;if(i=e,t.istate.blocks.reset(t,t.istate.was),0!=t.istate.nowrap){t.istate.mode=DONE;break}t.istate.mode=CHECK4;case CHECK4:if(0==t.avail_in)return i;i=e,t.avail_in--,t.total_in++,t.istate.need=(255&t.next_in[t.next_in_index++])<<24&4278190080,t.istate.mode=CHECK3;case CHECK3:if(0==t.avail_in)return i;i=e,t.avail_in--,t.total_in++,t.istate.need+=(255&t.next_in[t.next_in_index++])<<16&16711680,t.istate.mode=CHECK2;case CHECK2:if(0==t.avail_in)return i;i=e,t.avail_in--,t.total_in++,t.istate.need+=(255&t.next_in[t.next_in_index++])<<8&65280,t.istate.mode=CHECK1;case CHECK1:if(0==t.avail_in)return i;if(i=e,t.avail_in--,t.total_in++,t.istate.need+=255&t.next_in[t.next_in_index++],t.istate.was[0]!=t.istate.need){t.istate.mode=BAD,t.msg="incorrect data check",t.istate.marker=5;break}t.istate.mode=DONE;case DONE:return Z_STREAM_END;case BAD:return Z_DATA_ERROR;default:return Z_STREAM_ERROR}},Inflate.prototype.inflateSetDictionary=function(t,e,i){var r=0,n=i;return null==t||null==t.istate||t.istate.mode!=DICT0?Z_STREAM_ERROR:t._adler.adler32(1,e,0,i)!=t.adler?Z_DATA_ERROR:(t.adler=t._adler.adler32(0,null,0,0),n>=1<<t.istate.wbits&&(n=(1<<t.istate.wbits)-1,r=i-n),t.istate.blocks.set_dictionary(e,r,n),t.istate.mode=BLOCKS,Z_OK)};var mark=[0,0,255,255];Inflate.prototype.inflateSync=function(t){var e,i,r,n,a;if(null==t||null==t.istate)return Z_STREAM_ERROR;if(t.istate.mode!=BAD&&(t.istate.mode=BAD,t.istate.marker=0),0==(e=t.avail_in))return Z_BUF_ERROR;for(i=t.next_in_index,r=t.istate.marker;0!=e&&r<4;)t.next_in[i]==mark[r]?r++:r=0!=t.next_in[i]?0:4-r,i++,e--;return t.total_in+=i-t.next_in_index,t.next_in_index=i,t.avail_in=e,t.istate.marker=r,4!=r?Z_DATA_ERROR:(n=t.total_in,a=t.total_out,this.inflateReset(t),t.total_in=n,t.total_out=a,t.istate.mode=BLOCKS,Z_OK)},Inflate.prototype.inflateSyncPoint=function(t){return null==t||null==t.istate||null==t.istate.blocks?Z_STREAM_ERROR:t.istate.blocks.sync_point()};var INFBLOCKS_BORDER=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];InfBlocks.prototype.reset=function(t,e){e&&(e[0]=this.check),this.mode==IB_CODES&&this.codes.free(t),this.mode=IB_TYPE,this.bitk=0,this.bitb=0,this.read=this.write=0,this.checkfn&&(t.adler=this.check=t._adler.adler32(0,null,0,0))},InfBlocks.prototype.proc=function(t,e){var i,r,n,a,o,s,h;for(a=t.next_in_index,o=t.avail_in,r=this.bitb,n=this.bitk,s=this.write,h=s<this.read?this.read-s-1:this.end-s;;)switch(this.mode){case IB_TYPE:for(;n<3;){if(0==o)return this.bitb=r,this.bitk=n,t.avail_in=o,t.total_in+=a-t.next_in_index,t.next_in_index=a,this.write=s,this.inflate_flush(t,e);e=Z_OK,o--,r|=(255&t.next_in[a++])<<n,n+=8}switch(i=7&r,this.last=1&i,i>>>1){case 0:r>>>=3,n-=3,i=7&n,r>>>=i,n-=i,this.mode=IB_LENS;break;case 1:var l=new Int32Array(1),c=new Int32Array(1),u=[],d=[];inflate_trees_fixed(l,c,u,d,t),this.codes.init(l[0],c[0],u[0],0,d[0],0,t),r>>>=3,n-=3,this.mode=IB_CODES;break;case 2:r>>>=3,n-=3,this.mode=IB_TABLE;break;case 3:return r>>>=3,n-=3,this.mode=BAD,t.msg="invalid block type",e=Z_DATA_ERROR,this.bitb=r,this.bitk=n,t.avail_in=o,t.total_in+=a-t.next_in_index,t.next_in_index=a,this.write=s,this.inflate_flush(t,e)}break;case IB_LENS:for(;n<32;){if(0==o)return this.bitb=r,this.bitk=n,t.avail_in=o,t.total_in+=a-t.next_in_index,t.next_in_index=a,this.write=s,this.inflate_flush(t,e);e=Z_OK,o--,r|=(255&t.next_in[a++])<<n,n+=8}if((~r>>>16&65535)!=(65535&r))return this.mode=BAD,t.msg="invalid stored block lengths",e=Z_DATA_ERROR,this.bitb=r,this.bitk=n,t.avail_in=o,t.total_in+=a-t.next_in_index,t.next_in_index=a,this.write=s,this.inflate_flush(t,e);this.left=65535&r,r=n=0,this.mode=0!=left?IB_STORED:0!=this.last?IB_DRY:IB_TYPE;break;case IB_STORED:if(0==o)return this.bitb=r,this.bitk=n,t.avail_in=o,t.total_in+=a-t.next_in_index,t.next_in_index=a,write=s,this.inflate_flush(t,e);if(0==h&&(s==end&&0!=read&&(s=0,h=s<this.read?this.read-s-1:this.end-s),0==h&&(this.write=s,e=this.inflate_flush(t,e),s=this.write,h=s<this.read?this.read-s-1:this.end-s,s==this.end&&0!=this.read&&(s=0,h=s<this.read?this.read-s-1:this.end-s),0==h)))return this.bitb=r,this.bitk=n,t.avail_in=o,t.total_in+=a-t.next_in_index,t.next_in_index=a,this.write=s,this.inflate_flush(t,e);if(e=Z_OK,i=this.left,i>o&&(i=o),i>h&&(i=h),arrayCopy(t.next_in,a,window,s,i),a+=i,o-=i,s+=i,h-=i,0!=(this.left-=i))break;this.mode=0!=this.last?IB_DRY:IB_TYPE;break;case IB_TABLE:for(;n<14;){if(0==o)return this.bitb=r,this.bitk=n,t.avail_in=o,t.total_in+=a-t.next_in_index,t.next_in_index=a,this.write=s,this.inflate_flush(t,e);e=Z_OK,o--,r|=(255&t.next_in[a++])<<n,n+=8}if(this.table=i=16383&r,(31&i)>29||(i>>5&31)>29)return this.mode=IB_BAD,t.msg="too many length or distance symbols",e=Z_DATA_ERROR,this.bitb=r,this.bitk=n,t.avail_in=o,t.total_in+=a-t.next_in_index,t.next_in_index=a,this.write=s,this.inflate_flush(t,e);if(i=258+(31&i)+(i>>5&31),null==this.blens||this.blens.length<i)this.blens=new Int32Array(i);else for(var p=0;p<i;p++)this.blens[p]=0;r>>>=14,n-=14,this.index=0,mode=IB_BTREE;case IB_BTREE:for(;this.index<4+(this.table>>>10);){for(;n<3;){if(0==o)return this.bitb=r,this.bitk=n,t.avail_in=o,t.total_in+=a-t.next_in_index,t.next_in_index=a,this.write=s,this.inflate_flush(t,e);e=Z_OK,o--,r|=(255&t.next_in[a++])<<n,n+=8}this.blens[INFBLOCKS_BORDER[this.index++]]=7&r,r>>>=3,n-=3}for(;this.index<19;)this.blens[INFBLOCKS_BORDER[this.index++]]=0;if(this.bb[0]=7,i=this.inftree.inflate_trees_bits(this.blens,this.bb,this.tb,this.hufts,t),i!=Z_OK)return e=i,e==Z_DATA_ERROR&&(this.blens=null,this.mode=IB_BAD),this.bitb=r,this.bitk=n,t.avail_in=o,t.total_in+=a-t.next_in_index,t.next_in_index=a,write=s,this.inflate_flush(t,e);this.index=0,this.mode=IB_DTREE;case IB_DTREE:for(;;){if(i=this.table,!(this.index<258+(31&i)+(i>>5&31)))break;var p,f,g;for(i=this.bb[0];n<i;){if(0==o)return this.bitb=r,this.bitk=n,t.avail_in=o,t.total_in+=a-t.next_in_index,t.next_in_index=a,this.write=s,this.inflate_flush(t,e);e=Z_OK,o--,r|=(255&t.next_in[a++])<<n,n+=8}if(i=this.hufts[3*(this.tb[0]+(r&inflate_mask[i]))+1],g=this.hufts[3*(this.tb[0]+(r&inflate_mask[i]))+2],g<16)r>>>=i,n-=i,this.blens[this.index++]=g;else{for(p=18==g?7:g-14,f=18==g?11:3;n<i+p;){if(0==o)return this.bitb=r,this.bitk=n,t.avail_in=o,t.total_in+=a-t.next_in_index,t.next_in_index=a,this.write=s,this.inflate_flush(t,e);e=Z_OK,o--,r|=(255&t.next_in[a++])<<n,n+=8}if(r>>>=i,n-=i,f+=r&inflate_mask[p],r>>>=p,n-=p,p=this.index,i=this.table,p+f>258+(31&i)+(i>>5&31)||16==g&&p<1)return this.blens=null,this.mode=IB_BAD,t.msg="invalid bit length repeat",e=Z_DATA_ERROR,this.bitb=r,this.bitk=n,t.avail_in=o,t.total_in+=a-t.next_in_index,t.next_in_index=a,this.write=s,this.inflate_flush(t,e);g=16==g?this.blens[p-1]:0;do this.blens[p++]=g;while(0!=--f);this.index=p}}this.tb[0]=-1;var l=new Int32Array(1),c=new Int32Array(1),u=new Int32Array(1),d=new Int32Array(1);if(l[0]=9,c[0]=6,i=this.table,i=this.inftree.inflate_trees_dynamic(257+(31&i),1+(i>>5&31),this.blens,l,c,u,d,this.hufts,t),i!=Z_OK)return i==Z_DATA_ERROR&&(this.blens=null,this.mode=BAD),e=i,this.bitb=r,this.bitk=n,t.avail_in=o,t.total_in+=a-t.next_in_index,t.next_in_index=a,this.write=s,this.inflate_flush(t,e);this.codes.init(l[0],c[0],this.hufts,u[0],this.hufts,d[0],t),this.mode=IB_CODES;case IB_CODES:if(this.bitb=r,this.bitk=n,t.avail_in=o,t.total_in+=a-t.next_in_index,t.next_in_index=a,this.write=s,(e=this.codes.proc(this,t,e))!=Z_STREAM_END)return this.inflate_flush(t,e);if(e=Z_OK,this.codes.free(t),a=t.next_in_index,o=t.avail_in,r=this.bitb,n=this.bitk,s=this.write,h=s<this.read?this.read-s-1:this.end-s,0==this.last){this.mode=IB_TYPE;break}this.mode=IB_DRY;case IB_DRY:if(this.write=s,e=this.inflate_flush(t,e),s=this.write,h=s<this.read?this.read-s-1:this.end-s,this.read!=this.write)return this.bitb=r,this.bitk=n,t.avail_in=o,t.total_in+=a-t.next_in_index,t.next_in_index=a,this.write=s,this.inflate_flush(t,e);mode=DONE;case IB_DONE:return e=Z_STREAM_END,this.bitb=r,this.bitk=n,t.avail_in=o,t.total_in+=a-t.next_in_index,t.next_in_index=a,this.write=s,this.inflate_flush(t,e);case IB_BAD:return e=Z_DATA_ERROR,this.bitb=r,this.bitk=n,t.avail_in=o,t.total_in+=a-t.next_in_index,t.next_in_index=a,this.write=s,this.inflate_flush(t,e);default:return e=Z_STREAM_ERROR,this.bitb=r,this.bitk=n,t.avail_in=o,t.total_in+=a-t.next_in_index,t.next_in_index=a,this.write=s,this.inflate_flush(t,e)}},InfBlocks.prototype.free=function(t){this.reset(t,null),this.window=null,this.hufts=null},InfBlocks.prototype.set_dictionary=function(t,e,i){arrayCopy(t,e,window,0,i),this.read=this.write=i},InfBlocks.prototype.sync_point=function(){return this.mode==IB_LENS},InfBlocks.prototype.inflate_flush=function(t,e){var i,r,n;return r=t.next_out_index,n=this.read,i=(n<=this.write?this.write:this.end)-n,i>t.avail_out&&(i=t.avail_out),0!=i&&e==Z_BUF_ERROR&&(e=Z_OK),t.avail_out-=i,t.total_out+=i,null!=this.checkfn&&(t.adler=this.check=t._adler.adler32(this.check,this.window,n,i)),arrayCopy(this.window,n,t.next_out,r,i),r+=i,n+=i,n==this.end&&(n=0,this.write==this.end&&(this.write=0),i=this.write-n,i>t.avail_out&&(i=t.avail_out),0!=i&&e==Z_BUF_ERROR&&(e=Z_OK),t.avail_out-=i,t.total_out+=i,null!=this.checkfn&&(t.adler=this.check=t._adler.adler32(this.check,this.window,n,i)),arrayCopy(this.window,n,t.next_out,r,i),r+=i,n+=i),t.next_out_index=r,this.read=n,e};var IC_START=0,IC_LEN=1,IC_LENEXT=2,IC_DIST=3,IC_DISTEXT=4,IC_COPY=5,IC_LIT=6,IC_WASH=7,IC_END=8,IC_BADCODE=9;InfCodes.prototype.init=function(t,e,i,r,n,a,o){this.mode=IC_START,this.lbits=t,this.dbits=e,this.ltree=i,this.ltree_index=r,this.dtree=n,this.dtree_index=a,this.tree=null},InfCodes.prototype.proc=function(t,e,i){var r,n,a,o,s,h,l,c=0,u=0,d=0;for(d=e.next_in_index,o=e.avail_in,c=t.bitb,u=t.bitk,s=t.write,h=s<t.read?t.read-s-1:t.end-s;;)switch(this.mode){case IC_START:if(h>=258&&o>=10&&(t.bitb=c,t.bitk=u,e.avail_in=o,e.total_in+=d-e.next_in_index,e.next_in_index=d,t.write=s,i=this.inflate_fast(this.lbits,this.dbits,this.ltree,this.ltree_index,this.dtree,this.dtree_index,t,e),d=e.next_in_index,o=e.avail_in,c=t.bitb,u=t.bitk,s=t.write,h=s<t.read?t.read-s-1:t.end-s,i!=Z_OK)){this.mode=i==Z_STREAM_END?IC_WASH:IC_BADCODE;break}this.need=this.lbits,this.tree=this.ltree,this.tree_index=this.ltree_index,this.mode=IC_LEN;case IC_LEN:for(r=this.need;u<r;){if(0==o)return t.bitb=c,t.bitk=u,e.avail_in=o,e.total_in+=d-e.next_in_index,e.next_in_index=d,t.write=s,t.inflate_flush(e,i);i=Z_OK,o--,c|=(255&e.next_in[d++])<<u,u+=8}if(n=3*(this.tree_index+(c&inflate_mask[r])),c>>>=this.tree[n+1],u-=this.tree[n+1],a=this.tree[n],0==a){this.lit=this.tree[n+2],this.mode=IC_LIT;break}if(0!=(16&a)){this.get=15&a,this.len=this.tree[n+2],this.mode=IC_LENEXT;break}if(0==(64&a)){this.need=a,this.tree_index=n/3+this.tree[n+2];break}if(0!=(32&a)){this.mode=IC_WASH;break}return this.mode=IC_BADCODE,e.msg="invalid literal/length code",i=Z_DATA_ERROR,t.bitb=c,t.bitk=u,e.avail_in=o,e.total_in+=d-e.next_in_index,e.next_in_index=d,t.write=s,t.inflate_flush(e,i);case IC_LENEXT:for(r=this.get;u<r;){if(0==o)return t.bitb=c,t.bitk=u,e.avail_in=o,e.total_in+=d-e.next_in_index,e.next_in_index=d,t.write=s,t.inflate_flush(e,i);i=Z_OK,o--,c|=(255&e.next_in[d++])<<u,u+=8}this.len+=c&inflate_mask[r],c>>=r,u-=r,this.need=this.dbits,this.tree=this.dtree,this.tree_index=this.dtree_index,this.mode=IC_DIST;case IC_DIST:for(r=this.need;u<r;){if(0==o)return t.bitb=c,t.bitk=u,e.avail_in=o,e.total_in+=d-e.next_in_index,e.next_in_index=d,t.write=s,t.inflate_flush(e,i);i=Z_OK,o--,c|=(255&e.next_in[d++])<<u,u+=8}if(n=3*(this.tree_index+(c&inflate_mask[r])),c>>=this.tree[n+1],u-=this.tree[n+1],a=this.tree[n],0!=(16&a)){this.get=15&a,this.dist=this.tree[n+2],this.mode=IC_DISTEXT;break}if(0==(64&a)){this.need=a,this.tree_index=n/3+this.tree[n+2];break}return this.mode=IC_BADCODE,e.msg="invalid distance code",i=Z_DATA_ERROR,t.bitb=c,t.bitk=u,e.avail_in=o,e.total_in+=d-e.next_in_index,e.next_in_index=d,t.write=s,t.inflate_flush(e,i);case IC_DISTEXT:for(r=this.get;u<r;){if(0==o)return t.bitb=c,t.bitk=u,e.avail_in=o,e.total_in+=d-e.next_in_index,e.next_in_index=d,t.write=s,t.inflate_flush(e,i);i=Z_OK,o--,c|=(255&e.next_in[d++])<<u,u+=8}this.dist+=c&inflate_mask[r],c>>=r,u-=r,this.mode=IC_COPY;case IC_COPY:for(l=s-this.dist;l<0;)l+=t.end;for(;0!=this.len;){if(0==h&&(s==t.end&&0!=t.read&&(s=0,h=s<t.read?t.read-s-1:t.end-s),0==h&&(t.write=s,i=t.inflate_flush(e,i),s=t.write,h=s<t.read?t.read-s-1:t.end-s,s==t.end&&0!=t.read&&(s=0,h=s<t.read?t.read-s-1:t.end-s),0==h)))return t.bitb=c,t.bitk=u,e.avail_in=o,e.total_in+=d-e.next_in_index,e.next_in_index=d,t.write=s,t.inflate_flush(e,i);t.window[s++]=t.window[l++],h--,l==t.end&&(l=0),this.len--}this.mode=IC_START;break;case IC_LIT:if(0==h&&(s==t.end&&0!=t.read&&(s=0,h=s<t.read?t.read-s-1:t.end-s),0==h&&(t.write=s,i=t.inflate_flush(e,i),s=t.write,h=s<t.read?t.read-s-1:t.end-s,s==t.end&&0!=t.read&&(s=0,h=s<t.read?t.read-s-1:t.end-s),0==h)))return t.bitb=c,t.bitk=u,e.avail_in=o,e.total_in+=d-e.next_in_index,e.next_in_index=d,t.write=s,t.inflate_flush(e,i);i=Z_OK,t.window[s++]=this.lit,h--,this.mode=IC_START;break;case IC_WASH:if(u>7&&(u-=8,o++,d--),t.write=s,i=t.inflate_flush(e,i),s=t.write,h=s<t.read?t.read-s-1:t.end-s,t.read!=t.write)return t.bitb=c,t.bitk=u,e.avail_in=o,e.total_in+=d-e.next_in_index,e.next_in_index=d,t.write=s,t.inflate_flush(e,i);this.mode=IC_END;case IC_END:return i=Z_STREAM_END,t.bitb=c,t.bitk=u,e.avail_in=o,e.total_in+=d-e.next_in_index,e.next_in_index=d,t.write=s,t.inflate_flush(e,i);case IC_BADCODE:return i=Z_DATA_ERROR,t.bitb=c,t.bitk=u,e.avail_in=o,e.total_in+=d-e.next_in_index,e.next_in_index=d,t.write=s,t.inflate_flush(e,i);default:return i=Z_STREAM_ERROR,t.bitb=c,t.bitk=u,e.avail_in=o,e.total_in+=d-e.next_in_index,e.next_in_index=d,t.write=s,t.inflate_flush(e,i)}},InfCodes.prototype.free=function(t){},InfCodes.prototype.inflate_fast=function(t,e,i,r,n,a,o,s){var h,l,c,u,d,p,f,g,v,m,b,y,w,k,x,S;f=s.next_in_index,g=s.avail_in,d=o.bitb,p=o.bitk,v=o.write,m=v<o.read?o.read-v-1:o.end-v,b=inflate_mask[t],y=inflate_mask[e];do{for(;p<20;)g--,d|=(255&s.next_in[f++])<<p,p+=8;if(h=d&b,l=i,c=r,S=3*(c+h),0!=(u=l[S]))for(;;){if(d>>=l[S+1],p-=l[S+1],0!=(16&u)){for(u&=15,w=l[S+2]+(d&inflate_mask[u]),d>>=u,p-=u;p<15;)g--,d|=(255&s.next_in[f++])<<p,p+=8;for(h=d&y,l=n,c=a,S=3*(c+h),u=l[S];;){if(d>>=l[S+1],p-=l[S+1],0!=(16&u)){for(u&=15;p<u;)g--,d|=(255&s.next_in[f++])<<p,p+=8;if(k=l[S+2]+(d&inflate_mask[u]),d>>=u,p-=u,m-=w,v>=k)x=v-k,v-x>0&&2>v-x?(o.window[v++]=o.window[x++],o.window[v++]=o.window[x++],w-=2):(o.window[v++]=o.window[x++],o.window[v++]=o.window[x++],w-=2);else{x=v-k;do x+=o.end;while(x<0);if(u=o.end-x,w>u){if(w-=u,v-x>0&&u>v-x){do o.window[v++]=o.window[x++];while(0!=--u)}else arrayCopy(o.window,x,o.window,v,u),v+=u,x+=u,u=0;x=0}}do o.window[v++]=o.window[x++];while(0!=--w);break}if(0!=(64&u))return s.msg="invalid distance code",w=s.avail_in-g,w=p>>3<w?p>>3:w,g+=w,f-=w,p-=w<<3,o.bitb=d,o.bitk=p,s.avail_in=g,s.total_in+=f-s.next_in_index,s.next_in_index=f,o.write=v,Z_DATA_ERROR;h+=l[S+2],h+=d&inflate_mask[u],S=3*(c+h),u=l[S]}break}if(0!=(64&u))return 0!=(32&u)?(w=s.avail_in-g,w=p>>3<w?p>>3:w,g+=w,f-=w,p-=w<<3,o.bitb=d,o.bitk=p,s.avail_in=g,s.total_in+=f-s.next_in_index,s.next_in_index=f,o.write=v,Z_STREAM_END):(s.msg="invalid literal/length code",w=s.avail_in-g,w=p>>3<w?p>>3:w,g+=w,f-=w,p-=w<<3,o.bitb=d,o.bitk=p,s.avail_in=g,s.total_in+=f-s.next_in_index,s.next_in_index=f,o.write=v,Z_DATA_ERROR);if(h+=l[S+2],h+=d&inflate_mask[u],S=3*(c+h),0==(u=l[S])){d>>=l[S+1],p-=l[S+1],o.window[v++]=l[S+2],m--;break}}else d>>=l[S+1],p-=l[S+1],o.window[v++]=l[S+2],m--}while(m>=258&&g>=10);return w=s.avail_in-g,w=p>>3<w?p>>3:w,g+=w,f-=w,p-=w<<3,o.bitb=d,o.bitk=p,s.avail_in=g,s.total_in+=f-s.next_in_index,s.next_in_index=f,o.write=v,Z_OK},InfTree.prototype.huft_build=function(t,e,i,r,n,a,o,s,h,l,c){var u,d,p,f,g,v,m,b,y,w,k,x,S,_,C;w=0,g=i;do this.c[t[e+w]]++,w++,g--;while(0!=g);if(this.c[0]==i)return o[0]=-1,s[0]=0,Z_OK;for(b=s[0],v=1;v<=BMAX&&0==this.c[v];v++);for(m=v,b<v&&(b=v),g=BMAX;0!=g&&0==this.c[g];g--);for(p=g,b>g&&(b=g),s[0]=b,_=1<<v;v<g;v++,_<<=1)if((_-=this.c[v])<0)return Z_DATA_ERROR;if((_-=this.c[g])<0)return Z_DATA_ERROR;for(this.c[g]+=_,this.x[1]=v=0,w=1,S=2;0!=--g;)this.x[S]=v+=this.c[w],S++,w++;g=0,w=0;do 0!=(v=t[e+w])&&(this.v[this.x[v]++]=g),w++;while(++g<i);for(i=this.x[p],this.x[0]=g=0,w=0,f=-1,x=-b,this.u[0]=0,k=0,C=0;m<=p;m++)for(u=this.c[m];0!=u--;){for(;m>x+b;){if(f++,x+=b,C=p-x,C=C>b?b:C,(d=1<<(v=m-x))>u+1&&(d-=u+1,S=m,v<C))for(;++v<C&&!((d<<=1)<=this.c[++S]);)d-=this.c[S];if(C=1<<v,this.hn[0]+C>MANY)return Z_DATA_ERROR;this.u[f]=k=this.hn[0],this.hn[0]+=C,0!=f?(this.x[f]=g,this.r[0]=v,this.r[1]=b,v=g>>>x-b,this.r[2]=k-this.u[f-1]-v,arrayCopy(this.r,0,h,3*(this.u[f-1]+v),3)):o[0]=k}for(this.r[1]=m-x,w>=i?this.r[0]=192:c[w]<r?(this.r[0]=this.v[w]<256?0:96,this.r[2]=this.v[w++]):(this.r[0]=a[this.v[w]-r]+16+64,this.r[2]=n[this.v[w++]-r]),d=1<<m-x,v=g>>>x;v<C;v+=d)arrayCopy(this.r,0,h,3*(k+v),3);for(v=1<<m-1;0!=(g&v);v>>>=1)g^=v;for(g^=v,y=(1<<x)-1;(g&y)!=this.x[f];)f--,x-=b,y=(1<<x)-1}return 0!=_&&1!=p?Z_BUF_ERROR:Z_OK},InfTree.prototype.inflate_trees_bits=function(t,e,i,r,n){var a;return this.initWorkArea(19),this.hn[0]=0,a=this.huft_build(t,0,19,19,null,null,i,e,r,this.hn,this.v),a==Z_DATA_ERROR?n.msg="oversubscribed dynamic bit lengths tree":a!=Z_BUF_ERROR&&0!=e[0]||(n.msg="incomplete dynamic bit lengths tree",a=Z_DATA_ERROR),a},InfTree.prototype.inflate_trees_dynamic=function(t,e,i,r,n,a,o,s,h){var l;return this.initWorkArea(288),this.hn[0]=0,l=this.huft_build(i,0,t,257,cplens,cplext,a,r,s,this.hn,this.v),l!=Z_OK||0==r[0]?(l==Z_DATA_ERROR?h.msg="oversubscribed literal/length tree":l!=Z_MEM_ERROR&&(h.msg="incomplete literal/length tree",l=Z_DATA_ERROR),l):(this.initWorkArea(288),l=this.huft_build(i,t,e,0,cpdist,cpdext,o,n,s,this.hn,this.v),l!=Z_OK||0==n[0]&&t>257?(l==Z_DATA_ERROR?h.msg="oversubscribed distance tree":l==Z_BUF_ERROR?(h.msg="incomplete distance tree",l=Z_DATA_ERROR):l!=Z_MEM_ERROR&&(h.msg="empty distance tree with lengths",l=Z_DATA_ERROR),l):Z_OK)},InfTree.prototype.initWorkArea=function(t){null==this.hn&&(this.hn=new Int32Array(1),this.v=new Int32Array(t),this.c=new Int32Array(BMAX+1),this.r=new Int32Array(3),this.u=new Int32Array(BMAX),this.x=new Int32Array(BMAX+1)),this.v.length<t&&(this.v=new Int32Array(t));for(var e=0;e<t;e++)this.v[e]=0;for(var e=0;e<BMAX+1;e++)this.c[e]=0;for(var e=0;e<3;e++)this.r[e]=0;arrayCopy(this.c,0,this.u,0,BMAX),arrayCopy(this.c,0,this.x,0,BMAX+1)};var testArray=new Uint8Array(1),hasSubarray="function"==typeof testArray.subarray,hasSlice=!1,ADLER_BASE=65521,ADLER_NMAX=5552;(function(){"use strict";function t(t){throw t}function e(t,e){var i=t.split("."),r=T;!(i[0]in r)&&r.execScript&&r.execScript("var "+i[0]);for(var n;i.length&&(n=i.shift());)i.length||e===_?r=r[n]?r[n]:r[n]={}:r[n]=e}function i(e,i){this.index="number"==typeof i?i:0,this.m=0,this.buffer=e instanceof(A?Uint8Array:Array)?e:new(A?Uint8Array:Array)(32768),2*this.buffer.length<=this.index&&t(Error("invalid index")),this.buffer.length<=this.index&&this.f()}function r(t,e,i){var r,n="number"==typeof e?e:e=0,a="number"==typeof i?i:t.length;for(r=-1,n=7&a;n--;++e)r=r>>>8^$[255&(r^t[e])];for(n=a>>3;n--;e+=8)r=r>>>8^$[255&(r^t[e])],r=r>>>8^$[255&(r^t[e+1])],r=r>>>8^$[255&(r^t[e+2])],r=r>>>8^$[255&(r^t[e+3])],r=r>>>8^$[255&(r^t[e+4])],r=r>>>8^$[255&(r^t[e+5])],r=r>>>8^$[255&(r^t[e+6])],r=r>>>8^$[255&(r^t[e+7])];return(4294967295^r)>>>0}function n(){}function a(t){this.buffer=new(A?Uint16Array:Array)(2*t),this.length=0}function o(t){var e,i,r,n,a,o,s,h,l,c=t.length,u=0,d=Number.POSITIVE_INFINITY;for(h=0;h<c;++h)t[h]>u&&(u=t[h]),
t[h]<d&&(d=t[h]);for(e=1<<u,i=new(A?Uint32Array:Array)(e),r=1,n=0,a=2;r<=u;){for(h=0;h<c;++h)if(t[h]===r){for(o=0,s=n,l=0;l<r;++l)o=o<<1|1&s,s>>=1;for(l=o;l<e;l+=a)i[l]=r<<16|h;++n}++r,n<<=1,a<<=1}return[i,u,d]}function s(t,e){this.k=L,this.I=0,this.input=A&&t instanceof Array?new Uint8Array(t):t,this.b=0,e&&(e.lazy&&(this.I=e.lazy),"number"==typeof e.compressionType&&(this.k=e.compressionType),e.outputBuffer&&(this.a=A&&e.outputBuffer instanceof Array?new Uint8Array(e.outputBuffer):e.outputBuffer),"number"==typeof e.outputIndex&&(this.b=e.outputIndex)),this.a||(this.a=new(A?Uint8Array:Array)(32768))}function h(t,e){this.length=t,this.P=e}function l(e,i){function r(e,i){var r,n=e.P,a=[],o=0;r=V[e.length],a[o++]=65535&r,a[o++]=r>>16&255,a[o++]=r>>24;var s;switch(C){case 1===n:s=[0,n-1,0];break;case 2===n:s=[1,n-2,0];break;case 3===n:s=[2,n-3,0];break;case 4===n:s=[3,n-4,0];break;case 6>=n:s=[4,n-5,1];break;case 8>=n:s=[5,n-7,1];break;case 12>=n:s=[6,n-9,2];break;case 16>=n:s=[7,n-13,2];break;case 24>=n:s=[8,n-17,3];break;case 32>=n:s=[9,n-25,3];break;case 48>=n:s=[10,n-33,4];break;case 64>=n:s=[11,n-49,4];break;case 96>=n:s=[12,n-65,5];break;case 128>=n:s=[13,n-97,5];break;case 192>=n:s=[14,n-129,6];break;case 256>=n:s=[15,n-193,6];break;case 384>=n:s=[16,n-257,7];break;case 512>=n:s=[17,n-385,7];break;case 768>=n:s=[18,n-513,8];break;case 1024>=n:s=[19,n-769,8];break;case 1536>=n:s=[20,n-1025,9];break;case 2048>=n:s=[21,n-1537,9];break;case 3072>=n:s=[22,n-2049,10];break;case 4096>=n:s=[23,n-3073,10];break;case 6144>=n:s=[24,n-4097,11];break;case 8192>=n:s=[25,n-6145,11];break;case 12288>=n:s=[26,n-8193,12];break;case 16384>=n:s=[27,n-12289,12];break;case 24576>=n:s=[28,n-16385,13];break;case 32768>=n:s=[29,n-24577,13];break;default:t("invalid distance")}r=s,a[o++]=r[0],a[o++]=r[1],a[o++]=r[2];var h,l;for(h=0,l=a.length;h<l;++h)g[v++]=a[h];b[a[0]]++,y[a[3]]++,m=e.length+i-1,d=null}var n,a,o,s,h,l,u,d,p,f={},g=A?new Uint16Array(2*i.length):[],v=0,m=0,b=new(A?Uint32Array:Array)(286),y=new(A?Uint32Array:Array)(30),w=e.I;if(!A){for(o=0;285>=o;)b[o++]=0;for(o=0;29>=o;)y[o++]=0}for(b[256]=1,n=0,a=i.length;n<a;++n){for(o=h=0,s=3;o<s&&n+o!==a;++o)h=h<<8|i[n+o];if(f[h]===_&&(f[h]=[]),l=f[h],!(0<m--)){for(;0<l.length&&32768<n-l[0];)l.shift();if(n+3>=a){for(d&&r(d,-1),o=0,s=a-n;o<s;++o)p=i[n+o],g[v++]=p,++b[p];break}0<l.length?(u=c(i,n,l),d?d.length<u.length?(p=i[n-1],g[v++]=p,++b[p],r(u,0)):r(d,-1):u.length<w?d=u:r(u,0)):d?r(d,-1):(p=i[n],g[v++]=p,++b[p])}l.push(n)}return g[v++]=256,b[256]++,e.V=b,e.U=y,A?g.subarray(0,v):g}function c(t,e,i){var r,n,a,o,s,l,c=0,u=t.length;o=0,l=i.length;t:for(;o<l;o++){if(r=i[l-o-1],a=3,3<c){for(s=c;3<s;s--)if(t[r+s-1]!==t[e+s-1])continue t;a=c}for(;258>a&&e+a<u&&t[r+a]===t[e+a];)++a;if(a>c&&(n=r,c=a),258===a)break}return new h(c,e-n)}function u(t,e){var i,r,n,o,s,h=t.length,l=new a(572),c=new(A?Uint8Array:Array)(h);if(!A)for(o=0;o<h;o++)c[o]=0;for(o=0;o<h;++o)0<t[o]&&l.push(o,t[o]);if(i=Array(l.length/2),r=new(A?Uint32Array:Array)(l.length/2),1===i.length)return c[l.pop().index]=1,c;for(o=0,s=l.length/2;o<s;++o)i[o]=l.pop(),r[o]=i[o].value;for(n=d(r,r.length,e),o=0,s=i.length;o<s;++o)c[i[o].index]=n[o];return c}function d(t,e,i){function r(t){var i=p[t][f[t]];i===e?(r(t+1),r(t+1)):--u[i],++f[t]}var n,a,o,s,h,l=new(A?Uint16Array:Array)(i),c=new(A?Uint8Array:Array)(i),u=new(A?Uint8Array:Array)(e),d=Array(i),p=Array(i),f=Array(i),g=(1<<i)-e,v=1<<i-1;for(l[i-1]=e,a=0;a<i;++a)g<v?c[a]=0:(c[a]=1,g-=v),g<<=1,l[i-2-a]=(l[i-1-a]/2|0)+e;for(l[0]=c[0],d[0]=Array(l[0]),p[0]=Array(l[0]),a=1;a<i;++a)l[a]>2*l[a-1]+c[a]&&(l[a]=2*l[a-1]+c[a]),d[a]=Array(l[a]),p[a]=Array(l[a]);for(n=0;n<e;++n)u[n]=i;for(o=0;o<l[i-1];++o)d[i-1][o]=t[o],p[i-1][o]=o;for(n=0;n<i;++n)f[n]=0;for(1===c[i-1]&&(--u[0],++f[i-1]),a=i-2;0<=a;--a){for(s=n=0,h=f[a+1],o=0;o<l[a];o++)s=d[a+1][h]+d[a+1][h+1],s>t[n]?(d[a][o]=s,p[a][o]=e,h+=2):(d[a][o]=t[n],p[a][o]=n,++n);f[a]=0,1===c[a]&&r(a)}return u}function p(t){var e,i,r,n,a=new(A?Uint16Array:Array)(t.length),o=[],s=[],h=0;for(e=0,i=t.length;e<i;e++)o[t[e]]=(0|o[t[e]])+1;for(e=1,i=16;e<=i;e++)s[e]=h,h+=0|o[e],h<<=1;for(e=0,i=t.length;e<i;e++)for(h=s[t[e]],s[t[e]]+=1,r=a[e]=0,n=t[e];r<n;r++)a[e]=a[e]<<1|1&h,h>>>=1;return a}function f(t,e){this.input=t,this.b=this.c=0,this.i={},e&&(e.flags&&(this.i=e.flags),"string"==typeof e.filename&&(this.filename=e.filename),"string"==typeof e.comment&&(this.A=e.comment),e.deflateOptions&&(this.l=e.deflateOptions)),this.l||(this.l={})}function g(e,i){switch(this.p=[],this.q=32768,this.e=this.j=this.c=this.u=0,this.input=A?new Uint8Array(e):e,this.w=!1,this.r=Z,this.L=!1,!i&&(i={})||(i.index&&(this.c=i.index),i.bufferSize&&(this.q=i.bufferSize),i.bufferType&&(this.r=i.bufferType),i.resize&&(this.L=i.resize)),this.r){case z:this.b=32768,this.a=new(A?Uint8Array:Array)(32768+this.q+258);break;case Z:this.b=0,this.a=new(A?Uint8Array:Array)(this.q),this.f=this.T,this.B=this.Q,this.s=this.S;break;default:t(Error("invalid inflate mode"))}}function v(e,i){for(var r,n=e.j,a=e.e,o=e.input,s=e.c;a<i;)r=o[s++],r===_&&t(Error("input buffer is broken")),n|=r<<a,a+=8;return r=n&(1<<i)-1,e.j=n>>>i,e.e=a-i,e.c=s,r}function m(t,e){for(var i,r,n,a=t.j,o=t.e,s=t.input,h=t.c,l=e[0],c=e[1];o<c&&(i=s[h++],i!==_);)a|=i<<o,o+=8;return r=l[a&(1<<c)-1],n=r>>>16,t.j=a>>n,t.e=o-n,t.c=h,65535&r}function b(t){function e(t,e,i){var r,n,a,o;for(o=0;o<t;)switch(r=m(this,e)){case 16:for(a=3+v(this,2);a--;)i[o++]=n;break;case 17:for(a=3+v(this,3);a--;)i[o++]=0;n=0;break;case 18:for(a=11+v(this,7);a--;)i[o++]=0;n=0;break;default:n=i[o++]=r}return i}var i,r,n,a,s=v(t,5)+257,h=v(t,5)+1,l=v(t,4)+4,c=new(A?Uint8Array:Array)(Q.length);for(a=0;a<l;++a)c[Q[a]]=v(t,3);i=o(c),r=new(A?Uint8Array:Array)(s),n=new(A?Uint8Array:Array)(h),t.s(o(e.call(t,s,i,r)),o(e.call(t,h,i,n)))}function y(t){this.input=t,this.c=0,this.t=[],this.D=!1}function w(t){if("string"==typeof t){var e,i,r=t.split("");for(e=0,i=r.length;e<i;e++)r[e]=(255&r[e].charCodeAt(0))>>>0;t=r}for(var n,a=1,o=0,s=t.length,h=0;0<s;){n=1024<s?1024:s,s-=n;do a+=t[h++],o+=a;while(--n);a%=65521,o%=65521}return(o<<16|a)>>>0}function k(e,i){var r,n;switch(this.input=e,this.c=0,!i&&(i={})||(i.index&&(this.c=i.index),i.verify&&(this.Z=i.verify)),r=e[this.c++],n=e[this.c++],15&r){case pt:this.method=pt;break;default:t(Error("unsupported compression method"))}0!==((r<<8)+n)%31&&t(Error("invalid fcheck flag:"+((r<<8)+n)%31)),32&n&&t(Error("fdict flag is not supported")),this.K=new g(e,{index:this.c,bufferSize:i.bufferSize,bufferType:i.bufferType,resize:i.resize})}function x(t,e){this.input=t,this.a=new(A?Uint8Array:Array)(32768),this.k=ft.o;var i,r={};!e&&(e={})||"number"!=typeof e.compressionType||(this.k=e.compressionType);for(i in e)r[i]=e[i];r.outputBuffer=this.a,this.J=new s(this.input,r)}function S(t,i){var r,n,a,o;if(Object.keys)r=Object.keys(i);else for(n in r=[],a=0,i)r[a++]=n;for(a=0,o=r.length;a<o;++a)n=r[a],e(t+"."+n,i[n])}var _=void 0,C=!0,T=this,A="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array;i.prototype.f=function(){var t,e=this.buffer,i=e.length,r=new(A?Uint8Array:Array)(i<<1);if(A)r.set(e);else for(t=0;t<i;++t)r[t]=e[t];return this.buffer=r},i.prototype.d=function(t,e,i){var r,n=this.buffer,a=this.index,o=this.m,s=n[a];if(i&&1<e&&(t=8<e?(D[255&t]<<24|D[t>>>8&255]<<16|D[t>>>16&255]<<8|D[t>>>24&255])>>32-e:D[t]>>8-e),8>e+o)s=s<<e|t,o+=e;else for(r=0;r<e;++r)s=s<<1|t>>e-r-1&1,8===++o&&(o=0,n[a++]=D[s],s=0,a===n.length&&(n=this.f()));n[a]=s,this.buffer=n,this.m=o,this.index=a},i.prototype.finish=function(){var t,e=this.buffer,i=this.index;return 0<this.m&&(e[i]<<=8-this.m,e[i]=D[e[i]],i++),A?t=e.subarray(0,i):(e.length=i,t=e),t};var E,P=new(A?Uint8Array:Array)(256);for(E=0;256>E;++E){for(var R=E,I=R,M=7,R=R>>>1;R;R>>>=1)I<<=1,I|=1&R,--M;P[E]=(I<<M&255)>>>0}var D=P,F=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117],$=A?new Uint32Array(F):F;n.prototype.getName=function(){return this.name},n.prototype.getData=function(){return this.data},n.prototype.X=function(){return this.Y},e("Zlib.GunzipMember",n),e("Zlib.GunzipMember.prototype.getName",n.prototype.getName),e("Zlib.GunzipMember.prototype.getData",n.prototype.getData),e("Zlib.GunzipMember.prototype.getMtime",n.prototype.X),a.prototype.getParent=function(t){return 2*((t-2)/4|0)},a.prototype.push=function(t,e){var i,r,n,a=this.buffer;for(i=this.length,a[this.length++]=e,a[this.length++]=t;0<i&&(r=this.getParent(i),a[i]>a[r]);)n=a[i],a[i]=a[r],a[r]=n,n=a[i+1],a[i+1]=a[r+1],a[r+1]=n,i=r;return this.length},a.prototype.pop=function(){var t,e,i,r,n,a=this.buffer;for(e=a[0],t=a[1],this.length-=2,a[0]=a[this.length],a[1]=a[this.length+1],n=0;(r=2*n+2,!(r>=this.length))&&(r+2<this.length&&a[r+2]>a[r]&&(r+=2),a[r]>a[n]);)i=a[n],a[n]=a[r],a[r]=i,i=a[n+1],a[n+1]=a[r+1],a[r+1]=i,n=r;return{index:t,value:e,length:this.length}};var B,L=2,O={NONE:0,v:1,o:L,aa:3},N=[];for(B=0;288>B;B++)switch(C){case 143>=B:N.push([B+48,8]);break;case 255>=B:N.push([B-144+400,9]);break;case 279>=B:N.push([B-256+0,7]);break;case 287>=B:N.push([B-280+192,8]);break;default:t("invalid literal: "+B)}s.prototype.g=function(){var e,r,n,a,o=this.input;switch(this.k){case 0:for(n=0,a=o.length;n<a;){r=A?o.subarray(n,n+65535):o.slice(n,n+65535),n+=r.length;var s=r,h=n===a,c=_,d=_,f=_,g=_,v=_,m=this.a,b=this.b;if(A){for(m=new Uint8Array(this.a.buffer);m.length<=b+s.length+5;)m=new Uint8Array(m.length<<1);m.set(this.a)}if(c=h?1:0,m[b++]=0|c,d=s.length,f=~d+65536&65535,m[b++]=255&d,m[b++]=d>>>8&255,m[b++]=255&f,m[b++]=f>>>8&255,A)m.set(s,b),b+=s.length,m=m.subarray(0,b);else{for(g=0,v=s.length;g<v;++g)m[b++]=s[g];m.length=b}this.b=b,this.a=m}break;case 1:var y=new i(A?new Uint8Array(this.a.buffer):this.a,this.b);y.d(1,1,C),y.d(1,2,C);var w,k,x,S=l(this,o);for(w=0,k=S.length;w<k;w++)if(x=S[w],i.prototype.d.apply(y,N[x]),256<x)y.d(S[++w],S[++w],C),y.d(S[++w],5),y.d(S[++w],S[++w],C);else if(256===x)break;this.a=y.finish(),this.b=this.a.length;break;case L:var T,E,P,R,I,M,D,F,$,B,O,H,V,U,G,q=new i(A?new Uint8Array(this.a.buffer):this.a,this.b),W=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],z=Array(19);for(T=L,q.d(1,1,C),q.d(T,2,C),E=l(this,o),M=u(this.V,15),D=p(M),F=u(this.U,7),$=p(F),P=286;257<P&&0===M[P-1];P--);for(R=30;1<R&&0===F[R-1];R--);var Z,j,K,X,Y,Q,J=P,tt=R,et=new(A?Uint32Array:Array)(J+tt),it=new(A?Uint32Array:Array)(316),rt=new(A?Uint8Array:Array)(19);for(Z=j=0;Z<J;Z++)et[j++]=M[Z];for(Z=0;Z<tt;Z++)et[j++]=F[Z];if(!A)for(Z=0,X=rt.length;Z<X;++Z)rt[Z]=0;for(Z=Y=0,X=et.length;Z<X;Z+=j){for(j=1;Z+j<X&&et[Z+j]===et[Z];++j);if(K=j,0===et[Z])if(3>K)for(;0<K--;)it[Y++]=0,rt[0]++;else for(;0<K;)Q=138>K?K:138,Q>K-3&&Q<K&&(Q=K-3),10>=Q?(it[Y++]=17,it[Y++]=Q-3,rt[17]++):(it[Y++]=18,it[Y++]=Q-11,rt[18]++),K-=Q;else if(it[Y++]=et[Z],rt[et[Z]]++,K--,3>K)for(;0<K--;)it[Y++]=et[Z],rt[et[Z]]++;else for(;0<K;)Q=6>K?K:6,Q>K-3&&Q<K&&(Q=K-3),it[Y++]=16,it[Y++]=Q-3,rt[16]++,K-=Q}for(e=A?it.subarray(0,Y):it.slice(0,Y),B=u(rt,7),U=0;19>U;U++)z[U]=B[W[U]];for(I=19;4<I&&0===z[I-1];I--);for(O=p(B),q.d(P-257,5,C),q.d(R-1,5,C),q.d(I-4,4,C),U=0;U<I;U++)q.d(z[U],3,C);for(U=0,G=e.length;U<G;U++)if(H=e[U],q.d(O[H],B[H],C),16<=H){switch(U++,H){case 16:V=2;break;case 17:V=3;break;case 18:V=7;break;default:t("invalid code: "+H)}q.d(e[U],V,C)}var nt,at,ot,st,ht,lt,ct,ut,dt=[D,M],pt=[$,F];for(ht=dt[0],lt=dt[1],ct=pt[0],ut=pt[1],nt=0,at=E.length;nt<at;++nt)if(ot=E[nt],q.d(ht[ot],lt[ot],C),256<ot)q.d(E[++nt],E[++nt],C),st=E[++nt],q.d(ct[st],ut[st],C),q.d(E[++nt],E[++nt],C);else if(256===ot)break;this.a=q.finish(),this.b=this.a.length;break;default:t("invalid compression type")}return this.a};var H=function(){function e(e){switch(C){case 3===e:return[257,e-3,0];case 4===e:return[258,e-4,0];case 5===e:return[259,e-5,0];case 6===e:return[260,e-6,0];case 7===e:return[261,e-7,0];case 8===e:return[262,e-8,0];case 9===e:return[263,e-9,0];case 10===e:return[264,e-10,0];case 12>=e:return[265,e-11,1];case 14>=e:return[266,e-13,1];case 16>=e:return[267,e-15,1];case 18>=e:return[268,e-17,1];case 22>=e:return[269,e-19,2];case 26>=e:return[270,e-23,2];case 30>=e:return[271,e-27,2];case 34>=e:return[272,e-31,2];case 42>=e:return[273,e-35,3];case 50>=e:return[274,e-43,3];case 58>=e:return[275,e-51,3];case 66>=e:return[276,e-59,3];case 82>=e:return[277,e-67,4];case 98>=e:return[278,e-83,4];case 114>=e:return[279,e-99,4];case 130>=e:return[280,e-115,4];case 162>=e:return[281,e-131,5];case 194>=e:return[282,e-163,5];case 226>=e:return[283,e-195,5];case 257>=e:return[284,e-227,5];case 258===e:return[285,e-258,0];default:t("invalid length: "+e)}}var i,r,n=[];for(i=3;258>=i;i++)r=e(i),n[i]=r[2]<<24|r[1]<<16|r[0];return n}(),V=A?new Uint32Array(H):H;f.prototype.g=function(){var t,e,i,n,a,o,h,l,c=new(A?Uint8Array:Array)(32768),u=0,d=this.input,p=this.c,f=this.filename,g=this.A;if(c[u++]=31,c[u++]=139,c[u++]=8,t=0,this.i.fname&&(t|=q),this.i.fcomment&&(t|=W),this.i.fhcrc&&(t|=G),c[u++]=t,e=(Date.now?Date.now():+new Date)/1e3|0,c[u++]=255&e,c[u++]=e>>>8&255,c[u++]=e>>>16&255,c[u++]=e>>>24&255,c[u++]=0,c[u++]=U,this.i.fname!==_){for(h=0,l=f.length;h<l;++h)o=f.charCodeAt(h),255<o&&(c[u++]=o>>>8&255),c[u++]=255&o;c[u++]=0}if(this.i.comment){for(h=0,l=g.length;h<l;++h)o=g.charCodeAt(h),255<o&&(c[u++]=o>>>8&255),c[u++]=255&o;c[u++]=0}return this.i.fhcrc&&(i=65535&r(c,0,u),c[u++]=255&i,c[u++]=i>>>8&255),this.l.outputBuffer=c,this.l.outputIndex=u,a=new s(d,this.l),c=a.g(),u=a.b,A&&(u+8>c.buffer.byteLength?(this.a=new Uint8Array(u+8),this.a.set(new Uint8Array(c.buffer)),c=this.a):c=new Uint8Array(c.buffer)),n=r(d,_,_),c[u++]=255&n,c[u++]=n>>>8&255,c[u++]=n>>>16&255,c[u++]=n>>>24&255,l=d.length,c[u++]=255&l,c[u++]=l>>>8&255,c[u++]=l>>>16&255,c[u++]=l>>>24&255,this.c=p,A&&u<c.length&&(this.a=c=c.subarray(0,u)),c};var U=255,G=2,q=8,W=16;e("Zlib.Gzip",f),e("Zlib.Gzip.prototype.compress",f.prototype.g);var z=0,Z=1,j={N:z,M:Z};g.prototype.h=function(){for(;!this.w;){var e=v(this,3);switch(1&e&&(this.w=C),e>>>=1){case 0:var i=this.input,r=this.c,n=this.a,a=this.b,o=_,s=_,h=_,l=n.length,c=_;switch(this.e=this.j=0,o=i[r++],o===_&&t(Error("invalid uncompressed block header: LEN (first byte)")),s=o,o=i[r++],o===_&&t(Error("invalid uncompressed block header: LEN (second byte)")),s|=o<<8,o=i[r++],o===_&&t(Error("invalid uncompressed block header: NLEN (first byte)")),h=o,o=i[r++],o===_&&t(Error("invalid uncompressed block header: NLEN (second byte)")),h|=o<<8,s===~h&&t(Error("invalid uncompressed block header: length verify")),r+s>i.length&&t(Error("input buffer is broken")),this.r){case z:for(;a+s>n.length;){if(c=l-a,s-=c,A)n.set(i.subarray(r,r+c),a),a+=c,r+=c;else for(;c--;)n[a++]=i[r++];this.b=a,n=this.f(),a=this.b}break;case Z:for(;a+s>n.length;)n=this.f({F:2});break;default:t(Error("invalid inflate mode"))}if(A)n.set(i.subarray(r,r+s),a),a+=s,r+=s;else for(;s--;)n[a++]=i[r++];this.c=r,this.b=a,this.a=n;break;case 1:this.s(ct,dt);break;case 2:b(this);break;default:t(Error("unknown BTYPE: "+e))}}return this.B()};var K,X,Y=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],Q=A?new Uint16Array(Y):Y,J=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,258,258],tt=A?new Uint16Array(J):J,et=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0],it=A?new Uint8Array(et):et,rt=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],nt=A?new Uint16Array(rt):rt,at=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],ot=A?new Uint8Array(at):at,st=new(A?Uint8Array:Array)(288);for(K=0,X=st.length;K<X;++K)st[K]=143>=K?8:255>=K?9:279>=K?7:8;var ht,lt,ct=o(st),ut=new(A?Uint8Array:Array)(30);for(ht=0,lt=ut.length;ht<lt;++ht)ut[ht]=5;var dt=o(ut);g.prototype.s=function(t,e){var i=this.a,r=this.b;this.C=t;for(var n,a,o,s,h=i.length-258;256!==(n=m(this,t));)if(256>n)r>=h&&(this.b=r,i=this.f(),r=this.b),i[r++]=n;else for(a=n-257,s=tt[a],0<it[a]&&(s+=v(this,it[a])),n=m(this,e),o=nt[n],0<ot[n]&&(o+=v(this,ot[n])),r>=h&&(this.b=r,i=this.f(),r=this.b);s--;)i[r]=i[r++-o];for(;8<=this.e;)this.e-=8,this.c--;this.b=r},g.prototype.S=function(t,e){var i=this.a,r=this.b;this.C=t;for(var n,a,o,s,h=i.length;256!==(n=m(this,t));)if(256>n)r>=h&&(i=this.f(),h=i.length),i[r++]=n;else for(a=n-257,s=tt[a],0<it[a]&&(s+=v(this,it[a])),n=m(this,e),o=nt[n],0<ot[n]&&(o+=v(this,ot[n])),r+s>h&&(i=this.f(),h=i.length);s--;)i[r]=i[r++-o];for(;8<=this.e;)this.e-=8,this.c--;this.b=r},g.prototype.f=function(){var t,e,i=new(A?Uint8Array:Array)(this.b-32768),r=this.b-32768,n=this.a;if(A)i.set(n.subarray(32768,i.length));else for(t=0,e=i.length;t<e;++t)i[t]=n[t+32768];if(this.p.push(i),this.u+=i.length,A)n.set(n.subarray(r,r+32768));else for(t=0;32768>t;++t)n[t]=n[r+t];return this.b=32768,n},g.prototype.T=function(t){var e,i,r,n,a=this.input.length/this.c+1|0,o=this.input,s=this.a;return t&&("number"==typeof t.F&&(a=t.F),"number"==typeof t.O&&(a+=t.O)),2>a?(i=(o.length-this.c)/this.C[2],n=258*(i/2)|0,r=n<s.length?s.length+n:s.length<<1):r=s.length*a,A?(e=new Uint8Array(r),e.set(s)):e=s,this.a=e},g.prototype.B=function(){var t,e,i,r,n,a=0,o=this.a,s=this.p,h=new(A?Uint8Array:Array)(this.u+(this.b-32768));if(0===s.length)return A?this.a.subarray(32768,this.b):this.a.slice(32768,this.b);for(e=0,i=s.length;e<i;++e)for(t=s[e],r=0,n=t.length;r<n;++r)h[a++]=t[r];for(e=32768,i=this.b;e<i;++e)h[a++]=o[e];return this.p=[],this.buffer=h},g.prototype.Q=function(){var t,e=this.b;return A?this.L?(t=new Uint8Array(e),t.set(this.a.subarray(0,e))):t=this.a.subarray(0,e):(this.a.length>e&&(this.a.length=e),t=this.a),this.buffer=t},y.prototype.W=function(){return this.D||this.h(),this.t.slice()},y.prototype.h=function(){for(var e=this.input.length;this.c<e;){var i=new n,a=_,o=_,s=_,h=_,l=_,c=_,u=_,d=_,p=_,f=this.input,v=this.c;switch(i.G=f[v++],i.H=f[v++],(31!==i.G||139!==i.H)&&t(Error("invalid file signature:"+i.G+","+i.H)),i.z=f[v++],i.z){case 8:break;default:t(Error("unknown compression method: "+i.z))}if(i.n=f[v++],d=f[v++]|f[v++]<<8|f[v++]<<16|f[v++]<<24,i.Y=new Date(1e3*d),i.ea=f[v++],i.da=f[v++],0<(4&i.n)&&(i.$=f[v++]|f[v++]<<8,v+=i.$),0<(i.n&q)){for(u=[],c=0;0<(l=f[v++]);)u[c++]=String.fromCharCode(l);i.name=u.join("")}if(0<(i.n&W)){for(u=[],c=0;0<(l=f[v++]);)u[c++]=String.fromCharCode(l);i.A=u.join("")}0<(i.n&G)&&(i.R=65535&r(f,0,v),i.R!==(f[v++]|f[v++]<<8)&&t(Error("invalid header crc16"))),a=f[f.length-4]|f[f.length-3]<<8|f[f.length-2]<<16|f[f.length-1]<<24,f.length-v-4-4<512*a&&(h=a),o=new g(f,{index:v,bufferSize:h}),i.data=s=o.h(),v=o.c,i.ba=p=(f[v++]|f[v++]<<8|f[v++]<<16|f[v++]<<24)>>>0,r(s,_,_)!==p&&t(Error("invalid CRC-32 checksum: 0x"+r(s,_,_).toString(16)+" / 0x"+p.toString(16))),i.ca=a=(f[v++]|f[v++]<<8|f[v++]<<16|f[v++]<<24)>>>0,(4294967295&s.length)!==a&&t(Error("invalid input size: "+(4294967295&s.length)+" / "+a)),this.t.push(i),this.c=v}this.D=C;var m,b,y,w=this.t,k=0,x=0;for(m=0,b=w.length;m<b;++m)x+=w[m].data.length;if(A)for(y=new Uint8Array(x),m=0;m<b;++m)y.set(w[m].data,k),k+=w[m].data.length;else{for(y=[],m=0;m<b;++m)y[m]=w[m].data;y=Array.prototype.concat.apply([],y)}return y},e("Zlib.Gunzip",y),e("Zlib.Gunzip.prototype.decompress",y.prototype.h),e("Zlib.Gunzip.prototype.getMembers",y.prototype.W),k.prototype.h=function(){var e,i,r=this.input;return e=this.K.h(),this.c=this.K.c,this.Z&&(i=(r[this.c++]<<24|r[this.c++]<<16|r[this.c++]<<8|r[this.c++])>>>0,i!==w(e)&&t(Error("invalid adler-32 checksum"))),e};var pt=8,ft=O;x.prototype.g=function(){var e,i,r,n,a,o,s,h=0;switch(s=this.a,e=pt){case pt:i=Math.LOG2E*Math.log(32768)-8;break;default:t(Error("invalid compression method"))}switch(r=i<<4|e,s[h++]=r,e){case pt:switch(this.k){case ft.NONE:a=0;break;case ft.v:a=1;break;case ft.o:a=2;break;default:t(Error("unsupported compression type"))}break;default:t(Error("invalid compression method"))}return n=a<<6|0,s[h++]=n|31-(256*r+n)%31,o=w(this.input),this.J.b=h,s=this.J.g(),h=s.length,A&&(s=new Uint8Array(s.buffer),s.length<=h+4&&(this.a=new Uint8Array(s.length+4),this.a.set(s),s=this.a),s=s.subarray(0,h+4)),s[h++]=o>>24&255,s[h++]=o>>16&255,s[h++]=o>>8&255,s[h++]=255&o,s},e("Zlib.Inflate",k),e("Zlib.Inflate.prototype.decompress",k.prototype.h),S("Zlib.Inflate.BufferType",{ADAPTIVE:j.M,BLOCK:j.N}),e("Zlib.Deflate",x),e("Zlib.Deflate.compress",function(t,e){return new x(t,e).g()}),e("Zlib.Deflate.prototype.compress",x.prototype.g),S("Zlib.Deflate.CompressionType",{NONE:ft.NONE,FIXED:ft.v,DYNAMIC:ft.o})}).call(this),function(t){t(jQuery)}(function(t){function e(e){var o=e||window.event,s=h.call(arguments,1),l=0,u=0,d=0,p=0,f=0,g=0;if(e=t.event.fix(o),e.type="mousewheel","detail"in o&&(d=o.detail*-1),"wheelDelta"in o&&(d=o.wheelDelta),"wheelDeltaY"in o&&(d=o.wheelDeltaY),"wheelDeltaX"in o&&(u=o.wheelDeltaX*-1),"axis"in o&&o.axis===o.HORIZONTAL_AXIS&&(u=d*-1,d=0),l=0===d?u:d,"deltaY"in o&&(d=o.deltaY*-1,l=d),"deltaX"in o&&(u=o.deltaX,0===d&&(l=u*-1)),0!==d||0!==u){if(1===o.deltaMode){var v=t.data(this,"mousewheel-line-height");l*=v,d*=v,u*=v}else if(2===o.deltaMode){var m=t.data(this,"mousewheel-page-height");l*=m,d*=m,u*=m}if(p=Math.max(Math.abs(d),Math.abs(u)),(!a||p<a)&&(a=p,r(o,p)&&(a/=40)),r(o,p)&&(l/=40,u/=40,d/=40),l=Math[l>=1?"floor":"ceil"](l/a),u=Math[u>=1?"floor":"ceil"](u/a),d=Math[d>=1?"floor":"ceil"](d/a),c.settings.normalizeOffset&&this.getBoundingClientRect){var b=this.getBoundingClientRect();f=e.clientX-b.left,g=e.clientY-b.top}return e.deltaX=u,e.deltaY=d,e.deltaFactor=a,e.offsetX=f,e.offsetY=g,e.deltaMode=0,s.unshift(e,l,u,d),n&&clearTimeout(n),n=setTimeout(i,200),(t.event.dispatch||t.event.handle).apply(this,s)}}function i(){a=null}function r(t,e){return c.settings.adjustOldDeltas&&"mousewheel"===t.type&&e%120===0}var n,a,o=["wheel","mousewheel","DOMMouseScroll","MozMousePixelScroll"],s="onwheel"in document||document.documentMode>=9?["wheel"]:["mousewheel","DomMouseScroll","MozMousePixelScroll"],h=Array.prototype.slice;if(t.event.fixHooks)for(var l=o.length;l;)t.event.fixHooks[o[--l]]=t.event.mouseHooks;var c=t.event.special.mousewheel={version:"3.1.12",setup:function(){if(this.addEventListener)for(var i=s.length;i;)this.addEventListener(s[--i],e,!1);else this.onmousewheel=e;t.data(this,"mousewheel-line-height",c.getLineHeight(this)),t.data(this,"mousewheel-page-height",c.getPageHeight(this))},teardown:function(){if(this.removeEventListener)for(var i=s.length;i;)this.removeEventListener(s[--i],e,!1);else this.onmousewheel=null;t.removeData(this,"mousewheel-line-height"),t.removeData(this,"mousewheel-page-height")},getLineHeight:function(e){var i=t(e),r=i["offsetParent"in t.fn?"offsetParent":"parent"]();return r.length||(r=t("body")),parseInt(r.css("fontSize"),10)||parseInt(i.css("fontSize"),10)||16},getPageHeight:function(e){return t(e).height()},settings:{adjustOldDeltas:!0,normalizeOffset:!0}};t.fn.extend({mousewheel:function(t){return t?this.bind("mousewheel",t):this.trigger("mousewheel")},unmousewheel:function(t){return this.unbind("mousewheel",t)}})}),function t(e,i,r){function n(o,s){if(!i[o]){if(!e[o]){var h="function"==typeof require&&require;if(!s&&h)return h(o,!0);if(a)return a(o,!0);var l=new Error("Cannot find module '"+o+"'");throw l.code="MODULE_NOT_FOUND",l}var c=i[o]={exports:{}};e[o][0].call(c.exports,function(t){var i=e[o][1][t];return n(i?i:t)},c,c.exports,t,e,i,r)}return i[o].exports}for(var a="function"==typeof require&&require,o=0;o<r.length;o++)n(r[o]);return n}({1:[function(t,e,i){"use strict";function r(){}function n(t){try{return t.then}catch(t){return v=t,m}}function a(t,e){try{return t(e)}catch(t){return v=t,m}}function o(t,e,i){try{t(e,i)}catch(t){return v=t,m}}function s(t){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");if("function"!=typeof t)throw new TypeError("not a function");this._37=0,this._12=null,this._59=[],t!==r&&f(t,this)}function h(t,e,i){return new t.constructor(function(n,a){var o=new s(r);o.then(n,a),l(t,new p(e,i,o))})}function l(t,e){for(;3===t._37;)t=t._12;return 0===t._37?void t._59.push(e):void g(function(){var i=1===t._37?e.onFulfilled:e.onRejected;if(null===i)return void(1===t._37?c(e.promise,t._12):u(e.promise,t._12));var r=a(i,t._12);r===m?u(e.promise,v):c(e.promise,r)})}function c(t,e){if(e===t)return u(t,new TypeError("A promise cannot be resolved with itself."));if(e&&("object"==typeof e||"function"==typeof e)){var i=n(e);if(i===m)return u(t,v);if(i===t.then&&e instanceof s)return t._37=3,t._12=e,void d(t);if("function"==typeof i)return void f(i.bind(e),t)}t._37=1,t._12=e,d(t)}function u(t,e){t._37=2,t._12=e,d(t)}function d(t){for(var e=0;e<t._59.length;e++)l(t,t._59[e]);t._59=null}function p(t,e,i){this.onFulfilled="function"==typeof t?t:null,this.onRejected="function"==typeof e?e:null,this.promise=i}function f(t,e){var i=!1,r=o(t,function(t){i||(i=!0,c(e,t))},function(t){i||(i=!0,u(e,t))});i||r!==m||(i=!0,u(e,v))}var g=t("asap/raw"),v=null,m={};e.exports=s,s._99=r,s.prototype.then=function(t,e){if(this.constructor!==s)return h(this,t,e);var i=new s(r);return l(this,new p(t,e,i)),i}},{"asap/raw":4}],2:[function(t,e,i){"use strict";function r(t){var e=new n(n._99);return e._37=1,e._12=t,e}var n=t("./core.js");e.exports=n;var a=r(!0),o=r(!1),s=r(null),h=r(void 0),l=r(0),c=r("");n.resolve=function(t){if(t instanceof n)return t;if(null===t)return s;if(void 0===t)return h;if(t===!0)return a;if(t===!1)return o;if(0===t)return l;if(""===t)return c;if("object"==typeof t||"function"==typeof t)try{var e=t.then;if("function"==typeof e)return new n(e.bind(t))}catch(t){return new n(function(e,i){i(t)})}return r(t)},n.all=function(t){var e=Array.prototype.slice.call(t);return new n(function(t,i){function r(o,s){if(s&&("object"==typeof s||"function"==typeof s)){if(s instanceof n&&s.then===n.prototype.then){for(;3===s._37;)s=s._12;return 1===s._37?r(o,s._12):(2===s._37&&i(s._12),void s.then(function(t){r(o,t)},i))}var h=s.then;if("function"==typeof h){var l=new n(h.bind(s));return void l.then(function(t){r(o,t)},i)}}e[o]=s,0===--a&&t(e)}if(0===e.length)return t([]);for(var a=e.length,o=0;o<e.length;o++)r(o,e[o])})},n.reject=function(t){return new n(function(e,i){i(t)})},n.race=function(t){return new n(function(e,i){t.forEach(function(t){n.resolve(t).then(e,i)})})},n.prototype.catch=function(t){return this.then(null,t)}},{"./core.js":1}],3:[function(t,e,i){"use strict";function r(){if(h.length)throw h.shift()}function n(t){var e;e=s.length?s.pop():new a,e.task=t,o(e)}function a(){this.task=null}var o=t("./raw"),s=[],h=[],l=o.makeRequestCallFromTimer(r);e.exports=n,a.prototype.call=function(){try{this.task.call()}catch(t){n.onerror?n.onerror(t):(h.push(t),l())}finally{this.task=null,s[s.length]=this}}},{"./raw":4}],4:[function(t,e,i){(function(t){"use strict";function i(t){s.length||(o(),h=!0),s[s.length]=t}function r(){for(;l<s.length;){var t=l;if(l+=1,s[t].call(),l>c){for(var e=0,i=s.length-l;e<i;e++)s[e]=s[e+l];s.length-=l,l=0}}s.length=0,l=0,h=!1}function n(t){var e=1,i=new u(t),r=document.createTextNode("");return i.observe(r,{characterData:!0}),function(){e=-e,r.data=e}}function a(t){return function(){function e(){clearTimeout(i),clearInterval(r),t()}var i=setTimeout(e,0),r=setInterval(e,50)}}e.exports=i;var o,s=[],h=!1,l=0,c=1024,u=t.MutationObserver||t.WebKitMutationObserver;o="function"==typeof u?n(r):a(r),i.requestFlush=o,i.makeRequestCallFromTimer=a}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],5:[function(t,e,i){"function"!=typeof Promise.prototype.done&&(Promise.prototype.done=function(t,e){var i=arguments.length?this.then.apply(this,arguments):this;i.then(null,function(t){setTimeout(function(){throw t},0)})})},{}],6:[function(t,e,i){t("asap");"undefined"==typeof Promise&&(Promise=t("./lib/core.js"),t("./lib/es6-extensions.js")),t("./polyfill-done.js")},{"./lib/core.js":1,"./lib/es6-extensions.js":2,"./polyfill-done.js":5,asap:3}]},{},[6]),function(t){"function"==typeof define&&define.amd?define(["jquery"],t):"object"==typeof exports&&(module.exports=t)}(function(t){return void 0===igv&&(igv={}),igv}),!function(t){"use strict";var e="kinetic-active";window.requestAnimationFrame||(window.requestAnimationFrame=function(){return window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){window.setTimeout(t,1e3/60)}}()),t.support=t.support||{},t.extend(t.support,{touch:"ontouchend"in document});var i=function(e,i){return this.settings=i,this.el=e,this.$el=t(e),this._initElements(),this};i.DATA_KEY="kinetic",i.DEFAULTS={cursor:"move",decelerate:!0,triggerHardware:!1,threshold:0,y:!0,x:!0,slowdown:.9,maxvelocity:40,throttleFPS:60,invert:!1,movingClass:{up:"kinetic-moving-up",down:"kinetic-moving-down",left:"kinetic-moving-left",right:"kinetic-moving-right"},deceleratingClass:{up:"kinetic-decelerating-up",down:"kinetic-decelerating-down",left:"kinetic-decelerating-left",right:"kinetic-decelerating-right"}},i.prototype.start=function(e){this.settings=t.extend(this.settings,e),this.velocity=e.velocity||this.velocity,this.velocityY=e.velocityY||this.velocityY,this.settings.decelerate=!1,this._move()},i.prototype.end=function(){this.settings.decelerate=!0},i.prototype.stop=function(){this.velocity=0,this.velocityY=0,this.settings.decelerate=!0,t.isFunction(this.settings.stopped)&&this.settings.stopped.call(this);
},i.prototype.detach=function(){this._detachListeners(),this.$el.removeClass(e).css("cursor","")},i.prototype.attach=function(){this.$el.hasClass(e)||(this._attachListeners(this.$el),this.$el.addClass(e).css("cursor",this.settings.cursor))},i.prototype._initElements=function(){this.$el.addClass(e),t.extend(this,{xpos:null,prevXPos:!1,ypos:null,prevYPos:!1,mouseDown:!1,throttleTimeout:1e3/this.settings.throttleFPS,lastMove:null,elementFocused:null}),this.velocity=0,this.velocityY=0,t(document).mouseup(t.proxy(this._resetMouse,this)).click(t.proxy(this._resetMouse,this)),this._initEvents(),this.$el.css("cursor",this.settings.cursor),this.settings.triggerHardware&&this.$el.css({"-webkit-transform":"translate3d(0,0,0)","-webkit-perspective":"1000","-webkit-backface-visibility":"hidden"})},i.prototype._initEvents=function(){var e=this;this.settings.events={touchStart:function(t){var i;e._useTarget(t.target,t)&&(i=t.originalEvent.touches[0],e.threshold=e._threshold(t.target,t),e._start(i.clientX,i.clientY),t.stopPropagation())},touchMove:function(t){var i;e.mouseDown&&(i=t.originalEvent.touches[0],e._inputmove(i.clientX,i.clientY),t.preventDefault&&t.preventDefault())},inputDown:function(t){e._useTarget(t.target,t)&&(e.threshold=e._threshold(t.target,t),e._start(t.clientX,t.clientY),e.elementFocused=t.target,"IMG"===t.target.nodeName&&t.preventDefault(),t.stopPropagation())},inputEnd:function(t){e._useTarget(t.target,t)&&(e._end(),e.elementFocused=null,t.preventDefault&&t.preventDefault())},inputMove:function(t){e.mouseDown&&(e._inputmove(t.clientX,t.clientY),t.preventDefault&&t.preventDefault())},scroll:function(i){t.isFunction(e.settings.moved)&&e.settings.moved.call(e,e.settings),i.preventDefault&&i.preventDefault()},inputClick:function(t){return Math.abs(e.velocity)>0?(t.preventDefault(),!1):void 0},dragStart:function(t){return(!e._useTarget(t.target,t)||!e.elementFocused)&&void 0},selectStart:function(i){return t.isFunction(e.settings.selectStart)?e.settings.selectStart.apply(e,arguments):!e._useTarget(i.target,i)&&void 0}},this._attachListeners(this.$el,this.settings)},i.prototype._inputmove=function(e,i){var r=this.$el;if(this.el,(!this.lastMove||new Date>new Date(this.lastMove.getTime()+this.throttleTimeout))&&(this.lastMove=new Date,this.mouseDown&&(this.xpos||this.ypos))){var n=e-this.xpos,a=i-this.ypos;if(this.settings.invert&&(n*=-1,a*=-1),this.threshold>0){var o=Math.sqrt(n*n+a*a);if(this.threshold>o)return;this.threshold=0}this.elementFocused&&(t(this.elementFocused).blur(),this.elementFocused=null,r.focus()),this.settings.decelerate=!1,this.velocity=this.velocityY=0;var s=this.scrollLeft(),h=this.scrollTop();this.scrollLeft(this.settings.x?s-n:s),this.scrollTop(this.settings.y?h-a:h),this.prevXPos=this.xpos,this.prevYPos=this.ypos,this.xpos=e,this.ypos=i,this._calculateVelocities(),this._setMoveClasses(this.settings.movingClass),t.isFunction(this.settings.moved)&&this.settings.moved.call(this,this.settings)}},i.prototype._calculateVelocities=function(){this.velocity=this._capVelocity(this.prevXPos-this.xpos,this.settings.maxvelocity),this.velocityY=this._capVelocity(this.prevYPos-this.ypos,this.settings.maxvelocity),this.settings.invert&&(this.velocity*=-1,this.velocityY*=-1)},i.prototype._end=function(){this.xpos&&this.prevXPos&&this.settings.decelerate===!1&&(this.settings.decelerate=!0,this._calculateVelocities(),this.xpos=this.prevXPos=this.mouseDown=!1,this._move())},i.prototype._useTarget=function(e,i){return!t.isFunction(this.settings.filterTarget)||this.settings.filterTarget.call(this,e,i)!==!1},i.prototype._threshold=function(e,i){return t.isFunction(this.settings.threshold)?this.settings.threshold.call(this,e,i):this.settings.threshold},i.prototype._start=function(t,e){this.mouseDown=!0,this.velocity=this.prevXPos=0,this.velocityY=this.prevYPos=0,this.xpos=t,this.ypos=e},i.prototype._resetMouse=function(){this.xpos=!1,this.ypos=!1,this.mouseDown=!1},i.prototype._decelerateVelocity=function(t,e){return 0===Math.floor(Math.abs(t))?0:t*e},i.prototype._capVelocity=function(t,e){var i=t;return t>0?t>e&&(i=e):0-e>t&&(i=0-e),i},i.prototype._setMoveClasses=function(t){var e=this.settings,i=this.$el;i.removeClass(e.movingClass.up).removeClass(e.movingClass.down).removeClass(e.movingClass.left).removeClass(e.movingClass.right).removeClass(e.deceleratingClass.up).removeClass(e.deceleratingClass.down).removeClass(e.deceleratingClass.left).removeClass(e.deceleratingClass.right),this.velocity>0&&i.addClass(t.right),this.velocity<0&&i.addClass(t.left),this.velocityY>0&&i.addClass(t.down),this.velocityY<0&&i.addClass(t.up)},i.prototype._move=function(){var e=this._getScroller(),i=e[0],r=this,n=r.settings;n.x&&i.scrollWidth>0?(this.scrollLeft(this.scrollLeft()+this.velocity),Math.abs(this.velocity)>0&&(this.velocity=n.decelerate?r._decelerateVelocity(this.velocity,n.slowdown):this.velocity)):this.velocity=0,n.y&&i.scrollHeight>0?(this.scrollTop(this.scrollTop()+this.velocityY),Math.abs(this.velocityY)>0&&(this.velocityY=n.decelerate?r._decelerateVelocity(this.velocityY,n.slowdown):this.velocityY)):this.velocityY=0,r._setMoveClasses(n.deceleratingClass),t.isFunction(n.moved)&&n.moved.call(this,n),Math.abs(this.velocity)>0||Math.abs(this.velocityY)>0?this.moving||(this.moving=!0,window.requestAnimationFrame(function(){r.moving=!1,r._move()})):r.stop()},i.prototype._getScroller=function(){var e=this.$el;return(this.$el.is("body")||this.$el.is("html"))&&(e=t(window)),e},i.prototype.scrollLeft=function(t){var e=this._getScroller();return"number"!=typeof t?e.scrollLeft():(e.scrollLeft(t),void(this.settings.scrollLeft=t))},i.prototype.scrollTop=function(t){var e=this._getScroller();return"number"!=typeof t?e.scrollTop():(e.scrollTop(t),void(this.settings.scrollTop=t))},i.prototype._attachListeners=function(){var e=this.$el,i=this.settings;t.support.touch&&e.bind("touchstart",i.events.touchStart).bind("touchend",i.events.inputEnd).bind("touchmove",i.events.touchMove),e.mousedown(i.events.inputDown).mouseup(i.events.inputEnd).mousemove(i.events.inputMove),e.click(i.events.inputClick).scroll(i.events.scroll).bind("selectstart",i.events.selectStart).bind("dragstart",i.events.dragStart)},i.prototype._detachListeners=function(){var e=this.$el,i=this.settings;t.support.touch&&e.unbind("touchstart",i.events.touchStart).unbind("touchend",i.events.inputEnd).unbind("touchmove",i.events.touchMove),e.unbind("mousedown",i.events.inputDown).unbind("mouseup",i.events.inputEnd).unbind("mousemove",i.events.inputMove),e.unbind("click",i.events.inputClick).unbind("scroll",i.events.scroll).unbind("selectstart",i.events.selectStart).unbind("dragstart",i.events.dragStart)},t.Kinetic=i,t.fn.kinetic=function(e,r){return this.each(function(){var n=t(this),a=n.data(i.DATA_KEY),o=t.extend({},i.DEFAULTS,n.data(),"object"==typeof e&&e);a||n.data(i.DATA_KEY,a=new i(this,o)),"string"==typeof e&&a[e](r)})}}(window.jQuery||window.Zepto);